(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{288:function(e,t,r){"use strict";r.r(t);r(24),r(3),r(39),r(4);var n=r(294),i=r.n(n),a=(r(297),r(0)),s=r.n(a),o=r(96),u=r(603),c=r(650),h=r(498),l=r(443),p=r(647),d=r(609),f=r(655),y=r(327),m=r(656),v=r(641),_=(r(27),r(5),r(6),r(8),r(453));var g=_.a.div.withConfig({displayName:"control-panel__Container",componentId:"sc-14q5t5u-0"})(["display:flex;flex-direction:column;position:absolute;top:0;right:0;max-width:320px;background:#fff;box-shadow:0 2px 4px rgba(0,0,0,0.3);padding:12px 24px;margin:20px;font-size:13px;line-height:2;outline:none;z-index:100;"]),T=_.a.select.withConfig({displayName:"control-panel__DropDown",componentId:"sc-14q5t5u-1"})(["margin-bottom:12px;"]),b=_.a.select.withConfig({displayName:"control-panel__TilesetDropDown",componentId:"sc-14q5t5u-2"})(["margin-bottom:12px;font-weight:800;font-size:medium;"]),I=function(e){var t,r;function n(){return e.apply(this,arguments)||this}r=e,(t=n).prototype=Object.create(r.prototype),t.prototype.constructor=t,t.__proto__=r;var i=n.prototype;return i._renderByCategories=function(){var e=this.props,t=e.category,r=e.name,n=e.onExampleChange,i=e.data,a=Object.keys(i),o=t+"."+r;return s.a.createElement(b,{value:o,onChange:function(e){var t=e.target.value.split("."),r=t[0],a=t[1],s=i[r].examples;n({category:r,name:a,example:s[a]})}},a.map(function(e,t){var r=i[e].examples;return s.a.createElement("optgroup",{key:t,label:e},Object.keys(r).map(function(t,r){var n=e+"."+t;return s.a.createElement("option",{key:r,value:n},t)}))}))},i._renderMapStyles=function(){var e=this.props,t=e.onMapStyleChange,r=e.mapStyles,n=e.selectedMapStyle;return s.a.createElement(T,{value:n,onChange:function(e){var r=e.target.value;t({selectedMapStyle:r})}},Object.keys(r).map(function(e){return s.a.createElement("option",{key:e,value:r[e]},e)}))},i._renderDropped=function(){var e=this.props.droppedFile;return e?s.a.createElement("div",null,"Dropped file: ",JSON.stringify(e.name)):null},i._renderAttributions=function(){var e=this.props.attributions;return e&&0!==e.length?s.a.createElement("div",{style:{marginTop:"0.5cm"}},s.a.createElement("div",{style:{textAlign:"center",borderStyle:"groove"}},Boolean(e.length)&&s.a.createElement("b",null,"Tileset Credentials"),e.map(function(e){return s.a.createElement("div",{key:e.html,dangerouslySetInnerHTML:{__html:e.html}})}))):null},i.render=function(){return s.a.createElement(g,null,this._renderByCategories(),this._renderDropped(),this._renderMapStyles(),this.props.children,this._renderAttributions())},n}(a.PureComponent);function E(e,t){e.ondragover=function(e){e.dataTransfer.dropEffect="link",e.preventDefault()},e.ondrop=function(e){e.preventDefault(),e.dataTransfer.files&&1===e.dataTransfer.files.length&&t(e.dataTransfer.files[0])}}I.defaultProps={droppedFile:null,onChange:function(){}};r(134);function w(e,t,r,n,i,a,s){try{var o=e[a](s),u=o.value}catch(c){return void r(c)}o.done?t(u):Promise.resolve(u).then(n,i)}var S="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiJlNGZmZjBjMS04ZGYwLTRhYjAtOWIzYy0wZWJmNzI4OWZhNGEiLCJpZCI6MTYyMywic2NvcGVzIjpbImFzciIsImdjIl0sImFzc2V0cyI6WzI5MzI4LDI5MzMxLDI5MzMyLDI5MzMzLDI5MzM0LDI5MzM1LDEsMiwzLDQsMzk1NF0sImlhdCI6MTU2MDQ0ODA2Nn0.zZPuc5WzTsrKNviCY2jyhmDwJITXzhbRTnJS025_uBw",O="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiIxN2NhMzkwYi0zNWM4LTRjNTYtYWE3Mi1jMDAxYzhlOGVmNTAiLCJpZCI6OTYxOSwic2NvcGVzIjpbImFzbCIsImFzciIsImFzdyIsImdjIl0sImlhdCI6MTU2MjE4MTMxM30.OkgVr6NaKYxabUMIGqPOYFe0V5JifXLVLfpae63x-tA",x="https://raw.githubusercontent.com/uber-web/loaders.gl/master",A=x+"/modules/3d-tiles/test/data/index.json",N="ion",C="Melbourne (PointCloud)",D={github:{examples:{"Royal Exhibition Building (Github Pages)":{tilesetUrl:"https://raw.githubusercontent.com/uber-common/deck.gl-data/master/3d-tiles/RoyalExhibitionBuilding/tileset.json"}}},ion:{name:"Cesium ION",examples:{"Melbourne (PointCloud)":{ionAssetId:28957,ionAccessToken:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiJjYTExNWEwZC00MWFmLTRmNWUtOTA1Zi00OGUzMzlkMDVlNWQiLCJpZCI6NDQsInNjb3BlcyI6WyJhc3IiLCJnYyJdLCJhc3NldHMiOlsyODk1N10sImlhdCI6MTU2ODM5OTgxNn0.Bqe4IWmT6etdZYqm12WcgdW52wDLzdbKM4Xx_8lRZmk"},"Mount St Helens (PointCloud)":{ionAssetId:33301,ionAccessToken:O},"Montreal (PointCloud)":{ionAssetId:28945,ionAccessToken:O},"New York (3D Photogrammetry)":{ionAssetId:7162,ionAccessToken:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiIzMGY4ODczYy1mNTk4LTRiMDUtYmIxYy0xZWYwOWZmMGY4NjQiLCJpZCI6NDQsInNjb3BlcyI6WyJhc3IiLCJnYyJdLCJhc3NldHMiOlsxLDIsMyw0LDYxOTMsNjI3Myw3MTYyLDczNTMsNzE0Ml0sImlhdCI6MTU0MTYxODM0NX0.lWnGs9ySXO4QK3HagcMsDpZ8L01DpmUDQm38-2QAQuE"}}},vricon:{name:"vricon Photogrammetry Samples",examples:{Cairo:{ionAssetId:29328,ionAccessToken:S},Caracas:{ionAssetId:29331,ionAccessToken:S},Damascus:{ionAssetId:29332,ionAccessToken:S},Honolulu:{ionAssetId:29333,ionAccessToken:S},"San Francisco":{ionAssetId:29334,ionAccessToken:S},Tehran:{ionAssetId:29335,ionAccessToken:S}}}};function L(){return P.apply(this,arguments)}function P(){var e;return e=i.a.mark(function e(){var t,r;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(A);case 2:return t=e.sent,e.next=5,t.json();case 5:return delete(r=e.sent).Geometry,delete r.Vector,delete r.Composite,M(r),e.abrupt("return",Object.assign({},r,{},D,{custom:{name:"Custom",examples:{"Custom Tileset":{},"ION Tileset":{}}}}));case 11:case"end":return e.stop()}},e)}),(P=function(){var t=this,r=arguments;return new Promise(function(n,i){var a=e.apply(t,r);function s(e){w(a,n,i,s,o,"next",e)}function o(e){w(a,n,i,s,o,"throw",e)}s(void 0)})}).apply(this,arguments)}function M(e){for(var t=0,r=Object.values(e);t<r.length;t++)for(var n=r[t],i=0,a=Object.values(n.examples);i<a.length;i++){var s=a[i];s.tilesetUrl=x+"/"+s.path+"/"+s.tileset}}function R(e,t,r,n,i,a,s){try{var o=e[a](s),u=o.value}catch(c){return void r(c)}o.done?t(u):Promise.resolve(u).then(n,i)}function k(e){return function(){var t=this,r=arguments;return new Promise(function(n,i){var a=e.apply(t,r);function s(e){R(a,n,i,s,o,"next",e)}function o(e){R(a,n,i,s,o,"throw",e)}s(void 0)})}}function U(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}r.d(t,"INITIAL_VIEW_STATE",function(){return z}),r.d(t,"default",function(){return q}),r.d(t,"renderToDOM",function(){return G});var B={"Base Map: Satellite":"mapbox://styles/mapbox/satellite-v9","Base Map: Light":"mapbox://styles/mapbox/light-v9","Base Map: Dark":"mapbox://styles/mapbox/dark-v9"},V=B["Base Map: Dark"],z=Object.assign({},{latitude:40.04248558075302,longitude:-75.61213987669433},{pitch:45,maxPitch:60,bearing:0,minZoom:2,maxZoom:30,zoom:3});Object(y.b)([m.a]);var q=function(e){var t,r;function n(t){var r;return(r=e.call(this,t)||this).state={viewState:z,selectedMapStyle:V,droppedFile:null,examplesByCategory:null,selectedExample:{},category:N,name:C,attributions:[]},r._deckRef=null,r._onTilesetLoad=r._onTilesetLoad.bind(U(r)),r._onTilesetChange=r._onTilesetChange.bind(U(r)),r}r=e,(t=n).prototype=Object.create(r.prototype),t.prototype.constructor=t,t.__proto__=r;var a=n.prototype;return a.componentDidMount=function(){var e=k(i.a.mark(function e(){var t,r,n,a,s,o;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this._statsWidgetContainer,this._memWidget=new f.a(d.a.get("Memory Usage"),{framesPerUpdate:1,formatters:{"GPU Memory":"memory","Buffer Memory":"memory","Renderbuffer Memory":"memory","Texture Memory":"memory"},container:t}),this._tilesetStatsWidget=new f.a(null,{container:t}),E(this._deckRef.deckCanvas,function(e,t){alert("File drop of tilesets not yet implemented")}),e.next=6,this._loadExampleIndex();case 6:if(!this._selectTilesetFromQueryParams()){e.next=8;break}return e.abrupt("return");case 8:r=this.state,n=r.category,a=r.name,s=this.state.examplesByCategory,o=s[n].examples[a],this.setState({selectedExample:o});case 12:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),a._loadExampleIndex=function(){var e=k(i.a.mark(function e(){var t;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L();case 2:t=e.sent,this.setState({examplesByCategory:t});case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),a._selectTilesetFromQueryParams=function(){var e=new URL(window.location.href),t=e.searchParams.get("ionAccessToken"),r=e.searchParams.get("ionAssetId");if(t&&r)return this.setState({selectedExample:{ionAccessToken:t,ionAssetId:r},category:"custom",name:"ION Tileset"}),!0;var n=e.searchParams.get("tileset");return!!n&&(this.setState({selectedExample:{tilesetUrl:n},category:"custom",name:"URL Tileset"}),!0)},a._updateStatWidgets=function(){this._memWidget.update(),this._tilesetStatsWidget.update()},a._onSelectExample=function(){var e=k(i.a.mark(function e(t){var r,n,a;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=t.example,n=t.category,a=t.name,this.setState({selectedExample:r,category:n,name:a});case 2:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),a._onSelectMapStyle=function(e){var t=e.selectedMapStyle;this.setState({selectedMapStyle:t})},a._onTilesetLoad=function(e){this.setState({attributions:e.credits.attributions}),this._tilesetStatsWidget.setStats(e.stats),this._centerViewOnTileset(e)},a._centerViewOnTileset=function(e){var t=e.cartographicCenter,r=e.zoom;this.setState({viewState:Object.assign({},this.state.viewState,{longitude:t[0],latitude:t[1],zoom:r+1.5,bearing:z.bearing,pitch:z.pitch,transitionDuration:4e3,transitionInterpolator:new h.a})})},a._onTilesetChange=function(e){this._updateStatWidgets()},a._onViewStateChange=function(e){var t=e.viewState;this.setState({viewState:t})},a._renderControlPanel=function(){var e=this.state,t=e.examplesByCategory,r=e.category,n=e.name,i=e.viewState,a=e.selectedMapStyle,o=this.state.attributions;return t?s.a.createElement(I,{mapStyles:B,selectedMapStyle:a,data:t,category:r,name:n,attributions:o,onMapStyleChange:this._onSelectMapStyle.bind(this),onExampleChange:this._onSelectExample.bind(this)},s.a.createElement("div",{style:{textAlign:"center"}},"long/lat: ",i.longitude.toFixed(5),",",i.latitude.toFixed(5),", zoom:"," ",i.zoom.toFixed(2))):null},a._renderStats=function(){var e=this;return s.a.createElement("div",{style:{position:"absolute",padding:12,zIndex:"10000",maxWidth:300,background:"#000",color:"#fff"},ref:function(t){return e._statsWidgetContainer=t}})},a._renderTile3DLayer=function(){var e=this.state.selectedExample;if(!e)return null;var t=e.tilesetUrl,r=e.ionAssetId,n=e.ionAccessToken;return new p.a({id:"tile-3d-layer",tilesetUrl:t,_ionAssetId:r,_ionAccessToken:n,pointSize:2,DracoWorkerLoader:v.a,DracoLoader:m.a,onTilesetLoad:this._onTilesetLoad,onTileLoad:this._onTilesetChange,onTileUnload:this._onTilesetChange,onTileLoadFail:this._onTilesetChange})},a.render=function(){var e=this,t=this.state,r=t.viewState,n=t.selectedMapStyle,i=this._renderTile3DLayer();return s.a.createElement("div",null,this._renderStats(),this._renderControlPanel(),s.a.createElement(c.a,{ref:function(t){return e._deckRef=t},layers:[i],initialViewState:z,viewState:r,onViewStateChange:this._onViewStateChange.bind(this),controller:{type:l.a,maxPitch:85},onAfterRender:function(){return e._updateStatWidgets()}},s.a.createElement(u.a,{mapStyle:n,mapboxApiAccessToken:"pk.eyJ1IjoidWJlcmRhdGEiLCJhIjoiY2pwY3owbGFxMDVwNTNxcXdwMms2OWtzbiJ9.1PPVl0VLUQgqrosrI2nUhg",preventStyleDiffing:!0})))},n}(a.PureComponent);function G(e){Object(o.render)(s.a.createElement(q,null),e)}},337:function(e,t,r){"use strict";function n(e,t){if(!e)throw new Error(t||"3d-tile loader: assertion failed.")}r.d(t,"a",function(){return n})},367:function(e,t,r){"use strict";r.d(t,"a",function(){return s});r(135),r(136),r(39),r(4);var n=r(294),i=r.n(n);r(297);function a(e,t,r,n,i,a,s){try{var o=e[a](s),u=o.value}catch(c){return void r(c)}o.done?t(u):Promise.resolve(u).then(n,i)}function s(e){return o.apply(this,arguments)}function o(){var e;return e=i.a.mark(function e(t){var r;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r="Failed to fetch resource "+t.url+" ("+t.status+"): ",e.prev=1,!t.headers.get("Content-Type").includes("application/json")){e.next=10;break}return e.t0=r,e.next=7,t.text();case 7:r=e.t0+=e.sent,e.next=11;break;case 10:r+=t.statusText;case 11:e.next=16;break;case 13:return e.prev=13,e.t1=e.catch(1),e.abrupt("return",r);case 16:return e.abrupt("return",r);case 17:case"end":return e.stop()}},e,null,[[1,13]])}),(o=function(){var t=this,r=arguments;return new Promise(function(n,i){var s=e.apply(t,r);function o(e){a(s,n,i,o,u,"next",e)}function u(e){a(s,n,i,o,u,"throw",e)}o(void 0)})}).apply(this,arguments)}},640:function(e,t,r){"use strict";r.d(t,"a",function(){return h});r(10),r(7),r(5),r(39),r(4);var n=r(294),i=r.n(n),a=(r(297),r(337)),s=r(367);function o(e,t,r,n,i,a,s){try{var o=e[a](s),u=o.value}catch(c){return void r(c)}o.done?t(u):Promise.resolve(u).then(n,i)}function u(e){return function(){var t=this,r=arguments;return new Promise(function(n,i){var a=e.apply(t,r);function s(e){o(a,n,i,s,u,"next",e)}function u(e){o(a,n,i,s,u,"throw",e)}s(void 0)})}}var c="https://api.cesium.com/v1/assets";function h(e,t){return l.apply(this,arguments)}function l(){return(l=u(i.a.mark(function e(t,r){var n,s,o,u,c,h,l,d,y;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=19;break}return e.next=3,p(t);case 3:n=e.sent,s=n.items,o=Array.isArray(s),u=0,s=o?s:s[Symbol.iterator]();case 5:if(!o){e.next=11;break}if(!(u>=s.length)){e.next=8;break}return e.abrupt("break",19);case 8:c=s[u++],e.next=15;break;case 11:if(!(u=s.next()).done){e.next=14;break}return e.abrupt("break",19);case 14:c=u.value;case 15:"3DTILES"===(h=c).type&&(r=h.id);case 17:e.next=5;break;case 19:return e.next=21,f(t,r);case 21:return l=e.sent,d=l.type,y=l.url,Object(a.a)("3DTILES"===d&&y),l.headers={Authorization:"Bearer "+l.accessToken},e.abrupt("return",l);case 26:case"end":return e.stop()}},e)}))).apply(this,arguments)}function p(e){return d.apply(this,arguments)}function d(){return(d=u(i.a.mark(function e(t){var r,n,o;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return Object(a.a)(t),r=c,n={Authorization:"Bearer "+t},e.next=5,fetch(r,{headers:n});case 5:if((o=e.sent).ok){e.next=12;break}return e.t0=Error,e.next=10,Object(s.a)(o);case 10:throw e.t1=e.sent,new e.t0(e.t1);case 12:return e.next=14,o.json();case 14:return e.abrupt("return",e.sent);case 15:case"end":return e.stop()}},e)}))).apply(this,arguments)}function f(e,t){return y.apply(this,arguments)}function y(){return(y=u(i.a.mark(function e(t,r){var n,o,u;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return Object(a.a)(t,r),n=c+"/"+r+"/endpoint",o={Authorization:"Bearer "+t},e.next=5,fetch(n,{headers:o});case 5:if((u=e.sent).ok){e.next=12;break}return e.t0=Error,e.next=10,Object(s.a)(u);case 10:throw e.t1=e.sent,new e.t0(e.t1);case 12:return e.next=14,u.json();case 14:return e.abrupt("return",e.sent);case 15:case"end":return e.stop()}},e)}))).apply(this,arguments)}},645:function(e,t,r){"use strict";r.d(t,"a",function(){return a});var n=r(477),i=["png","jpg","jpeg","gif","webp","bmp","ico","svg"],a=(n.a&&n.d,"undefined"!=typeof Image&&n.c,n.e,{extensions:i,loadAndParse:n.c})},646:function(e,t,r){"use strict";r(32),r(10),r(7),r(132),r(3),r(5),r(6),r(8),r(343),r(39),r(4);var n=r(294),i=r.n(n),a=(r(297),r(623)),s=r(555),o=r(384),u=r(653),c=r(309),h=r(337),l=(r(78),"Queued Requests"),p="Active Requests",d="Cancelled Requests",f="Queued Requests Ever",y="Active Requests Ever",m={id:"request-scheduler",throttleRequests:!0,maxRequests:6},v=function(){function e(e){void 0===e&&(e={}),this.props=Object.assign({},e,{},m),this.requestQueue=[],this.activeRequestCount=0,this.stats=new u.a({id:e.id}),this.stats.get(l),this.stats.get(p),this.stats.get(d),this.stats.get(f),this.stats.get(y)}var t=e.prototype;return t.scheduleRequest=function(e,t){var r=this;if(void 0===t&&(t=function(){return 0}),!this.props.throttleRequests)return Promise.resolve(e);var n=new Promise(function(n,i){r.requestQueue.push({handle:e,callback:t,resolve:n,reject:i})});return this._issueNewRequests(),n},t.startRequest=function(e){this.activeRequestCount++},t.endRequest=function(e){this.activeRequestCount--,this._issueNewRequests()},t.trackRequestPromise=function(e,t){var r=this;this.startRequest(e),t.then(function(){return r.endRequest(e)}).catch(function(){return r.endRequest(e)})},t._issueNewRequests=function(){var e=this;this._updateNeeded=!0,setTimeout(function(){return e._issueNewRequestsAsync()},0)},t._issueNewRequestsAsync=function(){this._updateNeeded=!1;var e=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(0!==e){this._updateAllRequests();for(var t=0;t<e;++t){if(this.requestQueue.length>0)this.requestQueue.shift().resolve(!0)}}},t._updateAllRequests=function(){for(var e=this.requestQueue,t=0;t<e.length;++t){var r=e[t];this._updateRequest(r)||(e.splice(t,1),t--)}e.sort(function(e,t){return e.priority-t.priority})},t._updateRequest=function(e){return e.priority=e.callback(e.handle),!(e.priority<0)||(e.resolve(!1),!1)},e}(),_=r(317);function g(e,t){Object(_.a)(e),Object(_.a)(t);var r=t.rtcCenter,n=t.rotateYtoZ,i=e.computedTransform,u=e._boundingVolume.center,c=new a.a(i);if(r&&c.translate(r),n){var h=(new a.a).rotateX(Math.PI/2);c=c.multiplyRight(h)}t.isQuantized&&c.translate(t.quantizedVolumeOffset).scale(t.quantizedVolumeScale);var l=new s.a(u);t.cartesianModelMatrix=c,t.cartesianOrigin=l;var p=o.a.WGS84.cartesianToCartographic(l,new s.a),d=o.a.WGS84.eastNorthUpToFixedFrame(l).invert();t.cartographicModelMatrix=d.multiplyRight(c),t.cartographicOrigin=p,t.modelMatrix=t.cartographicModelMatrix}r(303),r(131),r(291);var T=r(400),b=r(335),I=r(318),E={COMPOSITE:"cmpt",POINT_CLOUD:"pnts",BATCHED_3D_MODEL:"b3dm",INSTANCED_3D_MODEL:"i3dm",GEOMETRY:"geom",VECTOR:"vect"},w=(Object.keys(E),{UNLOADED:0,LOADING:1,PROCESSING:2,READY:3,EXPIRED:4,FAILED:5}),S={NOT_COMPUTED:-1,USE_OPTIMIZATION:1,SKIP_OPTIMIZATION:0},O=0,x=1;r(293);function A(e,t,r){Object(_.a)(e instanceof ArrayBuffer);var n=new TextDecoder("utf8"),i=new Uint8Array(e,t,r);return n.decode(i)}function N(e,t){void 0===t&&(t=0);var r=new DataView(e);return""+String.fromCharCode(r.getUint8(t+0))+String.fromCharCode(r.getUint8(t+1))+String.fromCharCode(r.getUint8(t+2))+String.fromCharCode(r.getUint8(t+3))}var C,D={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130},L=Object.assign({},{POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},{},D),P=(r(24),r(319),r(320),r(321),r(312),r(315),r(299),r(363),(C={})[D.DOUBLE]=Float64Array,C[D.FLOAT]=Float32Array,C[D.UNSIGNED_SHORT]=Uint16Array,C[D.UNSIGNED_INT]=Uint32Array,C[D.UNSIGNED_BYTE]=Uint8Array,C[D.BYTE]=Int8Array,C[D.SHORT]=Int16Array,C[D.INT]=Int32Array,C),M={DOUBLE:D.DOUBLE,FLOAT:D.FLOAT,UNSIGNED_SHORT:D.UNSIGNED_SHORT,UNSIGNED_INT:D.UNSIGNED_INT,UNSIGNED_BYTE:D.UNSIGNED_BYTE,BYTE:D.BYTE,SHORT:D.SHORT,INT:D.INT},R=function(){function e(){}return e.fromTypedArray=function(e){for(var t in e=ArrayBuffer.isView(e)?e.constructor:e,P){if(P[t]===e)return t}throw new Error("Failed to convert GL type")},e.fromName=function(e){var t=M[e];if(!t)throw new Error("Failed to convert GL type");return t},e.getArrayType=function(e,t){switch(void 0===t&&(t=!1),e){case D.UNSIGNED_SHORT_5_6_5:case D.UNSIGNED_SHORT_4_4_4_4:case D.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;default:var r=P[e];if(!r)throw new Error("Failed to convert GL type");return r}},e.getByteSize=function(t){return e.getArrayType(t).BYTES_PER_ELEMENT},e.validate=function(t){return Boolean(e.getArrayType(t))},e.createTypedArray=function(t,r,n,i){return void 0===n&&(n=0),void 0===i&&(i=(r.byteLength-n)/e.getByteSize(t)),new(e.getArrayType(t))(r,n,i)},e}(),k=function(){function e(e,t){this.json=e,this.buffer=t,this.featuresLength=0,this._cachedTypedArrays={}}var t=e.prototype;return t.getExtension=function(e){return this.json.extensions&&this.json.extensions[e]},t.hasProperty=function(e){return Boolean(this.json[e])},t.getGlobalProperty=function(e,t,r){void 0===t&&(t=L.UNSIGNED_INT),void 0===r&&(r=1);var n=this.json[e];return n&&Number.isFinite(n.byteOffset)?this._getTypedArrayFromBinary(e,t,r,1,n.byteOffset):n},t.getPropertyArray=function(e,t,r){var n=this.json[e];return n&&Number.isFinite(n.byteOffset)?("componentType"in n&&(t=R.fromName(n.componentType)),this._getTypedArrayFromBinary(e,t,r,this.featuresLength,n.byteOffset)):this._getTypedArrayFromArray(e,t,n)},t.getProperty=function(e,t,r,n,i){var a=this.json[e];if(!a)return a;var s=this.getPropertyArray(e,t,r);if(1===r)return s[n];for(var o=0;o<r;++o)i[o]=s[r*n+o];return i},t._getTypedArrayFromBinary=function(e,t,r,n,i){var a=this._cachedTypedArrays,s=a[e];return s||(s=R.createTypedArray(t,this.buffer.buffer,this.buffer.byteOffset+i,n*r),a[e]=s),s},t._getTypedArrayFromArray=function(e,t,r){var n=this._cachedTypedArrays,i=n[e];return i||(i=R.createTypedArray(t,r),n[e]=i),i},e}(),U=(r(55),r(76),{SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16}),B={SCALAR:function(e,t){return e[t]},VEC2:function(e,t){return[e[2*t+0],e[2*t+1]]},VEC3:function(e,t){return[e[3*t+0],e[3*t+1],e[3*t+2]]},VEC4:function(e,t){return[e[4*t+0],e[4*t+1],e[4*t+2],e[4*t+3]]},MAT2:function(e,t){return[e[4*t+0],e[4*t+1],e[4*t+2],e[4*t+3]]},MAT3:function(e,t){return[e[9*t+0],e[9*t+1],e[9*t+2],e[9*t+3],e[9*t+4],e[9*t+5],e[9*t+6],e[9*t+7],e[9*t+8]]},MAT4:function(e,t){return[e[16*t+0],e[16*t+1],e[16*t+2],e[16*t+3],e[16*t+4],e[16*t+5],e[16*t+6],e[16*t+7],e[16*t+8],e[16*t+9],e[16*t+10],e[16*t+11],e[16*t+12],e[16*t+13],e[16*t+14],e[16*t+15]]}},V={SCALAR:function(e,t,r){t[r]=e},VEC2:function(e,t,r){t[2*r+0]=e[0],t[2*r+1]=e[1]},VEC3:function(e,t,r){t[3*r+0]=e[0],t[3*r+1]=e[1],t[3*r+2]=e[2]},VEC4:function(e,t,r){t[4*r+0]=e[0],t[4*r+1]=e[1],t[4*r+2]=e[2],t[4*r+3]=e[3]},MAT2:function(e,t,r){t[4*r+0]=e[0],t[4*r+1]=e[1],t[4*r+2]=e[2],t[4*r+3]=e[3]},MAT3:function(e,t,r){t[9*r+0]=e[0],t[9*r+1]=e[1],t[9*r+2]=e[2],t[9*r+3]=e[3],t[9*r+4]=e[4],t[9*r+5]=e[5],t[9*r+6]=e[6],t[9*r+7]=e[7],t[9*r+8]=e[8],t[9*r+9]=e[9]},MAT4:function(e,t,r){t[16*r+0]=e[0],t[16*r+1]=e[1],t[16*r+2]=e[2],t[16*r+3]=e[3],t[16*r+4]=e[4],t[16*r+5]=e[5],t[16*r+6]=e[6],t[16*r+7]=e[7],t[16*r+8]=e[8],t[16*r+9]=e[9],t[16*r+10]=e[10],t[16*r+11]=e[11],t[16*r+12]=e[12],t[16*r+13]=e[13],t[16*r+14]=e[14],t[16*r+15]=e[15]}};r(329);function z(e){throw new Error('"'+e+'" is read-only')}var q=function(e){return void 0!==e};function G(e,t,r){if(!t)return null;var n=e.getExtension("3DTILES_batch_table_hierarchy"),i=t.HIERARCHY;return i&&(console.warn("3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy."),t.extensions=t.extensions||{},t.extensions["3DTILES_batch_table_hierarchy"]=i,n=i),n?function(e,t){var r,n,i,a,s=e.instancesLength,o=e.classes,u=e.classIds,c=e.parentCounts,h=e.parentIds,l=s;q(u.byteOffset)&&(u.componentType=defaultValue(u.componentType,GL.UNSIGNED_SHORT),u.type=AttributeType.SCALAR,i=getBinaryAccessor(u),z("classIds"),u=i.createArrayBufferView(t.buffer,t.byteOffset+u.byteOffset,s));if(q(c))for(q(c.byteOffset)&&(c.componentType=defaultValue(c.componentType,GL.UNSIGNED_SHORT),c.type=AttributeType.SCALAR,i=getBinaryAccessor(c),z("parentCounts"),c=i.createArrayBufferView(t.buffer,t.byteOffset+c.byteOffset,s)),a=new Uint16Array(s),z("parentIdsLength"),l=0,r=0;r<s;++r)a[r]=l,l+=(z("parentIdsLength"),c[r]);q(h)&&q(h.byteOffset)&&(h.componentType=defaultValue(h.componentType,GL.UNSIGNED_SHORT),h.type=AttributeType.SCALAR,i=getBinaryAccessor(h),z("parentIds"),h=i.createArrayBufferView(t.buffer,t.byteOffset+h.byteOffset,l));var p=o.length;for(r=0;r<p;++r){var d=o[r].length,f=o[r].instances,y=getBinaryProperties(d,f,t);o[r].instances=combine(y,f)}var m=new Array(p).fill(0),v=new Uint16Array(s);for(r=0;r<s;++r)n=u[r],v[r]=m[n],++m[n];var _={classes:o,classIds:u,classIndexes:v,parentCounts:c,parentIndexes:a,parentIds:h};return function(e){for(var t=e.classIds.length,r=0;r<t;++r)F(e,r,stack)}(_),_}(n,r):null}function j(e,t,r){if(e){var n=e.parentCounts;return e.parentIds?r(e,t):n>0?function(e,t,r){var n=e.classIds,i=e.parentCounts,a=e.parentIds,s=e.parentIndexes,o=n.length,u=scratchVisited;u.length=Math.max(u.length,o);var c=++marker,h=scratchStack;h.length=0,h.push(t);for(;h.length>0;)if(t=h.pop(),u[t]!==c){u[t]=c;var l=r(e,t);if(q(l))return l;for(var p=i[t],d=s[t],f=0;f<p;++f){var y=a[d+f];y!==t&&h.push(y)}}return null}(e,t,r):function(e,t,r){var n=!0;for(;n;){var i=r(e,t);if(q(i))return i;var a=e.parentIds[t];n=a!==t,t=a}throw new Error("traverseHierarchySingleParent")}(e,t,r)}}function F(e,t,r){var n=e.parentCounts,i=e.parentIds,a=e.parentIndexes,s=e.classIds.length;if(q(i)){assert(t<s,"Parent index "+t+" exceeds the total number of instances: "+s),assert(-1===r.indexOf(t),"Circular dependency detected in the batch table hierarchy."),r.push(t);for(var o=q(n)?n[t]:1,u=q(n)?a[t]:t,c=0;c<o;++c){var h=i[u+c];h!==t&&F(e,h,r)}r.pop(t)}}function H(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var J=function(e){return void 0!==e},Y=function(e){return e},W={HIERARCHY:!0,extensions:!0,extras:!0},Q=function(){function e(e,t,r,n){for(var i in void 0===n&&(n={}),Object(h.a)(r>=0),this.json=e||{},this.binary=t,this.featureCount=r,this._extensions=this.json&&this.json.extensions||{},this._properties={},this.json)W[i]||(this._properties[i]=this.json[i]);this._binaryProperties=this._initializeBinaryProperties(),n["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=G(this,this.json,this.binary))}var t=e.prototype;return t.getExtension=function(e){return this.json&&this.json.extensions&&this.json.extensions[e]},t.memorySizeInBytes=function(){return 0},t.isClass=function(e,t){if(this._checkBatchId(e),Object(h.a)("string"==typeof t,t),this._hierarchy){var r=j(this._hierarchy,e,function(e,r){var n=e.classIds[r];return e.classes[n].name===t});return J(r)}return!1},t.isExactClass=function(e,t){return Object(h.a)("string"==typeof t,t),this.getExactClassName(e)===t},t.getExactClassName=function(e){if(this._checkBatchId(e),this._hierarchy){var t=this._hierarchy.classIds[e];return this._hierarchy.classes[t].name}},t.hasProperty=function(e,t){return this._checkBatchId(e),Object(h.a)("string"==typeof t,t),J(this._properties[t])||this._hasPropertyInHierarchy(e,t)},t.getPropertyNames=function(e,t){var r;this._checkBatchId(e),(t=J(t)?t:[]).length=0;var n=Object.keys(this._properties);return(r=t).push.apply(r,H(n)),this._hierarchy&&this._getPropertyNamesInHierarchy(e,t),t},t.getProperty=function(e,t){if(this._checkBatchId(e),Object(h.a)("string"==typeof t,t),this._binaryProperties){var r=this._binaryProperties[t];if(J(r))return this._getBinaryProperty(r,e)}var n=this._properties[t];if(J(n))return Y(n[e]);if(this._hierarchy){var i=this._getHierarchyProperty(e,t);if(J(i))return i}},t.setProperty=function(e,t,r){var n=this.featureCount;if(this._checkBatchId(e,n),Object(h.a)("string"==typeof t,t),this._binaryProperties){var i=this._binaryProperties[t];if(i)return void this._setBinaryProperty(i,e,r)}if(!this._hierarchy||!this._setHierarchyProperty(this,e,t,r)){var a=this._properties[t];J(a)||(this._properties[t]=new Array(n),a=this._properties[t]),a[e]=Y(r)}},t._checkBatchId=function(e){if(!(e>=0&&e<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")},t._getBinaryProperty=function(e,t){return e.unpack(e.typedArray,t)},t._setBinaryProperty=function(e,t,r){e.pack(r,e.typedArray,t)},t._initializeBinaryProperties=function(){var e=null;for(var t in this._properties){var r=this._properties[t],n=this._initializeBinaryProperty(t,r);n&&((e=e||{})[t]=n)}return e},t._initializeBinaryProperty=function(e,t){if("byteOffset"in t){var r=t;Object(h.a)(this.binary,"Property "+e+" requires a batch table binary."),Object(h.a)(r.type,"Property "+e+" requires a type.");var n=function(e,t,r,n){var i=e.componentType;Object(h.a)(e.componentType);var a="string"==typeof i?R.fromName(i):i,s=U[e.type],o=B[e.type],u=V[e.type];return r+=e.byteOffset,{values:R.createTypedArray(a,t,r,s*n),type:a,size:s,unpacker:o,packer:u}}(r,this.binary.buffer,0|this.binary.byteOffset,this.featureCount);return{typedArray:n.values,componentCount:n.size,unpack:n.unpacker,pack:n.packer}}return null},t._hasPropertyInHierarchy=function(e,t){if(!this._hierarchy)return!1;var r=j(this._hierarchy,e,function(e,r){var n=e.classIds[r],i=e.classes[n].instances;return J(i[t])});return J(r)},t._getPropertyNamesInHierarchy=function(e,t){j(this._hierarchy,e,function(e,r){var n=e.classIds[r],i=e.classes[n].instances;for(var a in i)i.hasOwnProperty(a)&&-1===t.indexOf(a)&&t.push(a)})},t._getHierarchyProperty=function(e,t){var r=this;return j(this._hierarchy,e,function(e,n){var i=e.classIds[n],a=e.classes[i],s=e.classIndexes[n],o=a.instances[t];return J(o)?J(o.typedArray)?r._getBinaryProperty(o,s):Y(o[s]):null})},t._setHierarchyProperty=function(e,t,r,n){var i=this,a=j(this._hierarchy,t,function(e,a){var s=e.classIds[a],o=e.classes[s],u=e.classIndexes[a],c=o.instances[r];return!!J(c)&&(Object(h.a)(a===t,'Inherited property "'+r+'" is read-only.'),J(c.typedArray)?i._setBinaryProperty(c,u,n):c[u]=Y(n),!0)});return J(a)},e}(),Z=4;function K(e,t,r){void 0===r&&(r=0);var n=new DataView(t);if(e.magic=n.getUint32(r,!0),r+=Z,e.version=n.getUint32(r,!0),r+=Z,e.byteLength=n.getUint32(r,!0),r+=Z,1!==e.version)throw new Error("3D Tile Version "+e.version+" not supported");return r}var X=4;function $(e,t,r){var n=new DataView(t);return e.featureTableJsonByteLength=n.getUint32(r,!0),r+=X,e.featureTableBinaryByteLength=n.getUint32(r,!0),r+=X,e.batchTableJsonByteLength=n.getUint32(r,!0),r+=X,e.batchTableBinaryByteLength=n.getUint32(r,!0),r+=X}function ee(e,t,r,n){return r=function(e,t,r,n){var i=e.featureTableJsonByteLength,a=e.featureTableBinaryByteLength;if(e.featureTableJson={BATCH_LENGTH:0},i>0){var s=A(t,r,i);e.featureTableJson=JSON.parse(s)}return r+=i,e.featureTableBinary=new Uint8Array(t,r,a),r+=a}(e,t,r),r=function(e,t,r,n){var i=e.batchTableJsonByteLength,a=e.batchTableBinaryByteLength;if(i>0){var s=A(t,r,i);e.batchTableJson=JSON.parse(s),r+=i,a>0&&(e.batchTableBinary=new Uint8Array(t,r,a),e.batchTableBinary=new Uint8Array(e.batchTableBinary),r+=a)}return r}(e,t,r)}r(365);function te(e,t){void 0===t&&(t=[0,0,0]);var r=e>>11&31,n=e>>5&63,i=31&e;return t[0]=r<<3,t[1]=n<<2,t[2]=i<<3,t}function re(e,t,r){if(!(t||e&&e.batchIds&&r))return null;var n=e.batchIds,i=e.isRGB565,a=e.pointCount;if(n&&r){for(var s=new Uint8ClampedArray(3*a),o=0;o<a;o++){var u=n[o],c=r.getProperty(u,"dimensions").map(function(e){return 255*e});s[3*o]=c[0],s[3*o+1]=c[1],s[3*o+2]=c[2]}return{size:3,value:s}}if(i){for(var h=new Uint8ClampedArray(3*a),l=0;l<a;l++){var p=te(t[l]);h[3*l]=p[0],h[3*l+1]=p[1],h[3*l+2]=p[2]}return{size:3,value:h}}return t&&t.length===3*a?{size:3,value:t}:{size:4,value:t}}var ne=r(639),ie=r(342);r(637);function ae(e,t){if(!e)throw new Error("math.gl assertion failed. "+t)}new ne.a,new s.a,new ne.a,new ne.a,new Uint8Array(1);function se(e,t){return void 0===t&&(t=255),Object(ie.a)(e,0,t)/t*2-1}function oe(e){return e<0?-1:1}function ue(e,t,r,n){if(ae(n),e<0||e>r||t<0||t>r)throw new Error("x and y must be unsigned normalized integers between 0 and "+r);if(n.x=se(e,r),n.y=se(t,r),n.z=1-(Math.abs(n.x)+Math.abs(n.y)),n.z<0){var i=n.x;n.x=(1-Math.abs(n.y))*oe(i),n.y=(1-Math.abs(i))*oe(n.y)}return n.normalize()}function ce(e,t,r){return ue(e,t,255,r)}var he=new s.a;function le(e,t,r){return e.isQuantized?r.decodeQuantizedPositions?(e.isQuantized=!1,function(e,t){for(var r=new s.a,n=new Float32Array(3*e.pointCount),i=0;i<e.pointCount;i++)r.set(t[3*i],t[3*i+1],t[3*i+2]).scale(1/e.quantizedRange).multiply(e.quantizedVolumeScale).add(e.quantizedVolumeOffset).toArray(n,3*i);return n}(e,t)):{type:L.UNSIGNED_SHORT,value:t,size:3,normalized:!0}:t}function pe(e,t,r,n,i,a,s){try{var o=e[a](s),u=o.value}catch(c){return void r(c)}o.done?t(u):Promise.resolve(u).then(n,i)}function de(e){return function(){var t=this,r=arguments;return new Promise(function(n,i){var a=e.apply(t,r);function s(e){pe(a,n,i,s,o,"next",e)}function o(e){pe(a,n,i,s,o,"throw",e)}s(void 0)})}}function fe(e,t,r,n){return ye.apply(this,arguments)}function ye(){return(ye=de(i.a.mark(function e(t,r,n,a){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=K(t,r,n),n=$(t,r,n),n=ee(t,r,n),e.next=5,ve(t,a);case 5:return e.abrupt("return",n);case 6:case"end":return e.stop()}},e)}))).apply(this,arguments)}function me(e,t,r,n){return r=ee(e,t,r=$(e,t,r=K(e,t,r))),function(e,t){ge(e);var r=Te(e).featureTable;be(e,r,t),Ie(e,r,t),Ee(e,r)}(e,n),r}function ve(e,t){return _e.apply(this,arguments)}function _e(){return(_e=de(i.a.mark(function e(t,r){var n,a,s;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return ge(t),n=Te(t),a=n.featureTable,s=n.batchTable,e.next=4,we(t,a,s,r);case 4:be(t,a,r),Ie(t,a,s),Ee(t,a);case 7:case"end":return e.stop()}},e)}))).apply(this,arguments)}function ge(e){e.attributes={positions:null,colors:null,normals:null,batchIds:null},e.isQuantized=!1,e.isTranslucent=!1,e.isRGB565=!1,e.isOctEncoded16P=!1}function Te(e){var t=new k(e.featureTableJson,e.featureTableBinary),r=t.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(r))throw new Error("POINTS_LENGTH must be defined");t.featuresLength=r,e.featuresLength=r,e.pointsLength=r,e.pointCount=r,e.rtcCenter=t.getGlobalProperty("RTC_CENTER",L.FLOAT,3);var n=function(e,t){var r=null;if(!e.batchIds&&t.hasProperty("BATCH_ID")&&(e.batchIds=t.getPropertyArray("BATCH_ID",L.UNSIGNED_SHORT,1),e.batchIds)){var n=t.getGlobalProperty("BATCH_LENGTH");if(!n)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");var i=e.batchTableJson,a=e.batchTableBinary;r=new Q(i,a,n)}return r}(e,t);return{featureTable:t,batchTable:n}}function be(e,t,r){if(!e.attributes.positions)if(t.hasProperty("POSITION"))e.attributes.positions=t.getPropertyArray("POSITION",L.FLOAT,3);else if(t.hasProperty("POSITION_QUANTIZED")){var n=t.getPropertyArray("POSITION_QUANTIZED",L.UNSIGNED_SHORT,3);if(e.isQuantized=!0,e.quantizedRange=65535,e.quantizedVolumeScale=t.getGlobalProperty("QUANTIZED_VOLUME_SCALE",L.FLOAT,3),!e.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(e.quantizedVolumeOffset=t.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",L.FLOAT,3),!e.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");e.attributes.positions=le(e,n,r)}if(!e.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}function Ie(e,t,r){if(!e.attributes.colors){var n=null;t.hasProperty("RGBA")?(n=t.getPropertyArray("RGBA",L.UNSIGNED_BYTE,4),e.isTranslucent=!0):t.hasProperty("RGB")?n=t.getPropertyArray("RGB",L.UNSIGNED_BYTE,3):t.hasProperty("RGB565")&&(n=t.getPropertyArray("RGB565",L.UNSIGNED_SHORT,1),e.isRGB565=!0),e.attributes.colors=re(e,n,r)}t.hasProperty("CONSTANT_RGBA")&&(e.constantRGBA=t.getGlobalProperty("CONSTANT_RGBA",L.UNSIGNED_BYTE,4))}function Ee(e,t){if(!e.attributes.normals){var r=null;t.hasProperty("NORMAL")?r=t.getPropertyArray("NORMAL",L.FLOAT,3):t.hasProperty("NORMAL_OCT16P")&&(r=t.getPropertyArray("NORMAL_OCT16P",L.UNSIGNED_BYTE,2),e.isOctEncoded16P=!0),e.attributes.normals=function(e,t){if(e.isOctEncoded16P){for(var r=new Float32Array(3*e.pointsLength),n=0;n<e.pointsLength;n++)ce(t[2*n],t[2*n+1],he),he.toArray(r,3*n);return r}return t}(e,r)}}function we(e,t,r,n){return Se.apply(this,arguments)}function Se(){return(Se=de(i.a.mark(function e(t,r,n,a){var s,o,u,c,h,l,p,d;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((c=n&&n.getExtension("3DTILES_draco_point_compression"))&&(u=c.properties),!(h=r.getExtension("3DTILES_draco_point_compression"))){e.next=15;break}if(o=h.properties,l=h.byteOffset,p=h.byteLength,o&&Number.isFinite(l)&&p){e.next=9;break}throw new Error("Draco properties, byteOffset, and byteLength must be defined");case 9:s=t.featureTableBinary.slice(l,l+p),t.hasPositions=Number.isFinite(o.POSITION),t.hasColors=Number.isFinite(o.RGB)||Number.isFinite(o.RGBA),t.hasNormals=Number.isFinite(o.NORMAL),t.hasBatchIds=Number.isFinite(o.BATCH_ID),t.isTranslucent=Number.isFinite(o.RGBA);case 15:if(!s){e.next=19;break}return d={buffer:s,properties:Object.assign({},o,{},u),featureTableProperties:o,batchTableProperties:u,dequantizeInShader:!1},e.next=19,Oe(t,d,a);case 19:case"end":return e.stop()}},e)}))).apply(this,arguments)}function Oe(e,t,r){return xe.apply(this,arguments)}function xe(){return(xe=de(i.a.mark(function e(t,r,n){var a,o,u,c,l,p,d,f,y;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return Object(h.a)(n.DracoLoader),e.next=3,Object(I.a)(r.buffer,n.DracoLoader);case 3:a=e.sent,o=a.attributes.POSITION&&a.attributes.POSITION.value,u=a.attributes.COLOR_0&&a.attributes.COLOR_0.value,c=a.attributes.NORMAL&&a.attributes.NORMAL.value,l=a.attributes.BATCH_ID&&a.attributes.BATCH_ID.value,p=o&&a.attributes.POSITION.value.quantization,d=c&&a.attributes.NORMAL.value.quantization,p&&(f=a.POSITION.data.quantization,y=f.range,t.quantizedVolumeScale=new s.a(y,y,y),t.quantizedVolumeOffset=new s.a(f.minValues),t.quantizedRange=(1<<f.quantizationBits)-1,t.isQuantizedDraco=!0),d&&(t.octEncodedRange=(1<<a.NORMAL.data.quantization.quantizationBits)-1,t.isOctEncodedDraco=!0),t.attributes={positions:o,colors:re(t,u),normals:c,batchIds:l};case 13:case"end":return e.stop()}},e)}))).apply(this,arguments)}r(12);var Ae={URI:0,EMBEDDED:1};function Ne(e,t,r){var n=e.byteOffset+e.byteLength-r;if(0===n)throw new Error("glTF byte length must be greater than 0.");var i=new Uint8Array(t).subarray(r,r+n),a=new Uint8Array(i);return e.gltfArrayBuffer=a.buffer,e.gltfByteOffset=0,e.gltfByteLength=n,e.rotateYtoZ=!0,e.byteOffset+e.byteLength}function Ce(e,t,r){switch(t){case Ae.URI:var n=new Uint8Array(e.gltfArrayBuffer,e.gltfByteOffset),i=(new TextDecoder).decode(n);e.gltfUrl=i.replace(/[\s\0]+$/,"");break;case Ae.EMBEDDED:e.gltf={};break;default:throw new Error("i3dm: glTF format "+t+": Must be 0 (uri) or 1 (embedded)")}}function De(e,t,r,n,i,a,s){try{var o=e[a](s),u=o.value}catch(c){return void r(c)}o.done?t(u):Promise.resolve(u).then(n,i)}function Le(e,t,r,n){return Pe.apply(this,arguments)}function Pe(){var e;return e=i.a.mark(function e(t,r,n,a){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Me(t,r,n,a));case 1:case"end":return e.stop()}},e)}),(Pe=function(){var t=this,r=arguments;return new Promise(function(n,i){var a=e.apply(t,r);function s(e){De(a,n,i,s,o,"next",e)}function o(e){De(a,n,i,s,o,"throw",e)}s(void 0)})}).apply(this,arguments)}function Me(e,t,r,n){r=Ne(e,t,r=ee(e,t,r=$(e,t,r=K(e,t,r))));var i=new k(e.featureTableJson,e.featureTableBinary);return e.rtcCenter=i.getGlobalProperty("RTC_CENTER",L.FLOAT,3),Ce(e,Ae.EMBEDDED),r}var Re=r(638),ke=r(658);function Ue(e,t,r,n,i,a,s){try{var o=e[a](s),u=o.value}catch(c){return void r(c)}o.done?t(u):Promise.resolve(u).then(n,i)}function Be(e,t,r,n){return Ve.apply(this,arguments)}function Ve(){var e;return e=i.a.mark(function e(t,r,n,a){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",ze(t,r,n,a));case 1:case"end":return e.stop()}},e)}),(Ve=function(){var t=this,r=arguments;return new Promise(function(n,i){var a=e.apply(t,r);function s(e){Ue(a,n,i,s,o,"next",e)}function o(e){Ue(a,n,i,s,o,"throw",e)}s(void 0)})}).apply(this,arguments)}function ze(e,t,r,n){if(r=K(e,t,r),1!==e.version)throw new Error("Instanced 3D Model version "+e.version+" is not supported");r=$(e,t,r);var i=new DataView(t);if(e.gltfFormat=i.getUint32(r,!0),r=Ne(e,t,r=ee(e,t,r+=4)),0===e.featureTableJsonByteLength)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");var u=new k(e.featureTableJson,e.featureTableBinary),c=u.getGlobalProperty("INSTANCES_LENGTH");if(u.featuresLength=c,!Number.isFinite(c))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");e.eastNorthUp=u.getGlobalProperty("EAST_NORTH_UP"),e.rtcCenter=u.getGlobalProperty("RTC_CENTER",L.FLOAT,3);new Q(e.batchTableJson,e.batchTableBinary,c);return Ce(e,e.gltfFormat),function(e,t,r,n){for(var i=[new Array(n),e._batchTable][0],u=new s.a,c=(new s.a,new s.a,new s.a,new Re.a),h=new ke.a,l=new s.a,p={},d=new a.a,f=[],y=[],m=new s.a,v=new s.a,_=0;_<n;_++){var g=void 0;if(t.hasProperty("POSITION"))g=t.getProperty("POSITION",L.FLOAT,3,_,u);else if(t.hasProperty("POSITION_QUANTIZED")){g=t.getProperty("POSITION_QUANTIZED",L.UNSIGNED_SHORT,3,_,u);var T=t.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",L.FLOAT,3,m);if(!T)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");var b=t.getGlobalProperty("QUANTIZED_VOLUME_SCALE",L.FLOAT,3,v);if(!b)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");for(var I=0;I<3;I++)g[I]=g[I]/65535*b[I]+T[I]}if(!g)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");u.copy(g),p.translation=u,e.normalUp=t.getProperty("NORMAL_UP",L.FLOAT,3,_,f),e.normalRight=t.getProperty("NORMAL_RIGHT",L.FLOAT,3,_,y);if(e.normalUp){if(!e.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");e.hasCustomOrientation=!0}else{if(e.octNormalUp=t.getProperty("NORMAL_UP_OCT32P",L.UNSIGNED_SHORT,2,f),e.octNormalRight=t.getProperty("NORMAL_RIGHT_OCT32P",L.UNSIGNED_SHORT,2,y),e.octNormalUp){if(!e.octNormalRight)throw new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");throw new Error("i3dm: oct-encoded orientation not implemented")}e.eastNorthUp?(o.a.WGS84.eastNorthUpToFixedFrame(u,d),d.getRotationMatrix3(c)):c.identity()}!1,h.fromMatrix3(c),p.rotation=h,l.set(1,1,1);var E=t.getProperty("SCALE",L.FLOAT,1,_);Number.isFinite(E)&&l.multiplyByScalar(E);var w=t.getProperty("SCALE_NON_UNIFORM",L.FLOAT,3,_,f);w&&l.scale(w),p.scale=l;var S=t.getProperty("BATCH_ID",L.UNSIGNED_SHORT,1,_);void 0===S&&(S=_);var O=(new a.a).fromQuaternion(p.rotation);d.identity(),d.translate(p.translation),d.multiplyRight(O),d.scale(p.scale);var x=d.clone();i[_]={modelMatrix:x,batchId:S}}e.instances=i}(e,u,0,c),r}function qe(e,t,r,n,i,a,s){try{var o=e[a](s),u=o.value}catch(c){return void r(c)}o.done?t(u):Promise.resolve(u).then(n,i)}function Ge(e,t,r,n,i){return je.apply(this,arguments)}function je(){var e;return e=i.a.mark(function e(t,r,n,a,s){var o,u;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=K(t,r,n),o=new DataView(r),t.tilesLength=o.getUint32(n,!0),n+=4,t.tiles=[];case 5:if(!(t.tiles.length<t.tilesLength&&t.byteLength-n>12)){e.next=13;break}return u={},t.tiles.push(u),e.next=10,s(r,n,a,u);case 10:n=e.sent,e.next=5;break;case 13:return e.abrupt("return",n);case 14:case"end":return e.stop()}},e)}),(je=function(){var t=this,r=arguments;return new Promise(function(n,i){var a=e.apply(t,r);function s(e){qe(a,n,i,s,o,"next",e)}function o(e){qe(a,n,i,s,o,"throw",e)}s(void 0)})}).apply(this,arguments)}function Fe(e,t,r,n,i,a,s){try{var o=e[a](s),u=o.value}catch(c){return void r(c)}o.done?t(u):Promise.resolve(u).then(n,i)}function He(e,t,r,n){return Je.apply(this,arguments)}function Je(){var e;return e=i.a.mark(function e(t,r,n,a){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:void 0===r&&(r=0),void 0===n&&(n={}),void 0===a&&(a={}),a.byteOffset=r,a.type=N(t,r),e.t0=a.type,e.next=e.t0===E.COMPOSITE?8:e.t0===E.BATCHED_3D_MODEL?11:e.t0===E.INSTANCED_3D_MODEL?14:e.t0===E.POINT_CLOUD?17:20;break;case 8:return e.next=10,Ge(a,t,r,n,He);case 10:return e.abrupt("return",e.sent);case 11:return e.next=13,Le(a,t,r,n);case 13:return e.abrupt("return",e.sent);case 14:return e.next=16,Be(a,t,r,n);case 16:return e.abrupt("return",e.sent);case 17:return e.next=19,fe(a,t,r,n);case 19:return e.abrupt("return",e.sent);case 20:throw new Error("3DTileLoader: unknown type "+a.type);case 21:case"end":return e.stop()}},e)}),(Je=function(){var t=this,r=arguments;return new Promise(function(n,i){var a=e.apply(t,r);function s(e){Fe(a,n,i,s,o,"next",e)}function o(e){Fe(a,n,i,s,o,"throw",e)}s(void 0)})}).apply(this,arguments)}function Ye(e,t,r,n){switch(void 0===t&&(t=0),void 0===r&&(r={}),void 0===n&&(n={}),n.byteOffset=t,n.type=N(e,t),n.type){case E.COMPOSITE:return function(e,t,r,n,i){r=K(e,t,r);var a=new DataView(t);for(e.tilesLength=a.getUint32(r,!0),r+=4,e.tiles=[];e.tiles.length<e.tilesLength&&e.byteLength-r>12;){var s={};e.tiles.push(s),r=i(t,r,n,s)}return r}(n,e,t,r,Ye);case E.BATCHED_3D_MODEL:return Me(n,e,t);case E.INSTANCED_3D_MODEL:return ze(n,e,t);case E.POINT_CLOUD:return me(n,e,t,r);default:throw new Error("3DTileLoader: unknown type "+n.type)}}function We(e,t,r,n,i,a,s){try{var o=e[a](s),u=o.value}catch(c){return void r(c)}o.done?t(u):Promise.resolve(u).then(n,i)}function Qe(){var e;return e=i.a.mark(function e(t,r,n,a){var s;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s={},e.next=4,He(t,0,r,s);case 4:return e.abrupt("return",s);case 5:case"end":return e.stop()}},e)}),(Qe=function(){var t=this,r=arguments;return new Promise(function(n,i){var a=e.apply(t,r);function s(e){We(a,n,i,s,o,"next",e)}function o(e){We(a,n,i,s,o,"throw",e)}s(void 0)})}).apply(this,arguments)}var Ze={name:"3D Tiles",extensions:["cmpt","pnts","b3dm","i3dm"],mimeType:"application/octet-stream",test:["cmpt","pnts","b3dm","i3dm"],parse:function(e,t,r,n){return Qe.apply(this,arguments)},parseSync:function(e,t,r,n){var i={};return Ye(e,0,t,i),i},binary:!0};function Ke(e,t,r,n,i,a,s){try{var o=e[a](s),u=o.value}catch(c){return void r(c)}o.done?t(u):Promise.resolve(u).then(n,i)}var Xe,$e,et={name:"3D Tileset",extensions:["json"],parse:(Xe=i.a.mark(function e(t){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",JSON.parse((new TextDecoder).decode(t)));case 1:case"end":return e.stop()}},e)}),$e=function(){var e=this,t=arguments;return new Promise(function(r,n){var i=Xe.apply(e,t);function a(e){Ke(i,r,n,a,s,"next",e)}function s(e){Ke(i,r,n,a,s,"throw",e)}a(void 0)})},function(e){return $e.apply(this,arguments)}),parseTextSync:JSON.parse,testText:function(e){return e.indexOf(!1)}};var tt=function(e){return void 0!==e},rt=(new Re.a,new s.a),nt=new s.a;new a.a;function it(e,t,r){if(Object(h.a)(e,"3D Tile: boundingVolume must be defined"),e.box)return function(e,t,r){var n=new s.a(e[0],e[1],e[2]),i=new Re.a(e.slice(3,e.length));if(t.transform(n,n),i=new Re.a(t[0],t[1],t[2],t[4],t[5],t[6],t[8],t[9],t[10]).multiplyRight(i),tt(r))return r.center=n,r.halfAxes=i,r;return new T.d(n,i)}(e.box,t,r);if(e.region){var n=e.region,i=n[0],u=n[1],c=n[2],l=n[3],p=n[4],d=n[5],f=new s.a(Object(ie.c)((i+c)/2),Object(ie.c)((l+u)/2),(p+d)/2),y=o.a.WGS84.cartographicToCartesian(f,nt),m=o.a.WGS84.cartographicToCartesian([l,i,0]),v=o.a.WGS84.cartographicToCartesian([l,c,0]),_=o.a.WGS84.cartographicToCartesian([u,i,0]),g=8*(Math.abs(v[0]-m[0])+Math.abs(_[1]-m[1]));return at([y[0],y[1],y[2],g],new a.a)}if(e.sphere)return at(e.sphere,t,r);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}function at(e,t,r){var n=new s.a(e[0],e[1],e[2]);t.transform(n,n);var i=t.getScale(rt),a=Math.max(Math.max(i[0],i[1]),i[2]),o=e[3]*a;return tt(r)?(r.center=n,r.radius=o,r):new T.a(n,o)}function st(e,t,r,n,i,a,s){try{var o=e[a](s),u=o.value}catch(c){return void r(c)}o.done?t(u):Promise.resolve(u).then(n,i)}function ot(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var ut=function(e){return null!=e},ct=new Date,ht=new s.a,lt=new T.e;var pt=function(){function e(e,t,r,n){Object(h.a)("object"==typeof t),this._tileset=e,this._header=t,this._basePath=n,this._content=null,this._contentState=w.UNLOADED,this._gpuMemoryUsageInBytes=0,this.parent=r,this.children=[],this.refine=this._getRefine(t.refine),this.cacheNode=void 0,this.userData={},"geometricError"in t?this.geometricError=t.geometricError:(this.geometricError=this.parent&&this.parent.geometricError||e.geometricError,console.warn("3D Tile: Required prop geometricError is undefined. Using parent error")),this._initializeTransforms(t),this._initializeBoundingVolumes(t),this._initializeContent(t),this._initializeCache(t),this._optimChildrenWithinParent=S.NOT_COMPUTED,this._initializeRenderingState(),Object.seal(this)}var t,r,n,s=e.prototype;return s.destroy=function(){this._header=null},s.isDestroyed=function(){return null===this._header},s.getScreenSpaceError=function(e,t){var r=this._tileset,n=this.parent&&this.parent.geometricError||r.geometricError,i=t?n:this.geometricError;if(0===i)return 0;var a=Math.max(this._distanceToCamera,1e-7),s=i*e.height/(a*e.sseDenominator);return s-=this._getDynamicScreenSpaceError(a)},s._getDynamicScreenSpaceError=function(e){var t=this._tileset;if(t.dynamicScreenSpaceError&&t._dynamicScreenSpaceErrorComputedDensity){var r=t._dynamicScreenSpaceErrorComputedDensity,n=t.dynamicScreenSpaceErrorFactor;return function(e,t){var r=e*t;return 1-Math.exp(-r*r)}(e,r)*n}return 0},s.loadContent=function(){var e=function(e){return function(){var t=this,r=arguments;return new Promise(function(n,i){var a=e.apply(t,r);function s(e){st(a,n,i,s,o,"next",e)}function o(e){st(a,n,i,s,o,"throw",e)}s(void 0)})}}(i.a.mark(function e(t){var r,n,a;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=function(e){return e._visible?e._contentState===w.UNLOADED?-1:Math.max(1e7-e._priority,0)||0:-1},!this.hasEmptyContent){e.next=3;break}return e.abrupt("return",!1);case 3:if(!this._content){e.next=5;break}return e.abrupt("return",!0);case 5:return this.contentExpired&&(this.expireDate=void 0),this._contentState=w.LOADING,e.next=10,this.tileset._requestScheduler.scheduleRequest(this,r);case 10:if(!!e.sent){e.next=15;break}return console.log("Tile load cancelled"),this._contentState=w.UNLOADED,e.abrupt("return",!1);case 15:return e.prev=15,n=this.uri,e.prev=17,this.tileset._requestScheduler.startRequest(this),e.next=21,Object(b.a)(n,this.tileset.options.fetchOptions);case 21:a=e.sent;case 22:return e.prev=22,this.tileset._requestScheduler.endRequest(this),e.finish(22);case 25:return e.next=27,Object(I.a)(a,[Ze,et],{DracoLoader:t});case 27:return this._content=e.sent,-1!==n.indexOf(".json")&&this._tileset._initializeTileHeaders(this._content,this,c.b.dirname(this.uri)),this._contentState=w.READY,this._contentLoaded(),e.abrupt("return",!0);case 34:throw e.prev=34,e.t0=e.catch(15),this._contentState=w.FAILED,e.t0;case 38:case"end":return e.stop()}},e,this,[[15,34],[17,,22,25]])}));return function(t){return e.apply(this,arguments)}}(),s.unloadContent=function(){return!!this.hasRenderContent&&(this._content&&this._content.destroy&&this._content.destroy(),this._content=null,this._contentState=w.UNLOADED,!0)},s.updateVisibility=function(e){var t=this._tileset;if(this._updatedVisibilityFrame!==t._updatedVisibilityFrame){var r=this.parent,n=r?r.computedTransform:this._tileset.modelMatrix,i=r?r._visibilityPlaneMask:T.b.MASK_INDETERMINATE;this._updateTransform(n),this._distanceToCamera=this.distanceToTile(e),this._screenSpaceError=this.getScreenSpaceError(e,!1),this._visibilityPlaneMask=this.visibility(e,i),this._visible=this._visibilityPlaneMask!==T.b.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(e),this._updatedVisibilityFrame=t._updatedVisibilityFrame}},s.updateExpiration=function(){if(ut(this.expireDate)&&this.contentReady&&!this.hasEmptyContent){var e=Date.now(ct);Date.lessThan(this.expireDate,e)&&(this._contentState=w.EXPIRED,this._expiredContent=this._content)}},s.visibility=function(e,t){var r=e.cullingVolume,n=this.boundingVolume,i=this.tileset,a=i.clippingPlanes,s=i.clippingPlanesOriginMatrix;if(a&&a.enabled){var o=a.computeIntersectionWithBoundingVolume(n,s);if(this._isClipped=o!==T.c.INSIDE,o===T.c.OUTSIDE)return T.b.MASK_OUTSIDE}return function(e,t,r){if(Object(h.a)(t,"boundingVolume is required."),Object(h.a)(Number.isFinite(r),"parentPlaneMask is required."),r===T.b.MASK_OUTSIDE||r===T.b.MASK_INSIDE)return r;for(var n=T.b.MASK_INSIDE,i=e.planes,a=0;a<e.planes.length;++a){var s=a<31?1<<a:0;if(!(a<31&&0==(r&s))){var o=lt.fromNormalDistance(i[a].normal,i[a].distance),u=t.intersectPlane(o);if(u===T.c.OUTSIDE)return T.b.MASK_OUTSIDE;u===T.c.INTERSECTING&&(n|=s)}}return n}(r,n,t)},s.contentVisibility=function(e){return!0},s.distanceToTile=function(e){var t=this._boundingVolume;return Math.sqrt(t.distanceSquaredTo(e.camera.position))},s.cameraSpaceZDepth=function(e){var t=e.camera,r=this.boundingVolume;return ht.subVectors(r.center,t.position),t.direction.dot(ht)},s.insideViewerRequestVolume=function(e){var t=this._viewerRequestVolume;return!t||0===t.distanceToCamera(e)},s._initializeCache=function(e){this.cacheNode=void 0;var t,r,n=e.expire;n&&(t=n.duration,n.date&&(r=Date.fromIso8601(n.date))),this.expireDuration=t,this.expireDate=r},s._initializeTransforms=function(e){this.transform=e.transform?new a.a(e.transform):new a.a;var t=this.parent,r=this._tileset,n=t&&t.computedTransform?t.computedTransform.clone():r.modelMatrix.clone();this.computedTransform=new a.a(n).multiplyRight(this.transform);var i=t&&t._initialTransform?t._initialTransform.clone():new a.a;this._initialTransform=new a.a(i).multiplyRight(this.transform)},s._initializeBoundingVolumes=function(e){this._boundingVolume=it(e.boundingVolume,this.computedTransform),this._contentBoundingVolume=null,this._viewerRequestVolume=null,e.content&&e.content.boundingVolume&&(this._contentBoundingVolume=it(e.boundingVolume,this.computedTransform)),e.viewerRequestVolume&&(this._viewerRequestVolume=it(e.viewerRequestVolume,this.computedTransform))},s._initializeContent=function(e){this._content={_tileset:this._tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=w.UNLOADED,this._expiredContent=void 0,this._serverKey=null,this.hasTilesetContent=!1,e.content&&(this.contentUri=e.content.uri||e.content.url,"url"in e&&(console.warn('Tileset 3D: "content.url" property deprecated. Use "content.uri" instead.'),this.contentUri=e.url),this._content=null,this.hasEmptyContent=!1,this.contentState=w.UNLOADED,this.fullUri=this._basePath+"/"+this.contentUri)},s._initializeRenderingState=function(){this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=T.b.MASK_INDETERMINATE,this._visible=!1,this._inRequestVolume=!1,this._finalResolution=!0,this._depth=0,this._stackLength=0,this._selectionDepth=0,this._updatedVisibilityFrame=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._ancestorWithContent=void 0,this._ancestorWithContentAvailable=void 0,this._refines=!1,this._shouldSelect=!1,this._priority=0},s._getRefine=function(e){switch(e){case"REPLACE":case"replace":return x;case"ADD":case"add":return O;default:return this.parent?this.parent.refine:x}},s._isTileset=function(e){return Boolean(e.asset)},s._contentLoaded=function(){switch(this._content&&this._content.type){case"vctr":case"geom":tileset.traverser.disableSkipLevelOfDetail=!0}this._isTileset(this._content)&&(this.hasTilesetContent=!0)},s._updateTransform=function(e){void 0===e&&(e=new a.a);var t=e.clone().multiplyRight(this.transform);if(!t.equals(this.computedTransform)){this.computedTransform=t;var r=this._header,n=this._header.content;this._boundingVolume=it(r.boundingVolume,this.computedTransform,this._boundingVolume),this._contentBoundingVolume&&(this._contentBoundingVolume=it(n.boundingVolume,this.computedTransform,this._contentBoundingVolume)),this._viewerRequestVolume&&(this._viewerRequestVolume=it(r.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume))}},t=e,(r=[{key:"gpuMemoryUsageInBytes",get:function(){return this._gpuMemoryUsageInBytes}},{key:"tileset",get:function(){return this._tileset}},{key:"depth",get:function(){return this._depth}},{key:"selectedFrame",get:function(){return this._selectedFrame}},{key:"isVisibleAndInRequestVolume",get:function(){return this._visible&&this._inRequestVolume}},{key:"content",get:function(){return this._content}},{key:"contentReady",get:function(){return this._contentState===w.READY}},{key:"hasRenderContent",get:function(){return!this.hasEmptyContent&&!this.hasTilesetContent}},{key:"contentAvailable",get:function(){return this.contentReady&&this.hasRenderContent||ut(this._expiredContent)&&!this.contentFailed}},{key:"hasUnloadedContent",get:function(){return this.hasRenderContent&&this.contentUnloaded}},{key:"contentUnloaded",get:function(){return this._contentState===w.UNLOADED}},{key:"contentExpired",get:function(){return this._contentState===w.EXPIRED}},{key:"contentFailed",get:function(){return this._contentState===w.FAILED}},{key:"url",get:function(){return this.tileset.getTileUrl(this.contentUri,this._basePath)}},{key:"uri",get:function(){return this.tileset.getTileUrl(this.contentUri,this._basePath)}},{key:"boundingVolume",get:function(){return this._boundingVolume}},{key:"contentBoundingVolume",get:function(){return this._contentBoundingVolume||this._boundingVolume}},{key:"boundingSphere",get:function(){return this._boundingVolume.boundingSphere}},{key:"extras",get:function(){return this._header.extras}}])&&ot(t.prototype,r),n&&ot(t,n),e}();function dt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var ft=function(){function e(e){void 0===e&&(e=0),this._array=new Array(e),this._length=e}var t,r,n,i=e.prototype;return i.get=function(e){return Object(h.a)(e<this._array.length),this._array[e]},i.set=function(e,t){Object(h.a)(e>=0),e>=this.length&&(this.length=e+1),this._array[e]=t},i.peek=function(){return this._array[this._length-1]},i.push=function(e){var t=this.length++;this._array[t]=e},i.pop=function(){return this._array[--this.length]},i.reserve=function(e){Object(h.a)(e>=0),e>this._array.length&&(this._array.length=e)},i.resize=function(e){Object(h.a)(e>=0),this.length=e},i.trim=function(e){void 0===e&&(e=this.length),this._array.length=e},t=e,(r=[{key:"length",get:function(){return this._length},set:function(e){this._length=e,e>this._array.length&&(this._array.length=e)}},{key:"values",get:function(){return this._array}}])&&dt(t.prototype,r),n&&dt(t,n),e}(),yt=function(){function e(){this.traversal={stack:new ft,stackMaximumLength:0},this.emptyTraversal={stack:new ft,stackMaximumLength:0},this.result={_requestedTiles:[],selectedTiles:[],_emptyTiles:[],_hasMixedContent:!1},this._disableSkipLevelOfDetail=!1}var t=e.prototype;return t.traverse=function(e,t,r){if(this.root=e,this.options=r,this.result._requestedTiles.length=0,this.result.selectedTiles.length=0,this.result._emptyTiles.length=0,this.result._hasMixedContent=!1,this.updateTile(e,t),!e.isVisibleAndInRequestVolume)return!1;if(e.getScreenSpaceError(t,!0)<=r.maximumScreenSpaceError)return!1;var n=r.maximumScreenSpaceError;return this.executeTraversal(e,n,t),this.traversal.stack.trim(this.traversal.stackMaximumLength),this.emptyTraversal.stack.trim(this.emptyTraversal.stackMaximumLength),!0},t.selectTile=function(e,t){e._selectedFrame=t.frameNumber,this.result.selectedTiles.push(e)},t.selectDesiredTile=function(e,t){if(this.options.skipLevelOfDetail){var r=e.contentAvailable?e:e._ancestorWithContentAvailable;r?r._shouldSelect=!0:this.selectDescendants(e,t)}else e.contentAvailable&&this.selectTile(e,t)},t.visitTile=function(e,t,r){++e._statistics.visited,t._visitedFrame=r.frameNumber},t.touchTile=function(e,t){e.tileset._cache.touch(e),e._touchedFrame=t.frameNumber},t.getPriority=function(e,t){switch(e.refine){case O:return e._distanceToCamera;case x:var r=e.parent,n=r&&(!t.skipLevelOfDetail||0===e._screenSpaceError||r.hasTilesetContent)?r._screenSpaceError:e._screenSpaceError;return this.root._screenSpaceError-n;default:return Object(h.a)(!1)}},t.loadTile=function(e,t){(e.hasUnloadedContent||e.contentExpired)&&(e._requestedFrame=t.frameNumber,e._priority=this.getPriority(e,this.options),this.result._requestedTiles.push(e))},t.updateTileVisibility=function(e,t){e.updateVisibility(t)},t.updateTile=function(e,t){this.updateTileVisibility(e,t),e.updateExpiration()},t.updateAndPushChildren=function(e,t,r){var n=e.children,i=Array.isArray(n),a=0;for(n=i?n:n[Symbol.iterator]();;){var s;if(i){if(a>=n.length)break;s=n[a++]}else{if((a=n.next()).done)break;s=a.value}var o=s;this.updateTile(o,r),t.push(o)}return!0},t.canTraverse=function(e,t){return!(0===e.children.length||t.depthLimit<e.depth)&&(e.hasTilesetContent?!e.contentExpired:e._screenSpaceError>t.maximumScreenSpaceError)},t.executeTraversal=function(e,t,r){var n=this.traversal,i=n.stack;for(i.push(e);i.length>0;){n.stackMaximumLength=Math.max(n.stackMaximumLength,i.length);var a=i.pop(),s=a.refine===O,o=a.refine===x,u=a.parent,c=!u||u._refines,h=!1;this.canTraverse(a,this.options)&&(h=this.updateAndPushChildren(a,i,r)&&c);var l=!h&&c;a.hasRenderContent?s?(this.loadTile(a,r),this.selectDesiredTile(a,r)):o&&(this.loadTile(a,r),l&&this.selectDesiredTile(a,r)):(this.result._emptyTiles.push(a),this.loadTile(a,r),l&&this.selectDesiredTile(a,r)),this.touchTile(a,r),a._refines=h}},e}(),mt=function(e,t,r){this.item=e,this.previous=t,this.next=r};function vt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var _t=function(e){return void 0!==e},gt=function(){function e(){this.head=void 0,this.tail=void 0,this._length=0}var t,r,n,i=e.prototype;return i.add=function(e){var t=new mt(e,this.tail,void 0);return _t(this.tail)?(this.tail.next=t,this.tail=t):(this.head=t,this.tail=t),++this._length,t},i.remove=function(e){_t(e)&&(_t(e.previous)&&_t(e.next)?(e.previous.next=e.next,e.next.previous=e.previous):_t(e.previous)?(e.previous.next=void 0,this.tail=e.previous):_t(e.next)?(e.next.previous=void 0,this.head=e.next):(this.head=void 0,this.tail=void 0),e.next=void 0,e.previous=void 0,--this._length)},i.splice=function(e,t){if(e!==t){this.remove(t);var r=e.next;e.next=t,this.tail===e?this.tail=t:r.previous=t,t.next=r,t.previous=e}},t=e,(r=[{key:"length",get:function(){return this._length}}])&&vt(t.prototype,r),n&&vt(t,n),e}(),Tt=function(e){return void 0!==e},bt=function(){function e(){this._list=new gt,this._sentinel=this._list.add(),this._trimTiles=!1}var t=e.prototype;return t.reset=function(){this._list.splice(this._list.tail,this._sentinel)},t.touch=function(e){var t=e.cacheNode;Tt(t)&&this._list.splice(this._sentinel,t)},t.add=function(e,t,r){Tt(t.cacheNode)||(t.cacheNode=this._list.add(t),r&&r(e,t))},t.unloadTile=function(e,t,r){var n=t.cacheNode;Tt(n)&&(this._list.remove(n),t.cacheNode=void 0,r&&r(e,t))},t.unloadTiles=function(e,t){var r=this._trimTiles;this._trimTiles=!1;for(var n=this._list,i=1024*e.maximumMemoryUsage*1024,a=this._sentinel,s=n.head;s!==a&&(e.gpuMemoryUsageInBytes>i||r);){var o=s.item;s=s.next,this.unloadTile(e,o,t)}},t.trim=function(){this._trimTiles=!0},e}();function It(e,t,r,n,i,a,s){try{var o=e[a](s),u=o.value}catch(c){return void r(c)}o.done?t(u):Promise.resolve(u).then(n,i)}function Et(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}r.d(t,"a",function(){return At});var wt=6378137,St=6378137,Ot=6356752.314245179;var xt={basePath:"",ellipsoid:o.a.WGS84,modelMatrix:new a.a,throttleRequests:!1,maximumScreenSpaceError:16,maximumMemoryUsage:32,dynamicScreenSpaceError:!1,dynamicScreenSpaceErrorDensity:.00278,dynamicScreenSpaceErrorFactor:4,skipLevelOfDetail:!1,baseScreenSpaceError:1024,onTileLoad:function(){},onTileUnload:function(){},onTileLoadFail:function(e,t,r){return console.error("A 3D tile failed to load: "+r+" "+t)}};var At=function(){function e(e,t,r){void 0===r&&(r={}),Object(h.a)(e),this.options=Object.assign({},xt,{},r),this.url=t,this.basePath=c.b.dirname(t),this.modelMatrix=this.options.modelMatrix,this.stats=new u.a({id:t}),this._initializeStats(),this.gpuMemoryUsageInBytes=0,this.geometricError=void 0,this.userData={},this._queryParams={},this._requestScheduler=new v({throttleRequests:this.options.throttleRequests}),this._traverser=new yt,this._cache=new bt,this._processingQueue=[],this.selectedTiles=[],this._emptyTiles=[],this._requestedTiles=[],this._selectedTilesToStyle=[],this.asset={},this.credits={},this._root=void 0,this._properties=void 0,this._extensionsUsed=void 0,this._gltfUpAxis=void 0,this._loadTimestamp=void 0,this._timeSinceLoad=0,this._updatedVisibilityFrame=0,this._extras=void 0,this._allTilesAdditive=!0,this._hasMixedContent=!1,this._maximumScreenSpaceError=r.maximumScreenSpaceError,this._maximumMemoryUsage=r.maximumMemoryUsage,this._tilesLoaded=!1,this._initialTilesLoaded=!1,this._readyPromise=Promise.resolve(),this._classificationType=this.options.classificationType,this._ellipsoid=this.options.ellipsoid,this._dynamicScreenSpaceErrorComputedDensity=0,this._initializeTileSet(e,this.options)}var t,r,n,a=e.prototype;return a.destroy=function(){this._destroy()},a.getTileUrl=function(e,t){return e.startsWith("data:")?e:(t||this.basePath)+"/"+e+this.queryParams},a.hasExtension=function(e){return Boolean(this._extensionsUsed&&this._extensionsUsed.indexOf(e)>-1)},a.update=function(e){this._updatedVisibilityFrame++,this._cache.reset(),this._traverser.traverse(this.root,e,this.options),Object.assign(this,this._traverser.result);var t=this._requestedTiles,r=Array.isArray(t),n=0;for(t=r?t:t[Symbol.iterator]();;){var i;if(r){if(n>=t.length)break;i=t[n++]}else{if((n=t.next()).done)break;i=n.value}var a=i;this._loadTile(a)}this._unloadTiles();var s=0,o=0,u=this.selectedTiles,c=Array.isArray(u),h=0;for(u=c?u:u[Symbol.iterator]();;){var l;if(c){if(h>=u.length)break;l=u[h++]}else{if((h=u.next()).done)break;l=h.value}var p=l;p.contentAvailable&&(s++,p.content.pointCount&&(o+=p.content.pointCount))}this.stats.get("Tiles In View").count=this.selectedTiles.length,this.stats.get("Tiles To Render").count=s,this.stats.get("Points").count=o},a.trimLoadedTiles=function(){this._cache.trim()},a.addTileToCache=function(e){this._cache.add(this,e,function(e,t){return e._addTileToCache(t)})},a._initializeTileSet=function(e,t){if(this.asset=e.asset,!this.asset)throw new Error("Tileset must have an asset property.");if("0.0"!==this.asset.version&&"1.0"!==this.asset.version)throw new Error("The tileset must be 3D Tiles version 0.0 or 1.0.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:t.attributions||[]},this._properties=e.properties,this.geometricError=e.geometricError,this._extensionsUsed=e.extensionsUsed,this._extras=e.extras,this._root=this._initializeTileHeaders(e,null),this._calculateViewProps()},a._calculateViewProps=function(){var e=this._root,t=e.boundingVolume.center;if(!t)return console.warn("center was not pre-calculated for the root tile"),this.cartographicCenter=new s.a,void(this.zoom=16);this.cartographicCenter=o.a.WGS84.cartesianToCartographic(t,new s.a),this.zoom=function(e){var t=e.halfAxes,r=e.radius,n=e.width,i=e.height;if(t){var a=t[0],s=t[4],o=t[8];return(Math.log2(wt/a/2)+Math.log2(St/s/2)+Math.log2(Ot/o/2))/3}return r?Math.log2(Ot/r):i&&n?(Math.log2(wt/n)+Math.log2(St/i))/2:18}(e.boundingVolume)},a._initializeStats=function(){this.stats.get("Tiles In Tileset(s)"),this.stats.get("Tiles Loading"),this.stats.get("Tiles In Memory"),this.stats.get("Tiles In View"),this.stats.get("Tiles To Render"),this.stats.get("Tiles Loaded"),this.stats.get("Tiles Unloaded"),this.stats.get("Failed Tile Loads"),this.stats.get("Points","memory"),this.stats.get("Tile Memory Use","memory")},a._initializeTileHeaders=function(e,t,r){var n=new pt(this,e.root,t,r);t&&(t.children.push(n),n._depth=t._depth+1);var i=[];for(i.push(n);i.length>0;){var a=i.pop();this.stats.get("Tiles In Tileset(s)").incrementCount();var s=a._header.children||[],o=Array.isArray(s),u=0;for(s=o?s:s[Symbol.iterator]();;){var c;if(o){if(u>=s.length)break;c=s[u++]}else{if((u=s.next()).done)break;c=u.value}var h=new pt(this,c,a,r);a.children.push(h),h._depth=a._depth+1,i.push(h)}}return n},a._destroyTileHeaders=function(e){this._destroySubtree(e)},a._loadTile=function(){var e=function(e){return function(){var t=this,r=arguments;return new Promise(function(n,i){var a=e.apply(t,r);function s(e){It(a,n,i,s,o,"next",e)}function o(e){It(a,n,i,s,o,"throw",e)}s(void 0)})}}(i.a.mark(function e(t){var r;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.stats.get("Tiles Loading").incrementCount(),e.prev=1,e.next=4,t.loadContent(this.options.DracoLoader);case 4:r=e.sent,e.next=13;break;case 7:return e.prev=7,e.t0=e.catch(1),this.stats.get("Tiles Loading").decrementCount(),this.stats.get("Failed Tile Loads").incrementCount(),this.options.onTileLoadFail(t,e.t0.message||e.t0.toString(),t.url),e.abrupt("return");case 13:if(this.stats.get("Tiles Loading").decrementCount(),r){e.next=16;break}return e.abrupt("return");case 16:t&&t._content&&g(t,t._content),this.options.onTileLoad(t);case 18:case"end":return e.stop()}},e,this,[[1,7]])}));return function(t){return e.apply(this,arguments)}}(),a._addTileToCache=function(e){this.stats.get("Tiles Loaded").incrementCount(),this.stats.get("Tiles In Memory").incrementCount(),this.gpuMemoryUsageInBytes+=e._content.byteLength||0,this.stats.get("Tile Memory Use").count=this.gpuMemoryUsageInBytes},a._unloadTile=function(e){this.stats.get("Tiles In Memory").decrementCount(),this.stats.get("Tiles Unloaded").incrementCount(),this.gpuMemoryUsageInBytes-=e._content.byteLength||0,this.stats.get("Tile Memory Use").count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(e),e.unloadContent()},a._unloadTiles=function(){this._cache.unloadTiles(this,function(e,t){return e._unloadTile(t)})},a._destroy=function(){var e=[];for(this._root&&e.push(this._root);e.length>0;){var t=s.children,r=Array.isArray(t),n=0;for(t=r?t:t[Symbol.iterator]();;){var i;if(r){if(n>=t.length)break;i=t[n++]}else{if((n=t.next()).done)break;i=n.value}var a=i;e.push(a)}var s=e.pop();s.destroy()}this._root=null},a._destroySubtree=function(e){var t=e,r=[];for(r.push(t);r.length>0;){var n=(e=r.pop()).children,i=Array.isArray(n),a=0;for(n=i?n:n[Symbol.iterator]();;){var s;if(i){if(a>=n.length)break;s=n[a++]}else{if((a=n.next()).done)break;s=a.value}var o=s;r.push(o)}e!==t&&this._destroyTile(e)}t.children=[]},a._destroyTile=function(e){this._cache.unloadTile(this,e),this._unloadTile(e),e.destroy()},t=e,(r=[{key:"properties",get:function(){return this._properties}},{key:"ready",get:function(){return Boolean(this._root)}},{key:"readyPromise",get:function(){return this._readyPromise.promise}},{key:"tilesLoaded",get:function(){return this._tilesLoaded}},{key:"queryParams",get:function(){return function(e){for(var t=[],r=0,n=Object.keys(e);r<n.length;r++){var i=n[r];t.push(i+"="+e[i])}switch(t.length){case 0:return"";case 1:return"?"+t[0];default:return"?"+t.join("&")}}(this._queryParams)}},{key:"root",get:function(){return this._root}},{key:"boundingSphere",get:function(){return this._checkReady(),this._root.updateTransform(this.modelMatrix),this._root.boundingSphere}},{key:"timeSinceLoad",get:function(){return this._timeSinceLoad}},{key:"maximumMemoryUsage",get:function(){return this._maximumMemoryUsage},set:function(e){Object(h.a)(e>0),this._maximumMemoryUsage=e}},{key:"ellipsoid",get:function(){return this.options.ellipsoid}},{key:"extras",get:function(){return this._extras}}])&&Et(t.prototype,r),n&&Et(t,n),e}()}}]);