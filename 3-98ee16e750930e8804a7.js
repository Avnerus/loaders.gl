(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{230:function(t,e,i){"use strict";var n=i(8),r=i(29),a=i(34),o=i(338),s=i(57),c=i(26),u=i(86).f,l=i(132).f,h=i(22).f,p=i(347).trim,d=n.Number,v=d,f=d.prototype,g="Number"==a(i(85)(f)),y="trim"in String.prototype,m=function(t){var e=s(t,!1);if("string"==typeof e&&e.length>2){var i,n,r,a=(e=y?e.trim():p(e,3)).charCodeAt(0);if(43===a||45===a){if(88===(i=e.charCodeAt(2))||120===i)return NaN}else if(48===a){switch(e.charCodeAt(1)){case 66:case 98:n=2,r=49;break;case 79:case 111:n=8,r=55;break;default:return+e}for(var o,c=e.slice(2),u=0,l=c.length;u<l;u++)if((o=c.charCodeAt(u))<48||o>r)return NaN;return parseInt(c,n)}}return+e};if(!d(" 0o1")||!d("0b1")||d("+0x1")){d=function(t){var e=arguments.length<1?0:t,i=this;return i instanceof d&&(g?c(function(){f.valueOf.call(i)}):"Number"!=a(i))?o(new v(m(e)),i,d):m(e)};for(var b,w=i(17)?u(v):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),_=0;w.length>_;_++)r(v,b=w[_])&&!r(d,b)&&h(d,b,l(v,b));d.prototype=f,f.constructor=d,i(28)(n,"Number",d)}},247:function(t,e,i){var n=i(15),r=i(8).isFinite;n(n.S,"Number",{isFinite:function(t){return"number"==typeof t&&r(t)}})},248:function(t,e,i){"use strict";var n=i(399),r=new(i(439).a)({id:"deck"}).enable(),a="7.1.0-beta.1";if(n.a.deck&&n.a.deck.VERSION!==a)throw new Error("deck.gl - multiple versions detected: ".concat(n.a.deck.VERSION," vs ").concat(a));n.a.deck||(r.log(0,"deck.gl ".concat(a," - ").concat("set deck.log.priority=1 (or higher) to trace attribute updates"))(),n.a.deck=n.a.deck||{VERSION:a,version:a,log:r}),console.table||(console.table=function(){});var o=i(213),s={LNG_LAT:1,LNGLAT_AUTO_OFFSET:4,METER_OFFSETS:2,LNGLAT_OFFSETS:3,IDENTITY:0},c=Object.keys(s).map(function(t){return"const float COORDINATE_SYSTEM_".concat(t," = ").concat(s[t],".;")}).join(""),u="".concat(c,"\n\nuniform float project_uCoordinateSystem;\nuniform float project_uScale;\nuniform bool project_uWrapLongitude;\nuniform float project_uAntimeridian;\nuniform vec3 project_uCommonUnitsPerMeter;\nuniform vec3 project_uCommonUnitsPerWorldUnit;\nuniform vec3 project_uCommonUnitsPerWorldUnit2;\nuniform vec4 project_uCenter;\nuniform mat4 project_uModelMatrix;\nuniform mat4 project_uViewProjectionMatrix;\nuniform vec2 project_uViewportSize;\nuniform float project_uDevicePixelRatio;\nuniform float project_uFocalDistance;\nuniform vec3 project_uCameraPosition;\nuniform vec3 project_uCoordinateOrigin;\n\nconst float TILE_SIZE = 512.0;\nconst float PI = 3.1415926536;\nconst float WORLD_SCALE = TILE_SIZE / (PI * 2.0);\nconst vec2 ZERO_64_XY_LOW = vec2(0.0, 0.0);\nfloat project_size(float meters) {\n  return meters * project_uCommonUnitsPerMeter.z;\n}\n\nvec2 project_size(vec2 meters) {\n  return meters * project_uCommonUnitsPerMeter.xy;\n}\n\nvec3 project_size(vec3 meters) {\n  return meters * project_uCommonUnitsPerMeter;\n}\n\nvec4 project_size(vec4 meters) {\n  return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);\n}\nvec3 project_normal(vec3 vector) {\n  vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);\n  return normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);\n}\n\nvec4 project_offset_(vec4 offset) {\n  float dy = offset.y;\n  if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_AUTO_OFFSET) {\n    dy = clamp(dy, -1., 1.);\n  }\n  vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;\n  return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);\n}\nvec2 project_mercator_(vec2 lnglat) {\n  float x = lnglat.x;\n  if (project_uWrapLongitude) {\n    x = mod(x - project_uAntimeridian, 360.0) + project_uAntimeridian;\n  }\n  return vec2(\n    radians(x) + PI,\n    PI - log(tan_fp32(PI * 0.25 + radians(lnglat.y) * 0.5))\n  );\n}\nvec4 project_position(vec4 position, vec2 position64xyLow) {\n  if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNG_LAT) {\n    return project_uModelMatrix * vec4(\n      project_mercator_(position.xy) * WORLD_SCALE * project_uScale,\n      project_size(position.z),\n      position.w\n    );\n  }\n\n  if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_AUTO_OFFSET) {\n    float X = position.x - project_uCoordinateOrigin.x;\n    float Y = position.y - project_uCoordinateOrigin.y;\n    return project_offset_(vec4(X + position64xyLow.x, Y + position64xyLow.y, position.z, position.w));\n  }\n\n  if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {\n    return project_offset_(position);\n  }\n  vec4 position_world = project_uModelMatrix * position;\n  if (project_uCoordinateSystem == COORDINATE_SYSTEM_IDENTITY) {\n    position_world.xyz -= project_uCoordinateOrigin;\n    position_world += project_uModelMatrix * vec4(position64xyLow, 0.0, 0.0);\n  }\n\n  return project_offset_(position_world);\n}\n\nvec4 project_position(vec4 position) {\n  return project_position(position, ZERO_64_XY_LOW);\n}\n\nvec3 project_position(vec3 position, vec2 position64xyLow) {\n  vec4 projected_position = project_position(vec4(position, 1.0), position64xyLow);\n  return projected_position.xyz;\n}\n\nvec3 project_position(vec3 position) {\n  vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_XY_LOW);\n  return projected_position.xyz;\n}\n\nvec2 project_position(vec2 position) {\n  vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_XY_LOW);\n  return projected_position.xy;\n}\nvec4 project_common_position_to_clipspace(vec4 position) {\n  if (project_uCoordinateSystem == COORDINATE_SYSTEM_METER_OFFSETS ||\n    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {\n    position.w *= project_uCommonUnitsPerMeter.z;\n  }\n  return project_uViewProjectionMatrix * position + project_uCenter;\n}\nvec2 project_pixel_size_to_clipspace(vec2 pixels) {\n  vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;\n  return offset * project_uFocalDistance;\n}\n\nfloat project_size_to_pixel(float meters) {\n  return project_size(meters);\n}\nfloat project_pixel_size(float pixels) {\n  return pixels;\n}\nvec2 project_pixel_size(vec2 pixels) {\n  return pixels;\n}\nfloat project_scale(float meters) {\n  return project_size(meters);\n}\nvec2 project_scale(vec2 meters) {\n  return project_size(meters);\n}\nvec3 project_scale(vec3 meters) {\n  return project_size(meters);\n}\nvec4 project_scale(vec4 meters) {\n  return project_size(meters);\n}\nvec4 project_to_clipspace(vec4 position) {\n  return project_common_position_to_clipspace(position);\n}\nvec4 project_pixel_to_clipspace(vec2 pixels) {\n  return vec4(project_pixel_size_to_clipspace(pixels), 0.0, 0.0);\n}\n"),l=i(273),h=i(275),p={LNGLAT:1,LNGLAT_DEPRECATED:5,METER_OFFSETS:2,METERS:2,LNGLAT_OFFSETS:3,IDENTITY:0},d={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}};function v(t,e){if(t===e)return!0;if(Array.isArray(t)){var i=t.length;if(!e||e.length!==i)return!1;for(var n=0;n<i;n++)if(t[n]!==e[n])return!1;return!0}return!1}function f(t){var e,i={};return function(n){for(var r in n)if(!v(n[r],i[r])){e=t(n),i=n;break}return e}}function g(t,e){if(!t)throw new Error(e||"deck.gl: assertion failed.")}var y=[0,0,0,0],m=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],b=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],w=[0,0,0],_=[0,0,0],j=12,k=f(function(t){var e=t.viewport,i=t.devicePixelRatio,n=t.coordinateSystem,r=t.coordinateOrigin,a=t.wrapLongitude,o=e.zoom,c=function(t){var e,i=t.viewport,n=t.coordinateSystem,r=t.coordinateOrigin,a=t.coordinateZoom,o=i.viewMatrixUncentered,c=i.viewMatrix,u=i.projectionMatrix,d=i.viewProjectionMatrix,v=i.cameraPosition,f=function(t){switch(t){case p.LNGLAT:case p.LNGLAT_EXPERIMENTAL:default:return s.LNGLAT_AUTO_OFFSET;case p.LNGLAT_DEPRECATED:return s.LNG_LAT;case p.METER_OFFSETS:case p.METERS:return s.METER_OFFSETS;case p.LNGLAT_OFFSETS:return s.LNGLAT_OFFSETS;case p.IDENTITY:return s.IDENTITY}}(n),g=r;if(f===s.LNGLAT_AUTO_OFFSET)if(a<j)f=s.LNG_LAT;else{var b=Math.fround(i.longitude),w=Math.fround(i.latitude);g=[b,w]}f===s.IDENTITY&&(g=[Math.fround(i.position[0]),Math.fround(i.position[1])]);switch(g[2]=g[2]||0,f){case s.LNG_LAT:e=y;break;case s.LNGLAT_OFFSETS:case s.METER_OFFSETS:case s.LNGLAT_AUTO_OFFSET:case s.IDENTITY:var _=i.projectPosition(g,Math.pow(2,a));v=[v[0]-_[0],v[1]-_[1],v[2]-_[2]],_[3]=1,e=h.o([],_,d),c=o||c,d=l.g([],u,c),d=l.g([],d,m);break;default:throw new Error("Unknown projection mode")}return{viewMatrix:c,viewProjectionMatrix:d,projectionCenter:e,cameraPosCommon:v,shaderCoordinateSystem:f,shaderCoordinateOrigin:g}}({coordinateSystem:n,coordinateOrigin:r,coordinateZoom:o,viewport:e}),u=c.projectionCenter,d=c.viewProjectionMatrix,v=c.cameraPosCommon,f=c.shaderCoordinateSystem,b=c.shaderCoordinateOrigin;g(d,"Viewport missing modelViewProjectionMatrix");var _=e.getDistanceScales(),k=[e.width*i,e.height*i],P={project_uCoordinateSystem:f,project_uCenter:u,project_uWrapLongitude:a,project_uAntimeridian:(e.longitude||0)-180,project_uViewportSize:k,project_uDevicePixelRatio:i,project_uFocalDistance:e.focalDistance||1,project_uCommonUnitsPerMeter:_.pixelsPerMeter,project_uCommonUnitsPerWorldUnit:_.pixelsPerMeter,project_uCommonUnitsPerWorldUnit2:w,project_uScale:e.scale,project_uViewProjectionMatrix:d,project_uCameraPosition:v},O=e.getDistanceScales(b);switch(f){case s.METER_OFFSETS:P.project_uCommonUnitsPerWorldUnit=O.pixelsPerMeter,P.project_uCommonUnitsPerWorldUnit2=O.pixelsPerMeter2;break;case s.LNGLAT_AUTO_OFFSET:P.project_uCoordinateOrigin=b;case s.LNG_LAT:case s.LNGLAT_OFFSETS:P.project_uCommonUnitsPerWorldUnit=O.pixelsPerDegree,P.project_uCommonUnitsPerWorldUnit2=O.pixelsPerDegree2;break;case s.IDENTITY:P.project_uCoordinateOrigin=b}return P});function P(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.viewport,i=t.devicePixelRatio,n=void 0===i?1:i,r=t.modelMatrix,a=void 0===r?null:r,o=t.coordinateSystem,s=void 0===o?p.LNGLAT:o,c=t.coordinateOrigin,u=void 0===c?_:c,l=t.wrapLongitude,h=void 0!==l&&l;t.projectionMode,t.positionOrigin;return g(e),Object.assign({project_uModelMatrix:a||b},k({viewport:e,devicePixelRatio:n,coordinateSystem:s,coordinateOrigin:u,wrapLongitude:h}))}var O={};var x={name:"project",dependencies:[o.w],vs:u,getUniforms:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:O;return t.viewport?P(t):{}},deprecations:[{type:"function",old:"project_scale",new:"project_size"},{type:"function",old:"project_to_clipspace",new:"project_common_position_to_clipspace"},{type:"function",old:"project_pixel_to_clipspace",new:"project_pixel_size_to_clipspace"}]},S={name:"project32",dependencies:[x],vs:"\nvec4 project_position_to_clipspace(\n  vec3 position, vec2 position64xyLow, vec3 offset, out vec4 commonPosition\n) {\n  vec3 projectedPosition = project_position(position, position64xyLow);\n  commonPosition = vec4(projectedPosition + offset, 1.0);\n  return project_common_position_to_clipspace(commonPosition);\n}\n\nvec4 project_position_to_clipspace(\n  vec3 position, vec2 position64xyLow, vec3 offset\n) {\n  vec4 commonPosition;\n  return project_position_to_clipspace(position, position64xyLow, offset, commonPosition);\n}\n"},M=o.x.fp64ify,T=o.x.fp64ifyMatrix4,C={name:"project64",dependencies:[x,o.x],vs:"\nconst vec2 WORLD_SCALE_FP64 = vec2(81.4873275756836, 0.0000032873668232014097);\n\nuniform vec2 project64_uScale;\nuniform vec2 project_uViewProjectionMatrixFP64[16];\nvoid mercatorProject_fp64(vec4 lnglat_fp64, out vec2 out_val[2]) {\n\n#if defined(NVIDIA_FP64_WORKAROUND)\n  out_val[0] = sum_fp64(radians_fp64(lnglat_fp64.xy), PI_FP64 * ONE);\n#else\n  out_val[0] = sum_fp64(radians_fp64(lnglat_fp64.xy), PI_FP64);\n#endif\n  out_val[1] = sub_fp64(PI_FP64,\n    log_fp64(tan_fp64(sum_fp64(PI_4_FP64, radians_fp64(lnglat_fp64.zw) / 2.0))));\n  return;\n}\n\nvoid project_position_fp64(vec4 position_fp64, out vec2 out_val[2]) {\n  vec2 pos_fp64[2];\n  mercatorProject_fp64(position_fp64, pos_fp64);\n  vec2 x_fp64 = mul_fp64(pos_fp64[0], project64_uScale);\n  vec2 y_fp64 = mul_fp64(pos_fp64[1], project64_uScale);\n  out_val[0] = mul_fp64(x_fp64, WORLD_SCALE_FP64);\n  out_val[1] = mul_fp64(y_fp64, WORLD_SCALE_FP64);\n\n  return;\n}\n\nvoid project_position_fp64(vec2 position, vec2 position64xyLow, out vec2 out_val[2]) {\n  vec4 position64xy = vec4(\n    position.x, position64xyLow.x,\n    position.y, position64xyLow.y);\n\n  project_position_fp64(position64xy, out_val);\n}\n\nvec4 project_common_position_to_clipspace_fp64(vec2 vertex_pos_modelspace[4]) {\n  vec2 vertex_pos_clipspace[4];\n  mat4_vec4_mul_fp64(project_uViewProjectionMatrixFP64, vertex_pos_modelspace,\n    vertex_pos_clipspace);\n  return vec4(\n    vertex_pos_clipspace[0].x,\n    vertex_pos_clipspace[1].x,\n    vertex_pos_clipspace[2].x,\n    vertex_pos_clipspace[3].x\n    );\n}\n\nvec4 project_position_to_clipspace(\n  vec3 position, vec2 position64xyLow, vec3 offset, out vec4 commonPosition\n) {\n  vec2 offset64[4];\n  vec4_fp64(vec4(offset, 0.0), offset64);\n\n  float z = project_size(position.z);\n  vec2 projectedPosition64xy[2];\n  project_position_fp64(position.xy, position64xyLow, projectedPosition64xy);\n\n  vec2 commonPosition64[4];\n  commonPosition64[0] = sum_fp64(offset64[0], projectedPosition64xy[0]);\n  commonPosition64[1] = sum_fp64(offset64[1], projectedPosition64xy[1]);\n  commonPosition64[2] = sum_fp64(offset64[2], vec2(z, 0.0));\n  commonPosition64[3] = vec2(1.0, 0.0);\n\n  commonPosition = vec4(projectedPosition64xy[0].x, projectedPosition64xy[1].x, z, 1.0);\n\n  return project_common_position_to_clipspace_fp64(commonPosition64);\n}\n\nvec4 project_position_to_clipspace(\n  vec3 position, vec2 position64xyLow, vec3 offset\n) {\n  vec4 commonPosition;\n  return project_position_to_clipspace(\n    position, position64xyLow, offset, commonPosition\n  );\n}\nvec4 project_to_clipspace_fp64(vec2 vertex_pos_modelspace[4]) {\n  return project_common_position_to_clipspace_fp64(vertex_pos_modelspace);\n}\n",getUniforms:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=t.project_uViewProjectionMatrix,i=t.project_uScale;if(e&&i)return E({project_uViewProjectionMatrix:e,project_uScale:i});return{}},deprecations:[{type:"function",old:"project_to_clipspace_fp64",new:"project_common_position_to_clipspace_fp64"}]},E=f(function(t){var e=t.project_uViewProjectionMatrix,i=t.project_uScale,n=T(e),r=M(i);return{project_uViewProjectionMatrixFP64:n,project64_uViewProjectionMatrix:n,project64_uScale:r}});Object(o.I)([o.w,o.x,x,S,C,o.y,o.F,o.G]),Object(o.J)([x]);var L=i(203),A=i(204),I=i(206),R=i(205),F=i(207),N=function(t){function e(){return Object(L.a)(this,e),Object(I.a)(this,Object(R.a)(e).apply(this,arguments))}return Object(F.a)(e,t),Object(A.a)(e,[{key:"getProjectedLight",value:function(){return this}}]),e}(o.e),z=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(L.a)(this,t);var i=e.id,n=void 0===i?"effect":i;this.id=n,this.props={},Object.assign(this.props,e)}return Object(A.a)(t,[{key:"prepare",value:function(){}},{key:"getParameters",value:function(){}},{key:"cleanup",value:function(){}}]),t}(),D={color:[255,255,255],intensity:1},V=[{color:[255,255,255],intensity:1,direction:[-1,-3,-1]},{color:[255,255,255],intensity:.9,direction:[1,8,-2.5]}],U=function(t){function e(t){var i;for(var n in Object(L.a)(this,e),(i=Object(I.a)(this,Object(R.a)(e).call(this,t))).ambientLight=null,i.directionalLights=[],i.pointLights=[],t){var r=t[n];switch(r.type){case"ambient":i.ambientLight=r;break;case"directional":i.directionalLights.push(r);break;case"point":i.pointLights.push(r)}}return i.applyDefaultLights(),i}return Object(F.a)(e,t),Object(A.a)(e,[{key:"getParameters",value:function(t){var e=this.ambientLight,i=this.getProjectedPointLights(t);return{lightSources:{ambientLight:e,directionalLights:this.getProjectedDirectionalLights(t),pointLights:i}}}},{key:"applyDefaultLights",value:function(){var t=this.ambientLight,e=this.pointLights,i=this.directionalLights;t||0!==e.length||0!==i.length||(this.ambientLight=new o.a(D),this.directionalLights.push(new N(V[0])),this.directionalLights.push(new N(V[1])))}},{key:"getProjectedPointLights",value:function(t){for(var e=[],i=0;i<this.pointLights.length;i++){var n=this.pointLights[i];e.push(n.getProjectedLight({layer:t}))}return e}},{key:"getProjectedDirectionalLights",value:function(t){for(var e=[],i=0;i<this.directionalLights.length;i++){var n=this.directionalLights[i];e.push(n.getProjectedLight({layer:t}))}return e}}]),e}(z),B=i(216),Z=i(270),G=i(317);function X(t,e){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=Object(B.a)(t,3),r=n[0],a=n[1],o=n[2],s=void 0===o?0:o,c=e.projectFlat(t),u=Object(B.a)(c,2);return[u[0],u[1],s*(i?Object(G.b)({longitude:r,latitude:a,scale:e.scale}):e.getDistanceScales()).pixelsPerMeter[2]]}function Y(t,e){var i=e.viewport,n=e.modelMatrix,r=e.coordinateSystem,a=e.coordinateOrigin,o=e.offsetMode,s=Object(B.a)(t,3),c=s[0],u=s[1],l=s[2];if(n){var d=h.o([],[c,u,l,1],n),v=Object(B.a)(d,3);c=v[0],u=v[1],l=v[2]}switch(r){case p.LNGLAT:case p.LNGLAT_DEPRECATED:return X([c,u,l],i,o);case p.LNGLAT_OFFSETS:return X([c+a[0],u+a[1],l+(a[2]||0)],i,o);case p.METER_OFFSETS:return X(Object(G.a)(a,[c,u,l]),i,o);case p.IDENTITY:default:return i.projectPosition([c,u,l])}}function W(t,e){var i=function(t){var e=Object.assign({},t),i=t.viewport,n=t.coordinateSystem,r=t.coordinateOrigin,a=t.fromCoordinateSystem,o=t.fromCoordinateOrigin;return void 0===a&&(e.fromCoordinateSystem=n),void 0===o&&(e.fromCoordinateOrigin=r),n===p.LNGLAT&&i.zoom>=j&&(e.coordinateSystem=p.LNGLAT_OFFSETS,e.coordinateOrigin=[Math.fround(i.longitude),Math.fround(i.latitude)]),e}(e),n=i.viewport,r=i.coordinateSystem,a=i.coordinateOrigin,o=i.modelMatrix,s=i.fromCoordinateSystem,c=i.fromCoordinateOrigin;switch(r){case p.LNGLAT_OFFSETS:case p.METER_OFFSETS:var u=Y(t,{viewport:n,modelMatrix:o,coordinateSystem:s,coordinateOrigin:c,offsetMode:!0}),l=X(a,n,!0);return Z.m(u,u,l),u;case p.LNGLAT:case p.LNGLAT_DEPRECATED:case p.IDENTITY:default:return Y(t,{viewport:n,modelMatrix:o,coordinateSystem:s,coordinateOrigin:c,offsetMode:!1})}}var q=i(234),H=[],K=[];function J(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1/0,n=H,r={index:-1,data:t,target:[]};return t?"function"==typeof t[Symbol.iterator]?n=t:t.length>0&&(K.length=t.length,n=K):n=H,(e>0||Number.isFinite(i))&&(n=(Array.isArray(n)?n:Array.from(n)).slice(e,i),r.index=e-1),{iterable:n,objectInfo:r}}function $(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=e.filter,n=void 0===i?function(){return!0}:i,r=e.map,a=void 0===r?function(t){return t}:r,o=e.result,s=void 0===o?[]:o;return Array.isArray(t)?function t(e,i,n,r){var a=-1;for(;++a<e.length;){var o=e[a];Array.isArray(o)?t(o,i,n,r):i(o)&&r.push(n(o))}return r}(t,n,a,s):n(t)?[a(t)]:[]}function Q(t){for(var e=t.target,i=t.source,n=t.start,r=void 0===n?0:n,a=t.count,o=void 0===a?1:a,s=i.length,c=o*s,u=0,l=r;u<s;u++)e[l++]=i[u];for(;u<c;)u<c-u?(e.copyWithin(r+u,r,r+u),u*=2):(e.copyWithin(r+u,r,r+c-u),u=c);return e}var tt=[],et=[[0,1/0]];var it=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(L.a)(this,t);var n=i.id,r=void 0===n?Object(o.N)("attribute"):n,a=i.type,s=i.isIndexed,c=void 0!==s&&s;this.gl=e,this.id=r,this.isIndexed=c,this.target=c?34963:34962,this.type=a,c&&!a&&(this.type=e&&Object(o.z)(e,o.f.ELEMENT_INDEX_UINT32)?5125:5123),this.value=null,this.externalBuffer=null,this.buffer=null,this.userData={},this.update(i),this._validateAttributeDefinition()}return Object(A.a)(t,[{key:"delete",value:function(){this.buffer&&(this.buffer.delete(),this.buffer=null)}},{key:"update",value:function(t){var e=t.value,i=t.buffer,n=t.constant,r=void 0===n?this.constant||!1:n;if(this.constant=r,i)this.externalBuffer=i,this.constant=!1,this.type=t.type||i.accessor.type,void 0!==i.accessor.divisor&&(this.divisor=i.accessor.divisor),void 0!==t.divisor&&(this.divisor=t.divisor);else if(e){this.externalBuffer=null;var a=this.size||t.size||0;if(r&&e.length!==a){this.value=new Float32Array(a);for(var o=this.offset/4,s=0;s<this.size;++s)this.value[s]=e[o+s]}else this.value=e;!r&&this.gl&&(this.buffer=this.buffer||this._createBuffer(t),this.buffer.setData({data:e}),this.type=this.buffer.accessor.type)}this._setAccessor(t)}},{key:"getBuffer",value:function(){return this.constant?null:this.externalBuffer||this.buffer}},{key:"getValue",value:function(){if(this.constant)return this.value;var t=this.externalBuffer||this.buffer;return t?[t,this]:null}},{key:"_createBuffer",value:function(t){var e=Object.assign({},t,{id:this.id,target:this.target,accessor:{type:this.type}});return Number.isFinite(e.divisor)&&(e.accessor.divisor=e.divisor),delete e.divisor,Number.isFinite(e.size)&&(e.accessor.size=e.size),delete e.size,new o.c(this.gl,e)}},{key:"_setAccessor",value:function(t){var e=t.size,i=void 0===e?this.size:e,n=t.offset,r=void 0===n?this.offset||0:n,a=t.stride,s=void 0===a?this.stride||0:a,c=t.normalized,u=void 0===c?this.normalized||!1:c,l=t.integer,h=void 0===l?this.integer||!1:l,p=t.divisor,d=void 0===p?this.divisor||0:p,v=t.instanced,f=t.isInstanced;this.size=i,this.offset=r,this.stride=s,this.normalized=u,this.integer=h,this.divisor=d,void 0!==f&&(o.C.deprecated("Attribute.isInstanced")(),this.divisor=f?1:0),void 0!==v&&(o.C.deprecated("Attribute.instanced")(),this.divisor=v?1:0)}},{key:"_validateAttributeDefinition",value:function(){}}]),t}(),nt={isExternalBuffer:!1,needsUpdate:!0,needsRedraw:!1,updateRanges:et,allocedInstances:-1},rt=function(t){function e(t){var i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(L.a)(this,e),i=Object(I.a)(this,Object(R.a)(e).call(this,t,n));var r=n.transition,a=void 0!==r&&r,o=n.noAlloc,s=void 0!==o&&o,c=n.update,u=void 0===c?null:c,l=n.accessor,h=void 0===l?null:l,p=n.bufferLayout,d=void 0===p?null:p,v=n.defaultValue,f=void 0===v?[0,0,0,0]:v;if(f=Array.isArray(f)?f:[f],i.shaderAttributes={},i.hasShaderAttributes=!1,n.shaderAttributes){var g=n.shaderAttributes;for(var y in g){var m=g[y];i.shaderAttributes[y]=new e(i.gl,Object.assign({},m,{id:y,constant:m.constant||!1,isIndexed:m.isIndexed||m.elements,size:(m.elements?1:m.size)||i.size,value:m.value||null,divisor:m.instanced||m.divisor||i.divisor,buffer:i.getBuffer(),noAlloc:!0})),i.hasShaderAttributes=!0}}return Object.assign(i.userData,nt,n,{transition:a,noAlloc:s,update:u||h&&i._standardAccessor,accessor:h,defaultValue:f,bufferLayout:d}),Object.seal(i.userData),i._validateAttributeUpdaters(),i}return Object(F.a)(e,t),Object(A.a)(e,[{key:"needsUpdate",value:function(){return this.userData.needsUpdate}},{key:"needsRedraw",value:function(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).clearChangedFlags,e=void 0!==t&&t,i=this.userData.needsRedraw;return this.userData.needsRedraw=this.userData.needsRedraw&&!e,i}},{key:"getInstanceCount",value:function(){return null!==this.value?this.value.length/this.size:0}},{key:"getUpdateTriggers",value:function(){var t=this.userData.accessor;return[this.id].concat("function"!=typeof t&&t||[])}},{key:"getAccessor",value:function(){return this.userData.accessor}},{key:"getShaderAttributes",value:function(){var t={};return this.hasShaderAttributes?Object.assign(t,this.shaderAttributes):t[this.id]=this,t}},{key:"supportsTransition",value:function(){return this.userData.transition}},{key:"getTransitionSetting",value:function(t){var e=this.userData,i=e.transition,n=e.accessor;if(!i)return null;var r=Array.isArray(n)?t[n.find(function(e){return t[e]})]:t[n];return Number.isFinite(r)&&(r={duration:r}),r&&r.duration>0?Object.assign({},i,r):null}},{key:"setNeedsUpdate",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.id,e=arguments.length>1?arguments[1]:void 0;if(this.userData.needsUpdate=this.userData.needsUpdate||t,e){var i=e.startRow,n=void 0===i?0:i,r=e.endRow,a=void 0===r?1/0:r;this.userData.updateRanges=function(t,e){if(t===et)return t;if(e[0]<0&&(e[0]=0),e[0]>=e[1])return t;for(var i=[],n=t.length,r=0,a=0;a<n;a++){var o=t[a];o[1]<e[0]?(i.push(o),r=a+1):o[0]>e[1]?i.push(o):e=[Math.min(o[0],e[0]),Math.max(o[1],e[1])]}return i.splice(r,0,e),i}(this.userData.updateRanges,[n,a])}else this.userData.updateRanges=et}},{key:"clearNeedsUpdate",value:function(){this.userData.needsUpdate=!1,this.userData.updateRanges=tt}},{key:"setNeedsRedraw",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.id;this.userData.needsRedraw=this.userData.needsRedraw||t}},{key:"allocate",value:function(t){var e=this.userData;if(e.isExternalBuffer||e.noAlloc)return!1;var i=this.getInstanceCount();if((0===i||i<t)&&(e.update||e.accessor)){g(Number.isFinite(t));var n=Math.max(t,1),r=at(this.type||5126),a=this.value;return this.constant=!1,this.value=new r(this.size*n),this.buffer&&this.buffer.byteLength<this.value.byteLength&&this.buffer.reallocate(this.value.byteLength),e.updateRanges!==et&&(this.value.set(a),this.buffer.subData(a)),this.setNeedsUpdate(!0,{startRow:i}),e.allocedInstances=n,!0}return!1}},{key:"updateBuffer",value:function(t){var e=t.numInstances,i=t.bufferLayout,n=t.data,r=t.props,a=t.context;if(!this.needsUpdate())return!1;var o=this.userData,s=o.update,c=o.updateRanges,u=!0;if(s){var l=!0,h=!1,p=void 0;try{for(var d,v=c[Symbol.iterator]();!(l=(d=v.next()).done);l=!0){var f=Object(B.a)(d.value,2),g=f[0],y=f[1];s.call(a,this,{data:n,startRow:g,endRow:y,props:r,numInstances:e,bufferLayout:i})}}catch(x){h=!0,p=x}finally{try{l||null==v.return||v.return()}finally{if(h)throw p}}if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength)this.update({value:this.value,constant:this.constant});else{var m=!0,b=!1,w=void 0;try{for(var _,j=c[Symbol.iterator]();!(m=(_=j.next()).done);m=!0){var k=Object(B.a)(_.value,2),P=(g=k[0],y=k[1],Number.isFinite(g)?this._getVertexOffset(g,this.bufferLayout):0),O=Number.isFinite(y)||!Number.isFinite(e)?this._getVertexOffset(y,this.bufferLayout):e*this.size;this.buffer.subData({data:this.value.subarray(P,O),offset:P*this.value.BYTES_PER_ELEMENT})}}catch(x){b=!0,w=x}finally{try{m||null==j.return||j.return()}finally{if(b)throw w}}}this._checkAttributeArray()}else u=!1;return this._updateShaderAttributes(),this.clearNeedsUpdate(),o.needsRedraw=!0,u}},{key:"update",value:function(t){Object(q.a)(Object(R.a)(e.prototype),"update",this).call(this,t),this._updateShaderAttributes()}},{key:"setGenericValue",value:function(t){var e=this.userData;if(void 0===t||"function"==typeof t)return e.isExternalBuffer=!1,!1;t=this._normalizeValue(t);var i=!this.constant||!this._areValuesEqual(t,this.value);return i&&this.update({constant:!0,value:t}),e.needsRedraw=e.needsUpdate||i,this.clearNeedsUpdate(),e.isExternalBuffer=!0,this._updateShaderAttributes(),!0}},{key:"setExternalBuffer",value:function(t,e){var i=this.userData;if(t){if(i.isExternalBuffer=!0,this.clearNeedsUpdate(),t instanceof o.c)this.externalBuffer!==t&&(this.update({constant:!1,buffer:t}),i.needsRedraw=!0);else if(this.value!==t){if(!ArrayBuffer.isView(t))throw new Error("Attribute prop must be typed array");if(i.auto&&t.length<=e*this.size)throw new Error("Attribute prop array must match length and size");var n=at(this.type||5126);t instanceof n?this.update({constant:!1,value:t}):(r.warn("Attribute prop ".concat(this.id," is casted to ").concat(n.name))(),this.update({constant:!1,value:new n(t)})),this.value=t,i.needsRedraw=!0}return this._updateShaderAttributes(),!0}return i.isExternalBuffer=!1,!1}},{key:"_getVertexOffset",value:function(t,e){if(e){var i=0,n=0,r=!0,a=!1,o=void 0;try{for(var s,c=e[Symbol.iterator]();!(r=(s=c.next()).done);r=!0){var u=s.value;if(n>=t)break;i+=u*this.size,n++}}catch(l){a=!0,o=l}finally{try{r||null==c.return||c.return()}finally{if(a)throw o}}return i}return t*this.size}},{key:"_normalizeValue",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=this.userData.defaultValue;if(!Array.isArray(t)&&!ArrayBuffer.isView(t))return e[i]=Number.isFinite(t)?t:n[0],e;switch(this.size){case 4:e[i+3]=Number.isFinite(t[3])?t[3]:n[3];case 3:e[i+2]=Number.isFinite(t[2])?t[2]:n[2];case 2:e[i+1]=Number.isFinite(t[1])?t[1]:n[1];case 1:e[i+0]=Number.isFinite(t[0])?t[0]:n[0]}return e}},{key:"_areValuesEqual",value:function(t,e){for(var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.size,n=0;n<i;n++)if(t[n]!==e[n])return!1;return!0}},{key:"_standardAccessor",value:function(t,e){var i=e.data,n=e.startRow,r=e.endRow,a=e.props,o=(e.numInstances,e.bufferLayout),s=t.userData.accessor,c=t.value,u=t.size,l="function"==typeof s?s:a[s];g("function"==typeof l,'accessor "'.concat(s,'" is not a function'));var h=t._getVertexOffset(n,o),p=J(i,n,r),d=p.iterable,v=p.objectInfo,f=!0,y=!1,m=void 0;try{for(var b,w=d[Symbol.iterator]();!(f=(b=w.next()).done);f=!0){var _=b.value;v.index++;var j=l(_,v);if(o){t._normalizeValue(j,v.target);var k=o[v.index];Q({target:t.value,source:v.target,start:h,count:k}),h+=k*u}else t._normalizeValue(j,c,h),h+=u}}catch(P){y=!0,m=P}finally{try{f||null==w.return||w.return()}finally{if(y)throw m}}t.constant=!1,t.bufferLayout=o}},{key:"_validateAttributeUpdaters",value:function(){var t=this.userData;if(!(t.noAlloc||"function"==typeof t.update||"string"==typeof t.accessor))throw new Error("Attribute ".concat(this.id," missing update or accessor"))}},{key:"_checkAttributeArray",value:function(){var t=this.value;if(t&&t.length>=4&&!(Number.isFinite(t[0])&&Number.isFinite(t[1])&&Number.isFinite(t[2])&&Number.isFinite(t[3])))throw new Error("Illegal attribute generated for ".concat(this.id))}},{key:"_updateShaderAttributes",value:function(){var t=this.shaderAttributes;for(var e in t){t[e].update({buffer:this.getBuffer(),value:this.value,constant:this.constant})}}},{key:"bufferLayout",get:function(){return this.userData.bufferLayout},set:function(t){this.userData.bufferLayout=t}}]),e}(it);function at(t){var e=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).clamped,i=void 0===e||e;switch(t){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return i?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce type from array")}}function ot(t){var e=t.source,i=t.target,n=t.start,r=void 0===n?0:n,a=t.end,o=t.getData;a=a||i.length;var s=e.length,c=a-r;if(s>c)i.set(e.subarray(0,c),r);else if(i.set(e,r),o)for(var u=s;u<c;)for(var l=o(u,e),h=0;h<l.length;h++)i[r+u]=l[h],u++}var st={1:"float",2:"vec2",3:"vec3",4:"vec4"};function ct(t){var e={},i={};for(var n in t){var r=t[n],a=r.fromState,s=r.toState,c=r.buffer;e["".concat(n,"From")]=a instanceof o.c?[a,{divisor:0}]:a,e["".concat(n,"To")]=s,i["".concat(n)]=c}return{sourceBuffers:e,feedbackBuffers:i}}function ut(t){var e=t.fromState,i=t.toState,n=t.fromLength,r=t.toLength,a=t.fromBufferLayout,s=t.toBufferLayout,c=t.getData,u=void 0===c?function(t){return t}:c;if((a&&s||!(n>=r))&&e instanceof o.c){var l=new Float32Array(r),h=e.getData({}),p=i.size,d=i.constant,v=d?i.getValue():i.getBuffer().getData({}),f=d?function(t,e){return u(v,e)}:function(t,e){return u(v.subarray(t,t+p),e)};!function(t){var e=t.source,i=t.target,n=t.size,r=t.getData,a=t.sourceLayout,o=t.targetLayout;if(!Array.isArray(o))return ot({source:e,target:i,getData:r}),i;for(var s=0,c=0,u=r&&function(t,e){return r(t+c,e)},l=Math.min(a.length,o.length),h=0;h<l;h++){var p=a[h]*n,d=o[h]*n;ot({source:e.subarray(s,s+p),target:i,start:c,end:c+d,getData:u}),s+=p,c+=d}c<i.length&&ot({source:[],target:i,start:c,getData:u})}({source:h,target:l,sourceLayout:a,targetLayout:s,size:i.size,getData:f}),e.setData({data:l})}}var lt={NONE:"none",PENDING:"pending",IN_PROGRESS:"in_progress",ENDED:"ended"};function ht(){}var pt=function(){function t(e){Object(L.a)(this,t),this._startTime=null,this._state=lt.NONE,this.duration=1,this.easing=function(t){return t},this.onStart=ht,this.onUpdate=ht,this.onInterrupt=ht,this.onEnd=ht,Object.assign(this,e)}return Object(A.a)(t,[{key:"start",value:function(t){this.inProgress&&this.onInterrupt(this),Object.assign(this,t),this._setState(lt.PENDING)}},{key:"cancel",value:function(){this.inProgress&&(this.onInterrupt(this),this._setState(lt.NONE))}},{key:"update",value:function(t){if(this.state===lt.PENDING&&(this._startTime=t,this._setState(lt.IN_PROGRESS)),this.state===lt.IN_PROGRESS){var e=!1,i=(t-this._startTime)/this.duration;return i>=1&&(i=1,e=!0),this.time=this.easing(i),this.onUpdate(this),e&&this._setState(lt.ENDED),!0}return!1}},{key:"_setState",value:function(t){if(this._state!==t)switch(this._state=t,t){case lt.PENDING:this.onStart(this);break;case lt.ENDED:this.onEnd(this)}}},{key:"state",get:function(){return this._state}},{key:"inProgress",get:function(){return this._state===lt.PENDING||this._state===lt.IN_PROGRESS}}]),t}(),dt=function(){},vt={duration:0,easing:function(t){return t},onStart:dt,onEnd:dt,onInterrupt:dt},ft=function(){function t(e,i){var n=i.id;Object(L.a)(this,t),this.id=n,this.gl=e,this.attributeTransitions={},this.needsRedraw=!1,this.transform=null,this.numInstances=0,o.q.isSupported(e)?this.isSupported=!0:e&&r.warn("WebGL2 not supported by this browser. Transition animation is disabled.")()}return Object(A.a)(t,[{key:"finalize",value:function(){for(var t in this.transform&&this.transform.delete(),this.attributeTransitions)this._removeTransition(t)}},{key:"update",value:function(t){var e=t.attributes,i=t.transitions,n=void 0===i?{}:i,r=t.numInstances;if(this.opts=n,this.numInstances=r||1,this.isSupported){var a=this.attributeTransitions,o={};for(var s in e){this._updateAttribute(s,e[s])&&(o[s]=a[s])}for(var c in a){var u=e[c];u&&u.supportsTransition()||this._removeTransition(c)}if(this.transform){if(this.transform){var l=ct(o),h=l.sourceBuffers,p=l.feedbackBuffers;this.transform.update({elementCount:this.numInstances,sourceBuffers:h,feedbackBuffers:p})}}else this._createModel()}}},{key:"hasAttribute",value:function(t){return t in this.attributeTransitions}},{key:"getAttributes",value:function(){var t={};for(var e in this.attributeTransitions){var i=this.attributeTransitions[e];i.buffer&&(t[e]=i.attributeInTransition)}return t}},{key:"setCurrentTime",value:function(t){if(!this.transform||0===this.numInstances)return!1;var e={},i=this.needsRedraw;for(var n in this.needsRedraw=!1,this.attributeTransitions){var r=this.attributeTransitions[n];r.update(t)&&(e["".concat(n,"Time")]=r.time,i=!0)}return i&&this.transform.run({uniforms:e}),i}},{key:"_createTransition",value:function(t,e){var i=this.attributeTransitions[t];return i?null:(i=new pt({name:t,attribute:e,attributeInTransition:new rt(this.gl,e),bufferLayout:e.bufferLayout}),this.attributeTransitions[t]=i,this._invalidateModel(),i)}},{key:"_removeTransition",value:function(t){var e=this.attributeTransitions[t];e&&(e.buffer&&e.buffer.delete(),e._swapBuffer&&e._swapBuffer.delete(),delete this.attributeTransitions[t],this._invalidateModel())}},{key:"_updateAttribute",value:function(t,e){var i=e.getTransitionSetting(this.opts);if(i){var n,r=this.attributeTransitions[t];if(r?n=e.needsRedraw():(r=this._createTransition(t,e),n=!0),n)return this._triggerTransition(r,i),!0}return!1}},{key:"_invalidateModel",value:function(){this.transform&&(this.transform.delete(),this.transform=null)}},{key:"_createModel",value:function(){0!==Object.keys(this.attributeTransitions).length&&(this.transform=new o.q(this.gl,Object.assign({elementCount:this.numInstances},ct(this.attributeTransitions),function(t){var e=[],i=[],n=[],r=[],a=[];for(var o in t){var s=t[o],c=st[s.attribute.size];c&&(s.bufferIndex=e.length,e.push(o),i.push("attribute ".concat(c," ").concat(o,"From;")),i.push("attribute ".concat(c," ").concat(o,"To;")),n.push("uniform float ".concat(o,"Time;")),r.push("varying ".concat(c," ").concat(o,";")),a.push("".concat(o," = mix(").concat(o,"From, ").concat(o,"To,\n        ").concat(o,"Time);")))}return{vs:"\n#define SHADER_NAME feedback-vertex-shader\n".concat(i.join("\n"),"\n").concat(n.join("\n"),"\n").concat(r.join("\n"),"\n\nvoid main(void) {\n  ").concat(a.join("\n"),"\n  gl_Position = vec4(0.0);\n}\n"),fs:"#define SHADER_NAME feedback-fragment-shader\n\nprecision highp float;\n\n".concat(r.join("\n"),"\n\nvoid main(void) {\n  gl_FragColor = vec4(0.0);\n}\n"),varyings:e}}(this.attributeTransitions))))}},{key:"_getNextTransitionStates",value:function(t,e){var i,n=t.attribute,r=n.size;i=n.constant?new it(this.gl,{constant:!0,value:n.value,size:r}):new it(this.gl,{constant:!1,buffer:n.getBuffer(),divisor:0,size:r,value:n.externalBuffer?null:n.value});var a=t.buffer||i,s=this.numInstances*r,c=a instanceof o.c&&a.getElementCount()||s,u=t._swapBuffer;return t._swapBuffer=t.buffer,u?u.getElementCount()<s&&u.setData({data:new Float32Array(s)}):u=new o.c(this.gl,{data:new Float32Array(s),usage:35050}),t.attributeInTransition.update({buffer:u}),ut({fromState:a,toState:i,fromLength:c,toLength:s,fromBufferLayout:t.bufferLayout,toBufferLayout:n.bufferLayout,getData:e.enter}),t.bufferLayout=n.bufferLayout,{fromState:a,toState:i,buffer:u}}},{key:"_triggerTransition",value:function(t,e){g(e&&e.duration>0),this.needsRedraw=!0;var i=Object.assign({},vt,e);t.start(Object.assign({},this._getNextTransitionStates(t,e),i))}}]),t}();function gt(){}var yt={savedMessages:null,timeStart:null,onLog:function(t){var e=t.level,i=t.message;r.log(e,i)()},onUpdateStart:function(t){t.level,t.numInstances;yt.savedMessages=[],yt.timeStart=new Date},onUpdate:function(t){t.level;var e=t.message;yt.savedMessages&&yt.savedMessages.push(e)},onUpdateEnd:function(t){var e=t.level,i=t.id,n=t.numInstances,a=Math.round(new Date-yt.timeStart),o="".concat(a,"ms");r.group(e,"Updated attributes for ".concat(n," instances in ").concat(i," in ").concat(o),{collapsed:!0})();var s=!0,c=!1,u=void 0;try{for(var l,h=yt.savedMessages[Symbol.iterator]();!(s=(l=h.next()).done);s=!0){var p=l.value;r.log(e,p)()}}catch(d){c=!0,u=d}finally{try{s||null==h.return||h.return()}finally{if(c)throw u}}r.groupEnd(e,"Updated attributes for ".concat(n," instances in ").concat(i," in ").concat(o))(),yt.savedMessages=null}},mt=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=i.id,r=void 0===n?"attribute-manager":n,a=i.stats;Object(L.a)(this,t),this.id=r,this.gl=e,this.attributes={},this.updateTriggers={},this.accessors={},this.needsRedraw=!0,this.userData={},this.stats=a,this.attributeTransitionManager=new ft(e,{id:"".concat(r,"-transitions")}),Object.seal(this)}return Object(A.a)(t,null,[{key:"setDefaultLogFunctions",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.onLog,i=t.onUpdateStart,n=t.onUpdate,r=t.onUpdateEnd;void 0!==e&&(yt.onLog=e||gt),void 0!==i&&(yt.onUpdateStart=i||gt),void 0!==n&&(yt.onUpdate=n||gt),void 0!==r&&(yt.onUpdateEnd=r||gt)}}]),Object(A.a)(t,[{key:"finalize",value:function(){for(var t in this.attributes)this.attributes[t].delete();this.attributeTransitionManager.finalize()}},{key:"getNeedsRedraw",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearRedrawFlags:!1},e=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!t.clearRedrawFlags,e&&this.id}},{key:"setNeedsRedraw",value:function(){!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.needsRedraw=!0,this}},{key:"add",value:function(t,e){this._add(t,e)}},{key:"addInstanced",value:function(t,e){this._add(t,e,{instanced:1})}},{key:"remove",value:function(t){for(var e=0;e<t.length;e++){var i=t[e];void 0!==this.attributes[i]&&(this.attributes[i].delete(),delete this.attributes[i])}}},{key:"invalidate",value:function(t,e){var i=this._invalidateTrigger(t,e);yt.onLog({level:3,message:"invalidated attributes ".concat(i," (").concat(t,") for ").concat(this.id)})}},{key:"invalidateAll",value:function(t){for(var e in this.attributes)this.attributes[e].setNeedsUpdate(e,t);yt.onLog({level:3,message:"invalidated all attributes for ".concat(this.id)})}},{key:"update",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.data,i=t.numInstances,n=t.bufferLayout,r=t.transitions,a=t.props,o=void 0===a?{}:a,s=t.buffers,c=void 0===s?{}:s,u=t.context,l=void 0===u?{}:u,h=!1;for(var p in yt.onUpdateStart({level:2,id:this.id,numInstances:i}),this.stats&&this.stats.get("Update Attributes").timeStart(),this.attributes){var d=this.attributes[p];d.setExternalBuffer(c[p],this.numInstances)||d.setGenericValue(o[d.getAccessor()])||d.needsUpdate()&&(h=!0,this._updateAttribute({attribute:d,numInstances:i,bufferLayout:n,data:e,props:o,context:l})),this.needsRedraw|=d.needsRedraw()}h&&yt.onUpdateEnd({level:2,id:this.id,numInstances:i}),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:i,transitions:r})}},{key:"updateTransition",value:function(t){var e=this.attributeTransitionManager.setCurrentTime(t);return this.needsRedraw=this.needsRedraw||e,e}},{key:"getAttributes",value:function(){return this.attributes}},{key:"getChangedAttributes",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearChangedFlags:!1},e=this.attributes,i=this.attributeTransitionManager,n=Object.assign({},i.getAttributes());for(var r in e){var a=e[r];a.needsRedraw(t)&&!i.hasAttribute(r)&&(n[r]=a)}return n}},{key:"getAccessors",value:function(){return this.updateTriggers}},{key:"_add",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};e&&r.warn("AttributeManager.add({updaters}) - updater map no longer supported")();var n={};for(var a in t){var o=t[a],s=this._createAttribute(a,o,i);n[a]=s}Object.assign(this.attributes,n),this._mapUpdateTriggersToAttributes()}},{key:"_createAttribute",value:function(t,e,i){var n={id:t,constant:e.constant||!1,isIndexed:e.isIndexed||e.elements,size:e.elements?1:e.size,value:e.value||null,divisor:e.instanced||i.instanced?1:e.divisor};return new rt(this.gl,Object.assign({},e,n))}},{key:"_mapUpdateTriggersToAttributes",value:function(){var t=this,e={},i=function(i){t.attributes[i].getUpdateTriggers().forEach(function(t){e[t]||(e[t]=[]),e[t].push(i)})};for(var n in this.attributes)i(n);this.updateTriggers=e}},{key:"_invalidateTrigger",value:function(t,e){var i=this.attributes,n=this.updateTriggers[t];if(n)n.forEach(function(t){var n=i[t];n&&n.setNeedsUpdate(n.id,e)});else{var a="invalidating non-existent trigger ".concat(t," for ").concat(this.id,"\n");a+="Valid triggers: ".concat(Object.keys(i).join(", ")),r.warn(a,n)()}return n}},{key:"_updateAttribute",value:function(t){var e=t.attribute,i=t.numInstances;e.allocate(i)&&yt.onUpdate({level:3,message:"".concat(e.id," allocated ").concat(i),id:this.id});var n=Date.now();if(e.updateBuffer(t)){this.needsRedraw=!0;var r=Math.round(Date.now()-n);yt.onUpdate({level:3,message:"".concat(e.id," updated ").concat(i," in ").concat(r,"ms")})}}}]),t}(),bt=i(249),wt=i(306),_t=i.n(wt),jt=new Map,kt=function(t){if(_t.a.isReady()&&t.id){var e=jt.get(t.id);e&&e.forEach(function(e,i){!function t(e,i,n){e&&(i.length>1?t(e[i[0]],i.slice(1),n):e[i[0]]=n)}(t,i,e),"data"===i[0]&&(t.data=Object(bt.a)(t.data))})}},Pt=function(t){_t.a.isReady()&&_t.a.listenFor("deck.gl",t)},Ot=function(t){_t.a.isReady()&&_t.a.listenFor("init",t)},xt=function(t){if(_t.a.isReady()&&t){var e=[t.constructor.layerName];_t.a.listItem("deck.gl",t.id,{badges:e,links:t.state&&t.state.model?["luma.gl:".concat(t.state.model.id)]:void 0,parent:t.parent?t.parent.id:void 0})}},St=function(t){if(_t.a.isReady()&&!_t.a.throttle("deck.gl:".concat(t.id),1e3)){var e=function(t){var e=[{path:"objects.props",data:t.props}],i=[t.constructor.layerName];if(t.state){if(t.getAttributeManager()){var n=t.getAttributeManager().getAttributes();e.push({path:"objects.attributes",data:n})}if(t.state.model){t.state.model.setProps({timerQueryEnabled:!0});var r=t.state.model.stats.lastFrameTime;r&&i.push("".concat((1e3*r).toFixed(0),"μs"))}}return e.push({path:"badges",data:i}),e}(t);_t.a.multiUpdate("deck.gl",t.id,e)}};var Mt=i(226);function Tt(t,e){var i=Ct({newProps:t,oldProps:e,propTypes:Lt(t),ignoreProps:{data:null,updateTriggers:null}}),n=function(t,e){if(null===e)return"oldProps is null, initial diff";var i=t.dataComparator;if(i){if(!i(t.data,e.data))return"Data comparator detected a change"}else if(t.data!==e.data)return"A new data container was supplied";return null}(t,e),r=!1;return n||(r=function(t,e){if(null===e)return"oldProps is null, initial diff";if("all"in t.updateTriggers){var i=Et(t,e,"all");if(i)return{all:!0}}var n={},r=!1;for(var a in t.updateTriggers)if("all"!==a){var o=Et(t,e,a);o&&(n[a]=!0,r=n)}return r}(t,e)),{dataChanged:n,propsChanged:i,updateTriggersChanged:r}}function Ct(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.newProps,i=t.oldProps,n=t.ignoreProps,r=void 0===n?{}:n,a=t.propTypes,o=void 0===a?{}:a,s=t.triggerName,c=void 0===s?"props":s;if(g(void 0!==i&&void 0!==e,"compareProps args"),i===e)return null;if("object"!==Object(Mt.a)(e)||null===e)return"".concat(c," changed shallowly");if("object"!==Object(Mt.a)(i)||null===i)return"".concat(c," changed shallowly");for(var u in i)if(!(u in r)){if(!(u in e))return"".concat(c,".").concat(u," dropped");var l=e[u],h=i[u],p=o[u],d=p&&p.equal;if(d&&!d(l,h,p))return"".concat(c,".").concat(u," changed deeply");if(!d&&(d=l&&h&&l.equals)&&!d.call(l,h))return"".concat(c,".").concat(u," changed deeply");if(!d&&h!==l)return"".concat(c,".").concat(u," changed shallowly")}for(var v in e)if(!(v in r||v in i))return"".concat(c,".").concat(v," added: undefined -> ").concat(e[v]);return null}function Et(t,e,i){var n=t.updateTriggers[i];n=null==n?{}:n;var r=e.updateTriggers[i];return Ct({oldProps:r=null==r?{}:r,newProps:n,triggerName:i})}function Lt(t){var e=t._component,i=e&&e.constructor;return i?i._propTypes:{}}var At="count(): argument not an object",It="count(): argument not a container";function Rt(t){if(null===(e=t)||"object"!==Object(Mt.a)(e))throw new Error(At);var e;if("function"==typeof t.count)return t.count();if(Number.isFinite(t.size))return t.size;if(Number.isFinite(t.length))return t.length;if(function(t){return null!==t&&"object"===Object(Mt.a)(t)&&t.constructor===Object}(t))return Object.keys(t).length;throw new Error(It)}var Ft={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},Nt={boolean:{validate:function(t,e){return!0},equal:function(t,e,i){return Boolean(t)===Boolean(e)}},number:{validate:function(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},color:{validate:function(t,e){return Ut(t)&&(3===t.length||4===t.length)},equal:function(t,e,i){return zt(t,e)}},accessor:{validate:function(t,e){var i=Bt(t);return"function"===i||i===Bt(e.value)},equal:function(t,e,i){return"function"==typeof e||zt(t,e)}},array:{validate:function(t,e){return e.optional&&!t||Ut(t)},equal:function(t,e,i){return i.compare?zt(t,e):t===e}},function:{validate:function(t,e){return e.optional&&!t||"function"==typeof t},equal:function(t,e,i){return!i.compare||t===e}}};function zt(t,e){if(t===e)return!0;if(!Ut(t)||!Ut(e))return!1;var i=t.length;if(i!==e.length)return!1;for(var n=0;n<i;n++)if(t[n]!==e[n])return!1;return!0}function Dt(t,e){switch(Bt(e)){case"object":return Vt(t,e);case"array":return Vt(t,{type:"array",value:e,compare:!1});case"boolean":return Vt(t,{type:"boolean",value:e});case"number":return Vt(t,{type:"number",value:e});case"function":return Vt(t,{type:"function",value:e,compare:!0});default:return{name:t,type:"unknown",value:e}}}function Vt(t,e){return"type"in e?Object.assign({name:t},Nt[e.type],e):"value"in e?Object.assign({name:t,type:Bt(e.value)},e):{name:t,type:"object",value:e}}function Ut(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function Bt(t){return Ut(t)?"array":null===t?"null":Object(Mt.a)(t)}function Zt(t,e,i){if(e)for(var n in i)if(Yt(e,n)){var a="".concat(t||"Layer",": ").concat(n),o=!0,s=!1,c=void 0;try{for(var u,l=i[n][Symbol.iterator]();!(o=(u=l.next()).done);o=!0){var h=u.value;Yt(e,h)||(e[h]=e[n])}}catch(p){s=!0,c=p}finally{try{o||null==l.return||l.return()}finally{if(s)throw c}}r.deprecated(a,i[n].join("/"))()}}function Gt(t){var e=Wt(t,"_mergedDefaultProps");return e?{defaultProps:e,propTypes:Wt(t,"_propTypes"),deprecatedProps:Wt(t,"_deprecatedProps")}:function(t){var e=t.prototype;if(!e)return{defaultProps:{}};var i=Object.getPrototypeOf(t),n=e&&Gt(i)||null,a=function(t){for(var e={},i={},n={},r=Object.entries(t),a=0;a<r.length;a++){var o=Object(B.a)(r[a],2),s=o[0],c=o[1];if(c&&c.deprecatedFor)n[s]=Array.isArray(c.deprecatedFor)?c.deprecatedFor:[c.deprecatedFor];else{var u=Dt(s,c);e[s]=u,i[s]=u.value}}return{propTypes:e,defaultProps:i,deprecatedProps:n}}(Wt(t,"defaultProps")||{}),o=Object.assign({},n&&n.propTypes,a.propTypes),s=function(t,e,i,n){var a=Object.create(null);Object.assign(a,e,t);var o=function(t){var e=Wt(t,"layerName")||Wt(t,"componentName");e||r.once(0,"".concat(t.name,".componentName not specified"))();return e||t.name}(n);return delete t.id,Object.defineProperties(a,{id:{configurable:!1,writable:!0,value:o}}),function(t,e){var i={},n={_asyncPropDefaultValues:{enumerable:!1,value:i},_asyncPropOriginalValues:{enumerable:!1,value:{}}};for(var r in e){var a=e[r],o=a.name,s=a.value;a.async&&(i[o]=s,n[o]=Xt(o))}Object.defineProperties(t,n)}(a,i),a}(a.defaultProps,n&&n.defaultProps,o,t),c=Object.assign({},n&&n.deprecatedProps,a.deprecatedProps);return t._mergedDefaultProps=s,t._propTypes=o,t._deprecatedProps=c,{propTypes:o,defaultProps:s,deprecatedProps:c}}(t)}function Xt(t){return{configurable:!1,enumerable:!0,set:function(e){"string"==typeof e||e instanceof Promise?this._asyncPropOriginalValues[t]=e:this._asyncPropResolvedValues[t]=e},get:function(){if(this._asyncPropResolvedValues){if(t in this._asyncPropResolvedValues){var e=this._asyncPropResolvedValues[t];return"data"===t?e||this._asyncPropDefaultValues[t]:e}if(t in this._asyncPropOriginalValues){var i=this._component&&this._component.internalState;if(i&&i.hasAsyncProp(t))return i.getAsyncProp(t)}}return this._asyncPropDefaultValues[t]}}}function Yt(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Wt(t,e){return Yt(t,e)&&t[e]}var qt=Object.freeze({}),Ht=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;Object(L.a)(this,t),this.component=e,this.asyncProps={},this.onAsyncPropUpdated=function(){},this.oldProps=qt,this.oldAsyncProps=null}return Object(A.a)(t,[{key:"getOldProps",value:function(){return this.oldAsyncProps||this.oldProps}},{key:"resetOldProps",value:function(){this.oldAsyncProps=null,this.oldProps=this.component.props}},{key:"freezeAsyncOldProps",value:function(){if(!this.oldAsyncProps)for(var t in this.oldProps=this.oldProps||this.component.props,this.oldAsyncProps={},this.oldProps)this.oldAsyncProps[t]=this.oldProps[t]}},{key:"hasAsyncProp",value:function(t){return t in this.asyncProps}},{key:"getAsyncProp",value:function(t){var e=this.asyncProps[t];return e&&e.resolvedValue}},{key:"isAsyncPropLoading",value:function(t){var e=this.asyncProps[t];return Boolean(e&&e.pendingLoadCount>0&&e.pendingLoadCount!==e.resolvedLoadCount)}},{key:"setAsyncProps",value:function(t){var e=t._asyncPropResolvedValues||{},i=t._asyncPropOriginalValues||t,n=t._asyncPropDefaultValues||{};for(var r in e){var a=e[r];this._createAsyncPropData(r,a,n[r]),this._updateAsyncProp(r,a)}for(var o in i){var s=i[o];this._createAsyncPropData(o,s,n[o]),this._updateAsyncProp(o,s)}}},{key:"_updateAsyncProp",value:function(t,e){if(this._didAsyncInputValueChange(t,e)){if("string"==typeof e)e=(0,this.layer.props.fetch)(e,{propName:t,layer:this.layer});e instanceof Promise?this._watchPromise(t,e):this._setPropValue(t,e)}}},{key:"_didAsyncInputValueChange",value:function(t,e){var i=this.asyncProps[t];return e!==i.lastValue&&(i.lastValue=e,!0)}},{key:"_setPropValue",value:function(t,e){var i=this.asyncProps[t];i.value=e,i.resolvedValue=e,i.pendingLoadCount++,i.resolvedLoadCount=i.pendingLoadCount}},{key:"_setAsyncPropValue",value:function(t,e,i){var n=this.asyncProps[t];n&&i>=n.resolvedLoadCount&&(g(void 0!==e),this.freezeAsyncOldProps(),e=this._postProcessValue(t,e),n.resolvedValue=e,n.resolvedLoadCount=i,this.onAsyncPropUpdated(t,e))}},{key:"_watchPromise",value:function(t,e){var i=this,n=this.asyncProps[t];n.pendingLoadCount++;var a=n.pendingLoadCount;e.then(function(e){return i._setAsyncPropValue(t,e,a)}).catch(function(t){return r.error(t)()})}},{key:"_postProcessValue",value:function(t,e){var i=(this.component?this.component.props:{}).dataTransform;return"data"===t&&i&&(e=i(e)),e}},{key:"_createAsyncPropData",value:function(t,e,i){this.asyncProps[t]||(this.asyncProps[t]={lastValue:null,resolvedValue:i,pendingLoadCount:0,resolvedLoadCount:0})}}]),t}(),Kt=0,Jt=function(){function t(){Object(L.a)(this,t),this.props=function(){for(var t=Gt(this.constructor),e=t.defaultProps,i=Object.create(e,{_component:{enumerable:!1,value:this},_asyncPropOriginalValues:{enumerable:!1,value:{}},_asyncPropResolvedValues:{enumerable:!1,value:{}}}),n=0;n<arguments.length;++n)Object.assign(i,arguments[n]);var r=this.constructor.layerName,a=t.deprecatedProps;return Zt(r,i,a),Zt(r,i.updateTriggers,a),Zt(r,i.transitions,a),kt(i),Object.freeze(i),i}.apply(this,arguments),this.id=this.props.id,this.count=Kt++,this.lifecycle=Ft.NO_STATE,this.parent=null,this.context=null,this.state=null,this.internalState=null,Object.seal(this)}return Object(A.a)(t,[{key:"clone",value:function(t){var e=this.props,i={};for(var n in e._asyncPropDefaultValues)n in e._asyncPropResolvedValues?i[n]=e._asyncPropResolvedValues[n]:n in e._asyncPropOriginalValues&&(i[n]=e._asyncPropOriginalValues[n]);return new this.constructor(Object.assign({},e,i,t))}},{key:"_initState",value:function(){this.internalState=new Ht({})}},{key:"stats",get:function(){return this.internalState.stats}}]),t}();Jt.componentName="Component",Jt.defaultProps={};var $t=function(t){function e(t){var i,n=t.attributeManager,r=t.layer;return Object(L.a)(this,e),(i=Object(I.a)(this,Object(R.a)(e).call(this,r))).attributeManager=n,i.model=null,i.needsRedraw=!0,i.subLayers=null,i}return Object(F.a)(e,t),Object(A.a)(e,[{key:"layer",get:function(){return this.component},set:function(t){this.component=t}}]),e}(Ht),Qt=Object.freeze([]),te=new Uint8ClampedArray(0),ee={data:{type:"data",value:Qt,async:!0},dataComparator:null,dataTransform:{type:"function",value:function(t){return t},compare:!1},fetch:{type:"function",value:function(t){return fetch(t).then(function(t){return t.json()})},compare:!1},updateTriggers:{},numInstances:void 0,visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:.8},onHover:{type:"function",value:null,compare:!1,optional:!0},onClick:{type:"function",value:null,compare:!1,optional:!0},onDragStart:{type:"function",value:null,compare:!1,optional:!0},onDrag:{type:"function",value:null,compare:!1,optional:!0},onDragEnd:{type:"function",value:null,compare:!1,optional:!0},coordinateSystem:p.LNGLAT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,parameters:{},uniforms:{},framebuffer:null,animation:null,getPolygonOffset:{type:"function",value:function(t){return[0,100*-t.layerIndex]},compare:!1},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"color",value:[0,0,128,128]}},ie=function(t){function e(){return Object(L.a)(this,e),Object(I.a)(this,Object(R.a)(e).apply(this,arguments))}return Object(F.a)(e,t),Object(A.a)(e,[{key:"toString",value:function(){var t=this.constructor.layerName||this.constructor.name;return"".concat(t,"({id: '").concat(this.props.id,"'})")}},{key:"setState",value:function(t){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,t),this.setNeedsRedraw()}},{key:"setNeedsRedraw",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.internalState&&(this.internalState.needsRedraw=t)}},{key:"setLayerNeedsUpdate",value:function(){this.context.layerManager.setNeedsUpdate(String(this))}},{key:"getNeedsRedraw",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearRedrawFlags:!1};return this._getNeedsRedraw(t)}},{key:"needsUpdate",value:function(){return this.shouldUpdateState(this._getUpdateParams())}},{key:"isPickable",value:function(){return this.props.pickable&&this.props.visible}},{key:"getModels",value:function(){return this.state&&(this.state.models||(this.state.model?[this.state.model]:[]))}},{key:"getSingleModel",value:function(){return this.state&&this.state.model}},{key:"getAttributeManager",value:function(){return this.internalState&&this.internalState.attributeManager}},{key:"getCurrentLayer",value:function(){return this.internalState&&this.internalState.layer}},{key:"getFirstObject",value:function(){var t=this.props.data,e=!0,i=!1,n=void 0;try{for(var r,a=t[Symbol.iterator]();!(e=(r=a.next()).done);e=!0){return r.value}}catch(o){i=!0,n=o}finally{try{e||null==a.return||a.return()}finally{if(i)throw n}}return null}},{key:"project",value:function(t){var e=this.context.viewport,i=Y(t,{viewport:e,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),n=Object(G.k)(i,e.pixelProjectionMatrix),r=Object(B.a)(n,3),a=r[0],o=r[1],s=r[2];return 2===t.length?[a,o]:[a,o,s]}},{key:"unproject",value:function(t){var e=this.context.viewport;return g(Array.isArray(t)),e.unproject(t)}},{key:"projectPosition",value:function(t){return g(Array.isArray(t)),W(t,{viewport:this.context.viewport,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem})}},{key:"projectFlat",value:function(t){r.deprecated("layer.projectFlat","layer.projectPosition")();var e=this.context.viewport;return g(Array.isArray(t)),e.projectFlat(t)}},{key:"unprojectFlat",value:function(t){r.deprecated("layer.unprojectFlat")();var e=this.context.viewport;return g(Array.isArray(t)),e.unprojectFlat(t)}},{key:"use64bitProjection",value:function(){if(this.props.fp64){if(this.props.coordinateSystem===p.LNGLAT_DEPRECATED)return!0;r.once(0,"Legacy 64-bit mode only works with coordinateSystem set to\n        COORDINATE_SYSTEM.LNGLAT_DEPRECATED. Rendering in 32-bit mode instead")()}return!1}},{key:"use64bitPositions",value:function(){return this.props.fp64||this.props.coordinateSystem===p.LNGLAT||this.props.coordinateSystem===p.IDENTITY}},{key:"screenToDevicePixels",value:function(t){return r.deprecated("screenToDevicePixels","DeckGL prop useDevicePixels for conversion")(),t*("undefined"!=typeof window?window.devicePixelRatio:1)}},{key:"onHover",value:function(t,e){return!!this.props.onHover&&this.props.onHover(t,e)}},{key:"onClick",value:function(t,e){return!!this.props.onClick&&this.props.onClick(t,e)}},{key:"nullPickingColor",value:function(){return[0,0,0]}},{key:"encodePickingColor",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return g(t<16777215,"index out of picking color range"),e[0]=t+1&255,e[1]=t+1>>8&255,e[2]=t+1>>8>>8&255,e}},{key:"decodePickingColor",value:function(t){g(t instanceof Uint8Array);var e=Object(B.a)(t,3);return e[0]+256*e[1]+65536*e[2]-1}},{key:"initializeState",value:function(){throw new Error("Layer ".concat(this," has not defined initializeState"))}},{key:"shouldUpdateState",value:function(t){t.oldProps,t.props,t.context;return t.changeFlags.propsOrDataChanged}},{key:"updateState",value:function(t){t.oldProps,t.props,t.context;var e=t.changeFlags,i=this.getAttributeManager();e.dataChanged&&i&&i.invalidateAll()}},{key:"finalizeState",value:function(){var t=!0,e=!1,i=void 0;try{for(var n,r=this.getModels()[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){n.value.delete()}}catch(o){e=!0,i=o}finally{try{t||null==r.return||r.return()}finally{if(e)throw i}}var a=this.getAttributeManager();a&&a.finalize()}},{key:"draw",value:function(t){var e=!0,i=!1,n=void 0;try{for(var r,a=this.getModels()[Symbol.iterator]();!(e=(r=a.next()).done);e=!0){r.value.draw(t)}}catch(o){i=!0,n=o}finally{try{e||null==a.return||a.return()}finally{if(i)throw n}}}},{key:"getPickingInfo",value:function(t){var e=t.info,i=(t.mode,e.index);return i>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[i]),e}},{key:"invalidateAttribute",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"all",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=this.getAttributeManager();i&&("all"===t?(r.log(1,"updateTriggers invalidating all attributes: ".concat(e))(),i.invalidateAll()):(r.log(1,"updateTriggers invalidating attribute ".concat(t,": ").concat(e))(),i.invalidate(t)))}},{key:"updateAttributes",value:function(t){var e=this.getAttributeManager();if(e){var i=this.getNumInstances(t),n=this.getBufferLayout(t);e.update({data:t.data,numInstances:i,bufferLayout:n,props:t,transitions:t.transitions,buffers:t,context:this,ignoreUnknownAttributes:!0});var r=this.getModels();if(r.length>0)for(var a=e.getChangedAttributes({clearChangedFlags:!0}),o=0,s=r.length;o<s;++o)this._setModelAttributes(r[o],a)}}},{key:"updateTransition",value:function(){var t=this.getAttributeManager();t&&t.updateTransition(this.context.time)}},{key:"calculateInstancePickingColors",value:function(t,e){var i=e.numInstances,n=t.value,r=t.size;if(1!==n[0]){var a=te.length/r;if(a<i){var o=new Uint8ClampedArray(i*r);o.set(te);for(var s=[],c=a;c<i;c++)this.encodePickingColor(c,s),o[c*r+0]=s[0],o[c*r+1]=s[1],o[c*r+2]=s[2];te=o}n.set(i<a?te.subarray(0,i*r):te)}}},{key:"_setModelAttributes",value:function(t,e){var i={},n=t.userData.excludeAttributes||{};for(var r in e)n[r]||Object.assign(i,e[r].getShaderAttributes());t.setAttributes(i)}},{key:"_clearInstancePickingColor",value:function(t){var e=this.getAttributeManager().attributes.instancePickingColors,i=e.value,n=e.size,r=this.decodePickingColor(t);i[r*n+0]=0,i[r*n+1]=0,i[r*n+2]=0,e.update({value:i})}},{key:"_clearPickingColor",value:function(t){for(var e=this.getAttributeManager().attributes.pickingColors,i=e.value,n=0;n<i.length;n+=3)i[n+0]===t[0]&&i[n+1]===t[1]&&i[n+2]===t[2]&&(i[n+0]=0,i[n+1]=0,i[n+2]=0);e.update({value:i})}},{key:"clearPickingColor",value:function(t){this.getAttributeManager().attributes.pickingColors?this._clearPickingColor(t):this._clearInstancePickingColor(t)}},{key:"copyPickingColors",value:function(){var t=this.getAttributeManager().attributes,e=t.pickingColors,i=t.instancePickingColors;return new Uint8ClampedArray((e||i).value)}},{key:"restorePickingColors",value:function(t){var e=this.getAttributeManager().attributes,i=e.pickingColors,n=e.instancePickingColors;(i||n).update({value:t})}},{key:"getNumInstances",value:function(t){return void 0!==(t=t||this.props).numInstances?t.numInstances:this.state&&void 0!==this.state.numInstances?this.state.numInstances:Rt(this.props.data)}},{key:"getBufferLayout",value:function(t){return void 0!==(t=t||this.props).bufferLayout?t.bufferLayout:this.state&&void 0!==this.state.bufferLayout?this.state.bufferLayout:null}},{key:"_initialize",value:function(){this._initState(),this.initializeState(this.context),this.state.attributeManager=this.getAttributeManager(),this.setChangeFlags({dataChanged:!0,propsChanged:!0,viewportChanged:!0}),this._updateState();var t=this.getSingleModel();t&&(t.id=this.props.id,t.program.id="".concat(this.props.id,"-program"))}},{key:"_update",value:function(){this.needsUpdate()&&this._updateState()}},{key:"_updateState",value:function(){var t=this._getUpdateParams();if(this.context.gl)this.updateState(t);else try{this.updateState(t)}catch(e){}this.isComposite?this._renderLayers(t):(this.setNeedsRedraw(),this.updateAttributes(this.props),this._updateBaseUniforms(),this.state.model&&this.state.model.setInstanceCount(this.getNumInstances())),this.clearChangeFlags(),this.internalState.resetOldProps()}},{key:"_finalize",value:function(){var t;g(this.internalState&&this.state),this.finalizeState(this.context),t=this.id,_t.a.isReady()&&t&&_t.a.deleteItem("deck.gl",t)}},{key:"drawLayer",value:function(t){var e=this,i=t.moduleParameters,n=void 0===i?null:i,r=t.uniforms,a=void 0===r?{}:r,s=t.parameters,c=void 0===s?{}:s;a.picking_uActive||this.updateTransition(),n&&this.setModuleParameters(n);var u=this.context.animationProps;if(u){var l=!0,h=!1,p=void 0;try{for(var d,v=this.getModels()[Symbol.iterator]();!(l=(d=v.next()).done);l=!0){d.value._setAnimationProps(u)}}catch(y){h=!0,p=y}finally{try{l||null==v.return||v.return()}finally{if(h)throw p}}}var f=this.props.getPolygonOffset,g=f&&f(a)||[0,0];c.polygonOffset=g,Object(o.O)(this.context.gl,c,function(){e.draw({moduleParameters:n,uniforms:a,parameters:c,context:e.context})})}},{key:"pickLayer",value:function(t){return this.getPickingInfo(t)}},{key:"getChangeFlags",value:function(){return this.internalState.changeFlags}},{key:"setChangeFlags",value:function(t){var e=this;this.internalState.changeFlags=this.internalState.changeFlags||{};var i=this.internalState.changeFlags;t.dataChanged&&!i.dataChanged&&(i.dataChanged=t.dataChanged,r.log(2,function(){return"dataChanged: ".concat(t.dataChanged," in ").concat(e.id)})()),t.updateTriggersChanged&&!i.updateTriggersChanged&&(i.updateTriggersChanged=i.updateTriggersChanged&&t.updateTriggersChanged?Object.assign({},t.updateTriggersChanged,i.updateTriggersChanged):t.updateTriggersChanged||i.updateTriggersChanged,r.log(2,function(){return"updateTriggersChanged: "+"".concat(Object.keys(t.updateTriggersChanged).join(", ")," in ").concat(e.id)})()),t.propsChanged&&!i.propsChanged&&(i.propsChanged=t.propsChanged,r.log(2,function(){return"propsChanged: ".concat(t.propsChanged," in ").concat(e.id)})()),t.viewportChanged&&!i.viewportChanged&&(i.viewportChanged=t.viewportChanged,r.log(3,function(){return"viewportChanged: ".concat(t.viewportChanged," in ").concat(e.id)})()),t.stateChanged&&!i.stateChanged&&(i.stateChanged=t.stateChanged,r.log(2,function(){return"stateChanged: ".concat(t.stateChanged," in ").concat(e.id)})());var n=t.dataChanged||t.updateTriggersChanged||t.propsChanged;i.propsOrDataChanged=i.propsOrDataChanged||n,i.somethingChanged=i.somethingChanged||n||t.viewportChanged||t.stateChanged}},{key:"clearChangeFlags",value:function(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}},{key:"printChangeFlags",value:function(){var t=this.internalState.changeFlags;return"".concat(t.dataChanged?"data ":"").concat(t.propsChanged?"props ":"").concat(t.updateTriggersChanged?"triggers ":"").concat(t.viewportChanged?"viewport":"")}},{key:"diffProps",value:function(t,e){var i=Tt(t,e);if(i.updateTriggersChanged)for(var n in i.updateTriggersChanged)i.updateTriggersChanged[n]&&this._activeUpdateTrigger(n);return this.setChangeFlags(i)}},{key:"validateProps",value:function(){!function(t){var e=Lt(t);for(var i in e){var n=e[i],r=n.validate;if(r&&!r(t[i],n))throw new Error("Invalid prop ".concat(i,": ").concat(t[i]))}}(this.props)}},{key:"setModuleParameters",value:function(t){var e=!0,i=!1,n=void 0;try{for(var r,a=this.getModels()[Symbol.iterator]();!(e=(r=a.next()).done);e=!0){r.value.updateModuleSettings(t)}}catch(o){i=!0,n=o}finally{try{e||null==a.return||a.return()}finally{if(i)throw n}}}},{key:"_getUpdateParams",value:function(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}},{key:"_getNeedsRedraw",value:function(t){if(!this.internalState)return!1;var e=!1;e=e||this.internalState.needsRedraw&&this.id,this.internalState.needsRedraw=this.internalState.needsRedraw&&!t.clearRedrawFlags;var i=this.getAttributeManager(),n=i&&i.getNeedsRedraw(t);return e=e||n}},{key:"_getAttributeManager",value:function(){return new mt(this.context.gl,{id:this.props.id,stats:this.context.stats})}},{key:"_initState",value:function(){g(!this.internalState&&!this.state);var t=this._getAttributeManager();t&&t.addInstanced({instancePickingColors:{type:5121,size:3,update:this.calculateInstancePickingColors}}),this.internalState=new $t({attributeManager:t,layer:this}),this.state={},this.state.attributeManager=t,this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props)}},{key:"_transferState",value:function(t){var e=t.state,i=t.internalState;if(g(e&&i),this!==t){this.internalState=i,this.internalState.component=this,this.state=e,e.layer=this,this.internalState.setAsyncProps(this.props);var n=!0,r=!1,a=void 0;try{for(var o,s=this.getModels()[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){o.value.userData.layer=this}}catch(c){r=!0,a=c}finally{try{n||null==s.return||s.return()}finally{if(r)throw a}}this.diffProps(this.props,this.internalState.getOldProps())}}},{key:"_onAsyncPropUpdated",value:function(){this.diffProps(this.props,this.internalState.getOldProps()),this.setLayerNeedsUpdate()}},{key:"_activeUpdateTrigger",value:function(t){this.invalidateAttribute(t)}},{key:"_updateBaseUniforms",value:function(){var t=this,e={opacity:"function"==typeof this.props.opacity?function(e){return Math.pow(t.props.opacity(e),1/2.2)}:Math.pow(this.props.opacity,1/2.2)},i=!0,n=!1,r=void 0;try{for(var a,o=this.getModels()[Symbol.iterator]();!(i=(a=o.next()).done);i=!0){a.value.setUniforms(e)}}catch(s){n=!0,r=s}finally{try{i||null==o.return||o.return()}finally{if(n)throw r}}}},{key:"setUniforms",value:function(t){var e=!0,i=!1,n=void 0;try{for(var a,o=this.getModels()[Symbol.iterator]();!(e=(a=o.next()).done);e=!0){a.value.setUniforms(t)}}catch(s){i=!0,n=s}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}this.setNeedsRedraw(),r.deprecated("layer.setUniforms","model.setUniforms")()}},{key:"is64bitEnabled",value:function(){return r.deprecated("is64bitEnabled","use64bitProjection")(),this.use64bitProjection()}}]),e}(Jt);ie.layerName="Layer",ie.defaultProps=ee;var ne=function(t){function e(){return Object(L.a)(this,e),Object(I.a)(this,Object(R.a)(e).apply(this,arguments))}return Object(F.a)(e,t),Object(A.a)(e,[{key:"getSubLayers",value:function(){return this.internalState&&this.internalState.subLayers||[]}},{key:"initializeState",value:function(){}},{key:"setState",value:function(t){Object(q.a)(Object(R.a)(e.prototype),"setState",this).call(this,t),this.setLayerNeedsUpdate()}},{key:"getPickingInfo",value:function(t){return t.info}},{key:"renderLayers",value:function(){return null}},{key:"shouldRenderSubLayer",value:function(t,e){var i=this.props._subLayerProps;return e&&e.length||i&&i[t]}},{key:"getSubLayerClass",value:function(t,e){var i=this.props._subLayerProps;return i&&i[t]&&i[t].type||e}},{key:"getSubLayerProps",value:function(t){var e=this.props,i=e.opacity,n=e.pickable,r=e.visible,a=e.parameters,o=e.getPolygonOffset,s=e.highlightedObjectIndex,c=e.autoHighlight,u=e.highlightColor,l=e.coordinateSystem,h=e.coordinateOrigin,p=e.wrapLongitude,d=e.positionFormat,v=e.modelMatrix,f=e._subLayerProps,g={opacity:i,pickable:n,visible:r,parameters:a,getPolygonOffset:o,highlightedObjectIndex:s,autoHighlight:c,highlightColor:u,coordinateSystem:l,coordinateOrigin:h,wrapLongitude:p,positionFormat:d,modelMatrix:v};return t&&Object.assign(g,t,f&&f[t.id],{id:"".concat(this.props.id,"-").concat(t.id),updateTriggers:Object.assign({all:this.props.updateTriggers.all},t.updateTriggers)}),g}},{key:"_getAttributeManager",value:function(){return null}},{key:"_renderLayers",value:function(){var t=this.internalState.subLayers;t&&!this.needsUpdate()?r.log(3,"Composite layer reused subLayers ".concat(this),this.internalState.subLayers)():(t=$(t=this.renderLayers(),{filter:Boolean}),this.internalState.subLayers=t,r.log(2,"Composite layer rendered new subLayers ".concat(this),t)());var e=!0,i=!1,n=void 0;try{for(var a,o=t[Symbol.iterator]();!(e=(a=o.next()).done);e=!0){a.value.parent=this}}catch(s){i=!0,n=s}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}}},{key:"isComposite",get:function(){return!0}}]),e}(ie);ne.layerName="CompositeLayer";var re=i(448);var ae=i(253),oe=i(443),se=i(331),ce=Math.PI/180,ue=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],le=[0,0,0],he=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(L.a)(this,t);var i=e.id,n=void 0===i?null:i,r=e.x,a=void 0===r?0:r,o=e.y,s=void 0===o?0:o,c=e.width,u=void 0===c?1:c,l=e.height,h=void 0===l?1:l;this.id=n||this.constructor.displayName||"viewport",this.x=a,this.y=s,this.width=u||1,this.height=h||1,this._initViewMatrix(e),this._initProjectionMatrix(e),this._initPixelMatrices(),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this),this.getMatrices=this.getMatrices.bind(this)}return Object(A.a)(t,[{key:"equals",value:function(e){return e instanceof t&&(e.width===this.width&&e.height===this.height&&e.scale===this.scale&&Object(ae.e)(e.projectionMatrix,this.projectionMatrix)&&Object(ae.e)(e.viewMatrix,this.viewMatrix))}},{key:"project",value:function(t){var e=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).topLeft,i=void 0===e||e,n=this.projectPosition(t),r=Object(G.k)(n,this.pixelProjectionMatrix),a=Object(B.a)(r,2),o=a[0],s=a[1],c=i?s:this.height-s;return 2===t.length?[o,c]:[o,c,r[2]]}},{key:"unproject",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=e.topLeft,n=void 0===i||i,r=e.targetZ,a=Object(B.a)(t,3),o=a[0],s=a[1],c=a[2],u=n?s:this.height-s,l=r&&r*this.distanceScales.pixelsPerMeter[2],h=Object(G.h)([o,u,c],this.pixelUnprojectionMatrix,l),p=this.unprojectPosition(h),d=Object(B.a)(p,3),v=d[0],f=d[1],g=d[2];return Number.isFinite(c)?[v,f,g]:Number.isFinite(r)?[v,f,r]:[v,f]}},{key:"projectPosition",value:function(t){var e=this.projectFlat(t),i=Object(B.a)(e,2);return[i[0],i[1],(t[2]||0)*this.distanceScales.pixelsPerMeter[2]]}},{key:"unprojectPosition",value:function(t){var e=this.unprojectFlat(t),i=Object(B.a)(e,2);return[i[0],i[1],(t[2]||0)*this.distanceScales.metersPerPixel[2]]}},{key:"projectFlat",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale;if(this.isGeospatial)return Object(G.g)(t,e);var i=this.distanceScales.pixelsPerMeter;return[t[0]*i[0],t[1]*i[1]]}},{key:"unprojectFlat",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale;if(this.isGeospatial)return Object(G.j)(t,e);var i=this.distanceScales.metersPerPixel;return[t[0]*i[0],t[1]*i[1]]}},{key:"getDistanceScales",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return t?Object(G.b)({longitude:t[0],latitude:t[1],scale:this.scale,highPrecision:!0}):this.distanceScales}},{key:"getMatrices",value:function(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).modelMatrix,e=void 0===t?null:t,i=this.viewProjectionMatrix,n=this.pixelProjectionMatrix,r=this.pixelUnprojectionMatrix;return e&&(i=l.g([],this.viewProjectionMatrix,e),n=l.g([],this.pixelProjectionMatrix,e),r=l.e([],n)),Object.assign({modelViewProjectionMatrix:i,viewProjectionMatrix:this.viewProjectionMatrix,viewMatrix:this.viewMatrix,projectionMatrix:this.projectionMatrix,pixelProjectionMatrix:n,pixelUnprojectionMatrix:r,width:this.width,height:this.height,scale:this.scale})}},{key:"containsPixel",value:function(t){var e=t.x,i=t.y,n=t.width,r=void 0===n?1:n,a=t.height,o=void 0===a?1:a;return e<this.x+this.width&&this.x<e+r&&i<this.y+this.height&&this.y<i+o}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"getCameraDirection",value:function(){return this.cameraDirection}},{key:"getCameraUp",value:function(){return this.cameraUp}},{key:"_addMetersToLngLat",value:function(t,e){var i=Object(B.a)(t,3),n=i[0],r=i[1],a=i[2],o=void 0===a?0:a,s=this._metersToLngLatDelta(e),c=Object(B.a)(s,3),u=c[0],l=c[1],h=c[2],p=void 0===h?0:h;return 2===t.length?[n+u,r+l]:[n+u,r+l,o+p]}},{key:"_metersToLngLatDelta",value:function(t){var e=Object(B.a)(t,3),i=e[0],n=e[1],r=e[2],a=void 0===r?0:r;g(Number.isFinite(i)&&Number.isFinite(n)&&Number.isFinite(a),"Illegal argument to Viewport");var o=this.distanceScales,s=o.pixelsPerMeter,c=o.degreesPerPixel,u=i*s[0]*c[0],l=n*s[1]*c[1];return 2===t.length?[u,l]:[u,l,a]}},{key:"_createProjectionMatrix",value:function(t){var e=t.orthographic,i=t.fovyRadians,n=t.aspect,r=t.focalDistance,a=t.near,o=t.far;return g(Number.isFinite(i)),e?(new oe.a).orthographic({fovy:i,aspect:n,focalDistance:r,near:a,far:o}):(new oe.a).perspective({fovy:i,aspect:n,near:a,far:o})}},{key:"_initViewMatrix",value:function(t){var e=t.viewMatrix,i=void 0===e?ue:e,n=t.longitude,r=void 0===n?null:n,a=t.latitude,o=void 0===a?null:a,s=t.zoom,c=void 0===s?null:s,u=t.position,h=void 0===u?null:u,p=t.modelMatrix,d=void 0===p?null:p,v=t.focalDistance,f=void 0===v?1:v,g=t.distanceScales,y=void 0===g?null:g;this.isGeospatial=Number.isFinite(o)&&Number.isFinite(r),this.zoom=c,Number.isFinite(this.zoom)||(this.zoom=this.isGeospatial?Object(G.c)({latitude:o})+Math.log2(f):0);var m=Math.pow(2,this.zoom);this.scale=m,this.distanceScales=this.isGeospatial?Object(G.b)({latitude:o,longitude:r,scale:this.scale}):y||{pixelsPerMeter:[m,m,m],metersPerPixel:[1/m,1/m,1/m]},this.focalDistance=f,this.distanceScales.metersPerPixel=new se.a(this.distanceScales.metersPerPixel),this.distanceScales.pixelsPerMeter=new se.a(this.distanceScales.pixelsPerMeter),this.position=le,this.meterOffset=le,h&&(this.position=h,this.modelMatrix=d,this.meterOffset=d?d.transformVector(h):h),this.isGeospatial?(this.longitude=r,this.latitude=o,this.center=this._getCenterInWorld({longitude:r,latitude:o}),this.viewMatrixUncentered=l.n([],i,[1,-1,1])):(this.center=h?this.projectPosition(h):[0,0,0],this.viewMatrixUncentered=i),this.viewMatrix=(new oe.a).multiplyRight(this.viewMatrixUncentered).translate(new se.a(this.center||le).negate())}},{key:"_getCenterInWorld",value:function(t){var e=t.longitude,i=t.latitude,n=this.meterOffset,r=this.scale,a=this.distanceScales,o=this.projectFlat([e,i],r),s=new se.a(o[0],o[1],0);if(n){var c=new se.a(n).scale(a.pixelsPerMeter);s.add(c)}return s}},{key:"_initProjectionMatrix",value:function(t){var e=t.projectionMatrix,i=void 0===e?null:e,n=t.orthographic,r=void 0!==n&&n,a=t.fovyRadians,o=t.fovyDegrees,s=t.fovy,c=t.near,u=void 0===c?.1:c,l=t.far,h=void 0===l?1e3:l,p=t.focalDistance,d=void 0===p?1:p,v=t.orthographicFocalDistance,f=a||(o||s||75)*ce;this.projectionMatrix=i||this._createProjectionMatrix({orthographic:r,fovyRadians:f,aspect:this.width/this.height,focalDistance:v||d,near:u,far:h})}},{key:"_initPixelMatrices",value:function(){var t=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];l.g(t,t,this.projectionMatrix),l.g(t,t,this.viewMatrix),this.viewProjectionMatrix=t,this.viewMatrixInverse=l.e([],this.viewMatrix)||this.viewMatrix;var e,i,n,a=(e={viewMatrix:this.viewMatrix,viewMatrixInverse:this.viewMatrixInverse},i=e.viewMatrix,{eye:[(n=e.viewMatrixInverse)[12],n[13],n[14]],direction:[i[2],i[6],i[10]],up:[i[1],i[5],i[9]]}),o=a.eye,s=a.direction,c=a.up;this.cameraPosition=o,this.cameraDirection=s,this.cameraUp=c;var u=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],h=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];l.n(u,u,[this.width/2,-this.height/2,1]),l.o(u,u,[1,-1,0]),l.g(h,u,this.viewProjectionMatrix),this.pixelProjectionMatrix=h,this.viewportMatrix=u,this.pixelUnprojectionMatrix=l.e([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||r.warn("Pixel project matrix not invertible")()}}]),t}();he.displayName="Viewport";var pe=Object.seal({layerManager:null,deck:null,gl:null,time:-1,useDevicePixels:!0,stats:null,shaderCache:null,pickingFBO:null,animationProps:null,userData:{}}),de=function(t){return t instanceof ie?"".concat(t):t?"invalid":"null"},ve=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=i.deck,r=i.stats,a=i.viewport,s=void 0===a?null:a;Object(L.a)(this,t),this.lastRenderedLayers=[],this.layers=[],this.context=Object.assign({},pe,{layerManager:this,deck:n,gl:e,shaderCache:e&&new o.s({gl:e,_cachePrograms:!0}),stats:r||new re.a({id:"deck.gl"}),viewport:s||new he({id:"DEFAULT-INITIAL-VIEWPORT"})}),this._needsRedraw="Initial render",this._needsUpdate=!1,this._debug=!1,this.activateViewport=this.activateViewport.bind(this),this._initSeer=this._initSeer.bind(this),this._editSeer=this._editSeer.bind(this),Object.seal(this),Ot(this._initSeer),Pt(this._editSeer)}return Object(A.a)(t,[{key:"finalize",value:function(){var t=!0,e=!1,i=void 0;try{for(var n,r=this.layers[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){var a=n.value;this._finalizeLayer(a)}}catch(o){e=!0,i=o}finally{try{t||null==r.return||r.return()}finally{if(e)throw i}}_t.a.removeListener(this._initSeer),_t.a.removeListener(this._editSeer)}},{key:"needsRedraw",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearRedrawFlags:!1};return this._checkIfNeedsRedraw(t)}},{key:"needsUpdate",value:function(){return this._needsUpdate}},{key:"setNeedsRedraw",value:function(t){this._needsRedraw=this._needsRedraw||t}},{key:"setNeedsUpdate",value:function(t){this._needsUpdate=this._needsUpdate||t}},{key:"getLayers",value:function(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).layerIds,e=void 0===t?null:t;return e?this.layers.filter(function(t){return e.find(function(e){return 0===t.id.indexOf(e)})}):this.layers}},{key:"setProps",value:function(t){"debug"in t&&(this._debug=t.debug),"userData"in t&&(this.context.userData=t.userData),"useDevicePixels"in t&&(this.context.useDevicePixels=t.useDevicePixels),"layers"in t&&this.setLayers(t.layers)}},{key:"setLayers",value:function(t){if(t===this.lastRenderedLayers)return r.log(3,"Ignoring layer update due to layer array not changed")(),this;this.lastRenderedLayers=t,t=$(t,{filter:Boolean});var e=!0,i=!1,n=void 0;try{for(var a,o=t[Symbol.iterator]();!(e=(a=o.next()).done);e=!0){a.value.context=this.context}}catch(l){i=!0,n=l}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}var s=this._updateLayers({oldLayers:this.layers,newLayers:t}),c=s.error,u=s.generatedLayers;if(this.layers=u,c)throw c;return this}},{key:"updateLayers",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};"time"in t&&(this.context.time=t.time);var e=this.needsUpdate();e&&(this.setNeedsRedraw("updating layers: ".concat(e)),this.setLayers(Object(bt.a)(this.lastRenderedLayers)))}},{key:"_checkIfNeedsRedraw",value:function(t){var e=this._needsRedraw;t.clearRedrawFlags&&(this._needsRedraw=!1);var i=!0,n=!1,r=void 0;try{for(var a,o=this.layers[Symbol.iterator]();!(i=(a=o.next()).done);i=!0){var s=a.value.getNeedsRedraw(t);e=e||s}}catch(c){n=!0,r=c}finally{try{i||null==o.return||o.return()}finally{if(n)throw r}}return e}},{key:"activateViewport",value:function(t){var e=this.context.viewport;if(!e||!t.equals(e)){r.log(4,"Viewport changed",t)(),this.context.viewport=t;var i=!0,n=!1,a=void 0;try{for(var o,s=this.layers[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var c=o.value;c.setChangeFlags({viewportChanged:"Viewport changed"}),this._updateLayer(c)}}catch(u){n=!0,a=u}finally{try{i||null==s.return||s.return()}finally{if(n)throw a}}}return g(this.context.viewport,"LayerManager: viewport not set"),this}},{key:"_updateLayers",value:function(t){var e=t.oldLayers,i=t.newLayers,n={},a=!0,o=!1,s=void 0;try{for(var c,u=e[Symbol.iterator]();!(a=(c=u.next()).done);a=!0){var l=c.value;n[l.id]?r.warn("Multiple old layers with same id ".concat(de(l)))():n[l.id]=l}}catch(v){o=!0,s=v}finally{try{a||null==u.return||u.return()}finally{if(o)throw s}}var h=[],p=this._updateSublayersRecursively({newLayers:i,oldLayerMap:n,generatedLayers:h}),d=this._finalizeOldLayers(n);return this._needsUpdate=!1,{error:p||d,generatedLayers:h}}},{key:"_updateSublayersRecursively",value:function(t){var e=t.newLayers,i=t.oldLayerMap,n=t.generatedLayers,a=null,o=!0,s=!1,c=void 0;try{for(var u,l=e[Symbol.iterator]();!(o=(u=l.next()).done);o=!0){var h=u.value;h.context=this.context;var p=i[h.id];null===p&&r.warn("Multiple new layers with same id ".concat(de(h)))(),i[h.id]=null;var d=null;try{if(this._debug&&p!==h&&h.validateProps(),p){this._transferLayerState(p,h);var v=this._updateLayer(h);a=a||v,St(h)}else{var f=this._initializeLayer(h);a=a||f,xt(h)}n.push(h),d=h.isComposite&&h.getSubLayers()}catch(f){r.warn("error during matching of ".concat(de(h)),f)(),a=a||f}if(d){var g=this._updateSublayersRecursively({newLayers:d,oldLayerMap:i,generatedLayers:n});a=a||g}}}catch(f){s=!0,c=f}finally{try{o||null==l.return||l.return()}finally{if(s)throw c}}return a}},{key:"_finalizeOldLayers",value:function(t){var e=null;for(var i in t){var n=t[i];n&&(e=e||this._finalizeLayer(n))}return e}},{key:"_initializeLayer",value:function(t){r.log(2,"initializing ".concat(de(t)))();var e=null;try{t._initialize(),t.lifecycle=Ft.INITIALIZED}catch(c){r.warn("error while initializing ".concat(de(t),"\n"),c)(),e=e||c}t.internalState.layer=t;var i=!0,n=!1,a=void 0;try{for(var o,s=t.getModels()[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){o.value.userData.layer=t}}catch(c){n=!0,a=c}finally{try{i||null==s.return||s.return()}finally{if(n)throw a}}return e}},{key:"_transferLayerState",value:function(t,e){e._transferState(t),e.lifecycle=Ft.MATCHED,e!==t?(r.log(4,"matched ".concat(de(e)),t,"->",e)(),t.lifecycle=Ft.AWAITING_GC):r.log(4,"Matching layer is unchanged ".concat(e.id))()}},{key:"_updateLayer",value:function(t){r.log(4,"updating ".concat(t," because: ").concat(t.printChangeFlags()))();var e=null;try{t._update()}catch(i){r.warn("error during update of ".concat(de(t)),i)(),e=i}return e}},{key:"_finalizeLayer",value:function(t){g(t.lifecycle!==Ft.AWAITING_FINALIZATION),t.lifecycle=Ft.AWAITING_FINALIZATION;var e=null;this.setNeedsRedraw("finalized ".concat(de(t)));try{t._finalize()}catch(i){r.warn("error during finalization of ".concat(de(t)),i)(),e=i}return t.lifecycle=Ft.FINALIZED,r.log(2,"finalizing ".concat(de(t)))(),e}},{key:"_initSeer",value:function(){this.layers.forEach(function(t){xt(t),St(t)})}},{key:"_editSeer",value:function(t){var e,i,n;"edit"===t.type&&"props"===t.valuePath[0]&&(e=t.itemKey,i=t.valuePath.slice(1),n=t.value,_t.a.isReady()&&(jt.has(e)||jt.set(e,new Map),jt.get(e).set(i,n)),this.updateLayers())}}]),t}();!function(t){function e(){return Object(L.a)(this,e),Object(I.a)(this,Object(R.a)(e).apply(this,arguments))}Object(F.a)(e,t),Object(A.a)(e,[{key:"getProjectedLight",value:function(t){var e=t.layer,i=e.context.viewport,n=e.props,r=n.coordinateSystem,a=n.coordinateOrigin,o=P({viewport:i,modelMatrix:n.modelMatrix,coordinateSystem:r,coordinateOrigin:a}).project_uCameraPosition;return this.projectedLight.color=this.color,this.projectedLight.intensity=this.intensity,this.projectedLight.position=o,this.projectedLight}}])}(function(t){function e(t){var i;return Object(L.a)(this,e),(i=Object(I.a)(this,Object(R.a)(e).call(this,t))).projectedLight=new o.m(t),i}return Object(F.a)(e,t),Object(A.a)(e,[{key:"getProjectedLight",value:function(t){var e=t.layer,i=e.context.viewport,n=e.props,r=n.coordinateSystem,a=n.coordinateOrigin,o=W(this.position,{viewport:i,coordinateSystem:r,coordinateOrigin:a,fromCoordinateSystem:i.isGeospatial?p.LNGLAT:p.IDENTITY,fromCoordinateOrigin:[0,0,0]});return this.projectedLight.color=this.color,this.projectedLight.intensity=this.intensity,this.projectedLight.position=o,this.projectedLight}}]),e}(o.m));function fe(t,e){if(null==t)return{};var i,n,r=function(t,e){if(null==t)return{};var i,n,r={},a=Object.keys(t);for(n=0;n<a.length;n++)i=a[n],e.indexOf(i)>=0||(r[i]=t[i]);return r}(t,e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);for(n=0;n<a.length;n++)i=a[n],e.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(t,i)&&(r[i]=t[i])}return r}var ge=Math.PI/180,ye=864e5,me=2440588,be=2451545,we=23.4397*ge,_e=357.5291,je=.98560028,ke=280.147,Pe=360.9856235;function Oe(t,e,i){var n,r,a,o,s,c,u=ge*-i,l=ge*e,h=function(t){return function(t){return t/ye-.5+me}(t)-be}(t),p=(n=ge*(_e+je*h),r=ge*(1.9148*Math.sin(n)+.02*Math.sin(2*n)+3e-4*Math.sin(3*n)),a=n+r+102.9372*ge+Math.PI,{declination:(o=a,s=0,c=o,Math.asin(Math.sin(s)*Math.cos(we)+Math.cos(s)*Math.sin(we)*Math.sin(c))),rightAscension:xe(a,0)}),d=function(t,e){return ge*(ke+Pe*t)-e}(h,u)-p.rightAscension;return{azimuth:Se(d,l,p.declination),altitude:Me(d,l,p.declination)}}function xe(t,e){var i=t;return Math.atan2(Math.sin(i)*Math.cos(we)-Math.tan(e)*Math.sin(we),Math.cos(i))}function Se(t,e,i){var n=t,r=e,a=i;return Math.atan2(Math.sin(n),Math.cos(n)*Math.sin(r)-Math.tan(a)*Math.cos(r))}function Me(t,e,i){var n=t,r=e,a=i;return Math.asin(Math.sin(r)*Math.sin(a)+Math.cos(r)*Math.cos(a)*Math.cos(n))}!function(t){function e(t){var i,n=t.timestamp,r=fe(t,["timestamp"]);return Object(L.a)(this,e),(i=Object(I.a)(this,Object(R.a)(e).call(this,r))).timestamp=n,i}Object(F.a)(e,t),Object(A.a)(e,[{key:"getProjectedLight",value:function(t){var e=t.layer.context.viewport,i=e.latitude,n=e.longitude;return this.direction=function(t,e,i){var n=Oe(t,e,i),r=n.azimuth,a=n.altitude,o=r+Math.PI;return[-Math.sin(o),-Math.cos(o),-Math.sin(a)]}(this.timestamp,i,n),this}}])}(o.e);var Te=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(L.a)(this,t);var n=i.id,r=void 0===n?"pass":n;this.id=r,this.gl=e,this.props={},Object.assign(this.props,i)}return Object(A.a)(t,[{key:"setProps",value:function(t){Object.assign(this.props,t)}},{key:"render",value:function(){}},{key:"cleanup",value:function(){}}]),t}(),Ce=function(t){function e(t){var i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(L.a)(this,e),i=Object(I.a)(this,Object(R.a)(e).call(this,t,n));var r=n.module,a=n.fs,o=n.id,s=n.moduleProps;return i.model=i._getModel(t,r,a,o,s),i}return Object(F.a)(e,t),Object(A.a)(e,[{key:"render",value:function(t){var e=this,i=this.gl;Object(o.O)(i,{framebuffer:t.outputBuffer,clearColor:[0,0,0,0]},function(){return e._renderPass(i,t)})}},{key:"delete",value:function(){this.model.delete(),this.model=null}},{key:"_getModel",value:function(t,e,i,n,r){var a=new o.d(t,{id:n,fs:i,modules:[e]}),s=Object.assign(e.getUniforms(),e.getUniforms(r));return a.setUniforms(s),a}},{key:"_renderPass",value:function(t,e){var i=e.inputBuffer;e.outputBuffer;Object(o.u)(t,{color:!0}),this.model.draw({uniforms:{texture:i,texSize:[i.width,i.height]},parameters:{depthWrite:!1,depthTest:!1}})}}]),e}(Te),Ee=i(360),Le=function(t){function e(t){var i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(L.a)(this,e),(i=Object(I.a)(this,Object(R.a)(e).call(this,n))).id="".concat(t.name,"-pass"),Object(Ee.a)(t),i.module=t,i}return Object(F.a)(e,t),Object(A.a)(e,[{key:"prepare",value:function(t){this.passes||(this.passes=function(t,e,i,n){if(e.filter||e.sampler){var r=Re(e),a=new Ce(t,{id:i,module:e,fs:r,moduleProps:n});return[a]}return(e.passes||[]).map(function(r,a){var o=Re(e,r),s="".concat(i,"-").concat(a);return new Ce(t,{id:s,module:e,fs:o,moduleProps:n})})}(t,this.module,this.id,this.props))}},{key:"render",value:function(t){for(var e=t.target,i=void 0===e?null:e,n=!1,r=0;r<this.passes.length;r++){var a=n?t.outputBuffer:t.inputBuffer,o=n?t.inputBuffer:t.outputBuffer;i&&r===this.passes.length-1&&(o=i),this.passes[r].render({inputBuffer:a,outputBuffer:o}),n=!n}return{inputBuffer:n?t.outputBuffer:t.inputBuffer,outputBuffer:n?t.inputBuffer:t.outputBuffer}}},{key:"cleanup",value:function(){if(this.passes){var t=!0,e=!1,i=void 0;try{for(var n,r=this.passes[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){n.value.delete()}}catch(a){e=!0,i=a}finally{try{t||null==r.return||r.return()}finally{if(e)throw i}}this.passes=null}}}]),e}(z);var Ae=function(t){return"uniform sampler2D texture;\nuniform vec2 texSize;\n\nvarying vec2 position;\nvarying vec2 coordinate;\nvarying vec2 uv;\n\nvoid main() {\n  vec2 texCoord = coordinate;\n\n  gl_FragColor = texture2D(texture, texCoord);\n  gl_FragColor = ".concat(t,"(gl_FragColor, texSize, texCoord);\n}\n")},Ie=function(t){return"uniform sampler2D texture;\nuniform vec2 texSize;\n\nvarying vec2 position;\nvarying vec2 coordinate;\nvarying vec2 uv;\n\nvoid main() {\n  vec2 texCoord = coordinate;\n\n  gl_FragColor = ".concat(t,"(texture, texSize, texCoord);\n}\n")};function Re(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t;if(e.filter){var i="string"==typeof e.filter?e.filter:"".concat(t.name,"_filterColor");return Ae(i)}if(e.sampler){var n="string"==typeof e.sampler?e.sampler:"".concat(t.name,"_sampleColor");return Ie(n)}return null}var Fe=function(t){function e(){return Object(L.a)(this,e),Object(I.a)(this,Object(R.a)(e).apply(this,arguments))}return Object(F.a)(e,t),Object(A.a)(e,[{key:"render",value:function(t){var e=this,i=this.gl;return Object(o.O)(i,{framebuffer:t.outputBuffer},function(){return e.drawLayers(t)})}},{key:"drawLayers",value:function(t){var e=this,i=t.layers,n=t.viewports,r=t.views,a=t.onViewportActive,o=t.deviceRect,s=void 0===o?null:o,c=t.parameters,u=void 0===c?{}:c,l=t.pass,h=void 0===l?"draw":l,p=t.redrawReason,d=void 0===p?"":p,v=t.clearCanvas,f=void 0===v||v,g=t.effects,y=t.effectProps,m=this.gl;f&&this.clearCanvas(m);var b=[];return n.forEach(function(t,n){var o=e.getViewportFromDescriptor(t),c=r&&r[o.id];a(o);var l=e.drawLayersInViewport(m,{layers:i,viewport:o,view:c,deviceRect:s,parameters:u,pass:h,redrawReason:d,effects:g,effectProps:y});b.push(l)}),b}},{key:"drawLayersInViewport",value:function(t,e){var i=this,n=e.layers,r=e.viewport,a=e.view,s=(e.deviceRect,e.parameters),c=void 0===s?{}:s,u=(e.pass,e.redrawReason,e.effects),l=e.effectProps,h=this.getGLViewport(t,{viewport:r});if(a&&a.props.clear){var p=!0===a.props.clear?{color:!0,depth:!0}:a.props.clear;Object(o.O)(t,{scissorTest:!0,scissor:h},function(){return Object(o.u)(t,p)})}var d={totalCount:n.length,visibleCount:0,compositeCount:0,pickableCount:0};return Object(o.K)(t,c||{}),n.forEach(function(e,n){var a=i.shouldDrawLayer(e,r);a&&e.props.pickable&&d.pickableCount++,e.isComposite&&d.compositeCount++,a&&(d.visibleCount++,i.drawLayerInViewport({gl:t,layer:e,layerIndex:n,glViewport:h,parameters:c,effects:u,effectProps:l}))}),d}},{key:"drawLayerInViewport",value:function(t){t.gl;var e=t.layer,i=t.layerIndex,n=t.glViewport,r=t.parameters,a=t.effects,o=t.effectProps,s=this.getModuleParameters(e,a,o),c=Object.assign({},e.context.uniforms,{layerIndex:i}),u=this.getLayerParameters(e,i,n,r);e.drawLayer({moduleParameters:s,uniforms:c,parameters:u})}},{key:"getViewportFromDescriptor",value:function(t){return t.viewport?t.viewport:t}},{key:"shouldDrawLayer",value:function(t,e){var i=this.props.layerFilter,n=!t.isComposite&&t.props.visible;return n&&i&&(n=i({layer:t,viewport:e,isPicking:!1})),n}},{key:"getModuleParameters",value:function(t){return Object.assign(Object.create(t.props),{viewport:t.context.viewport,pickingActive:0,devicePixelRatio:this.props.pixelRatio})}},{key:"getLayerParameters",value:function(t,e,i,n){var r=Object.assign({},t.props.parameters||{},n);return Object.assign(r,{viewport:i}),r}},{key:"getGLViewport",value:function(t,e){var i=e.viewport,n=t.canvas?t.canvas.clientHeight||t.canvas.height:100,r=i,a=this.props.pixelRatio;return[r.x*a,(n-r.y-r.height)*a,r.width*a,r.height*a]}},{key:"clearCanvas",value:function(t){var e=t.drawingBufferWidth,i=t.drawingBufferHeight;Object(o.O)(t,{viewport:[0,0,e,i]},function(){t.clear(16640)})}}]),e}(Te);function Ne(t,e){return t===e||Object.keys(t).every(function(i){return Array.isArray(t[i])&&Array.isArray(e[i])?Ne(t[i],e[i]):t[i]===e[i]})}var ze=/([0-9]+\.?[0-9]*)(%|px)/;function De(t){switch(Object(Mt.a)(t)){case"number":return{position:t,relative:!1};case"string":var e=t.match(ze);if(e&&e.length>=3){var i="%"===e[2],n=parseFloat(e[1]);return{position:i?n/100:n,relative:i}}default:throw new Error("Could not parse position string ".concat(t))}}function Ve(t,e){return t.relative?Math.round(t.position*e):t.position}var Ue=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(L.a)(this,t);var i=e.id,n=void 0===i?null:i,r=e.x,a=void 0===r?0:r,o=e.y,s=void 0===o?0:o,c=e.width,u=void 0===c?"100%":c,l=e.height,h=void 0===l?"100%":l,p=e.projectionMatrix,d=void 0===p?null:p,v=e.fovy,f=void 0===v?50:v,y=e.near,m=void 0===y?.1:y,b=e.far,w=void 0===b?1e3:b,_=e.modelMatrix,j=void 0===_?null:_,k=e.viewportInstance,P=void 0===k?null:k,O=e.type,x=void 0===O?he:O;g(!P||P instanceof he),this.viewportInstance=P,this.id=n||this.constructor.displayName||"view",this.type=x,this.props=Object.assign({},e,{projectionMatrix:d,fovy:f,near:m,far:w,modelMatrix:j}),this._parseDimensions({x:a,y:s,width:u,height:h}),this.equals=this.equals.bind(this),Object.seal(this)}return Object(A.a)(t,[{key:"equals",value:function(t){return this===t||(this.viewportInstance?t.viewportInstance&&this.viewportInstance.equals(t.viewportInstance):Ne(this.props,t.props))}},{key:"makeViewport",value:function(t){var e=t.width,i=t.height,n=t.viewState;if(this.viewportInstance)return this.viewportInstance;n=this.filterViewState(n);var r=this.getDimensions({width:e,height:i}),a=Object.assign({viewState:n},n,this.props,r);return this._getViewport(a)}},{key:"getViewStateId",value:function(){switch(Object(Mt.a)(this.props.viewState)){case"string":return this.props.viewState;case"object":return this.props.viewState&&this.props.viewState.id;default:return this.id}}},{key:"filterViewState",value:function(t){if(this.props.viewState&&"object"===Object(Mt.a)(this.props.viewState)){if(!this.props.viewState.id)return this.props.viewState;var e=Object.assign({},t);for(var i in this.props.viewState)"id"!==i&&(e[i]=this.props.viewState[i]);return e}return t}},{key:"getDimensions",value:function(t){var e=t.width,i=t.height;return{x:Ve(this._x,e),y:Ve(this._y,i),width:Ve(this._width,e),height:Ve(this._height,i)}}},{key:"_getControllerProps",value:function(t){var e=this.props.controller;return e?!0===e?t:("function"==typeof e&&(e={type:e}),Object.assign({},t,e)):null}},{key:"_getViewport",value:function(t){return new(0,this.type)(t)}},{key:"_parseDimensions",value:function(t){var e=t.x,i=t.y,n=t.width,r=t.height;this._x=De(e),this._y=De(i),this._width=De(n),this._height=De(r)}}]),t}(),Be=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(L.a)(this,t),this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="Initial render",this._needsUpdate=!0,this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractiveStateChange:e.onInteractiveStateChange},Object.seal(this),this.setProps(e)}return Object(A.a)(t,[{key:"finalize",value:function(){for(var t in this.controllers)this.controllers[t]&&this.controllers[t].finalize();this.controllers={}}},{key:"needsRedraw",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearRedrawFlags:!1},e=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),e}},{key:"setNeedsUpdate",value:function(t){this._needsUpdate=this._needsUpdate||t,this._needsRedraw=this._needsRedraw||t}},{key:"updateViewStates",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if("time"in t)for(var e in this.controllers){var i=this.controllers[e];i&&i.updateTransition(t.time)}}},{key:"getViewports",value:function(t){return t?this._viewports.filter(function(e){return e.containsPixel(t)}):this._viewports}},{key:"getViews",value:function(){var t={};return this.views.forEach(function(e){t[e.id]=e}),t}},{key:"getView",value:function(t){return"string"==typeof t?this.views.find(function(e){return e.id===t}):t}},{key:"getViewState",value:function(t){var e=this.getView(t),i=e&&this.viewState[e.getViewStateId()]||this.viewState;return e?e.filterViewState(i):i}},{key:"getViewport",value:function(t){return this._viewportMap[t]}},{key:"project",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{topLeft:!0},i=this.getViewports(),n=i.length-1;n>=0;--n){var r=i[n];if(r.contains(t,e))return r.project(t,e)}return null}},{key:"unproject",value:function(t,e){for(var i=this.getViewports(),n=i.length-1;n>=0;--n){var r=i[n];if(r.containsPixel(t,e))return r.unproject(t)}return null}},{key:"setProps",value:function(t){"views"in t&&this._setViews(t.views),"viewState"in t&&this._setViewState(t.viewState),("width"in t||"height"in t)&&this._setSize(t.width,t.height),this._isUpdating||this._update()}},{key:"_update",value:function(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}},{key:"_setSize",value:function(t,e){g(Number.isFinite(t)&&Number.isFinite(e)),t===this.width&&e===this.height||(this.width=t,this.height=e,this.setNeedsUpdate("Size changed"))}},{key:"_setViews",value:function(t){t=$(t,{filter:Boolean}).map(function(t){return t instanceof he?new Ue({viewportInstance:t}):t}),this._diffViews(t,this.views)&&this.setNeedsUpdate("views changed"),this.views=t}},{key:"_setViewState",value:function(t){t?(!Ne(t,this.viewState)&&this.setNeedsUpdate("viewState changed"),this.viewState=t):r.warn("setting null viewState")()}},{key:"_onViewStateChange",value:function(t,e){e.viewId=t,this._eventCallbacks.onViewStateChange(e)}},{key:"_createController",value:function(t){return new(0,t.type)(Object.assign({eventManager:this._eventManager,onViewStateChange:this._onViewStateChange.bind(this,t.id),onStateChange:this._eventCallbacks.onInteractiveStateChange},t))}},{key:"_updateController",value:function(t,e,i,n){if(t.controller){var r=Object.assign({},t.controller,e,{id:t.id,x:i.x,y:i.y,width:i.width,height:i.height});return n?n.setProps(r):n=this._createController(r),n}return null}},{key:"_rebuildViewports",value:function(){var t=this,e=this.width,i=this.height,n=this.views,r=this.controllers;for(var a in this.controllers={},this._viewports=n.map(function(n){var a=t.getViewState(n),o=n.makeViewport({width:e,height:i,viewState:a});return t.controllers[n.id]=t._updateController(n,a,o,r[n.id]),o}),r)r[a]&&!this.controllers[a]&&r[a].finalize();this._buildViewportMap()}},{key:"_buildViewportMap",value:function(){var t=this;this._viewportMap={},this._viewports.forEach(function(e){e.id&&(t._viewportMap[e.id]=t._viewportMap[e.id]||e)})}},{key:"_diffViews",value:function(t,e){return t.length!==e.length||t.some(function(i,n){return!t[n].equals(e[n])})}}]),t}(),Ze=i(217),Ge=i(400),Xe=i(274),Ye=function(t){function e(){var t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(L.a)(this,e);var n=i.latitude,r=void 0===n?0:n,a=i.longitude,o=void 0===a?0:a,s=i.zoom,c=void 0===s?11:s,u=i.pitch,l=void 0===u?0:u,h=i.bearing,p=void 0===h?0:h,d=i.nearZMultiplier,v=void 0===d?.1:d,f=i.farZMultiplier,g=void 0===f?10:f,y=i.orthographic,m=void 0!==y&&y,b=i.width,w=i.height,_=i.altitude,j=void 0===_?1.5:_;b=b||1,w=w||1,j=Math.max(.75,j);var k=Object(G.e)({width:b,height:w,pitch:l,altitude:j,nearZMultiplier:v,farZMultiplier:g}),P=k.fov,O=k.aspect,x=k.focalDistance,S=k.near,M=k.far,T=Object(G.f)({height:w,pitch:l,bearing:p,altitude:j}),C=Object.assign({},i,{width:b,height:w,viewMatrix:T,longitude:o,latitude:r,zoom:c,orthographic:m,fovyRadians:P,aspect:O,orthographicFocalDistance:x,near:S,far:M});return(t=Object(I.a)(this,Object(R.a)(e).call(this,C))).latitude=r,t.longitude=o,t.zoom=c,t.pitch=l,t.bearing=p,t.altitude=j,t.orthographic=m,t.metersToLngLatDelta=t.metersToLngLatDelta.bind(Object(Ze.a)(Object(Ze.a)(t))),t.lngLatDeltaToMeters=t.lngLatDeltaToMeters.bind(Object(Ze.a)(Object(Ze.a)(t))),t.addMetersToLngLat=t.addMetersToLngLat.bind(Object(Ze.a)(Object(Ze.a)(t))),Object.freeze(Object(Ze.a)(Object(Ze.a)(t))),t}return Object(F.a)(e,t),Object(A.a)(e,[{key:"metersToLngLatDelta",value:function(t){var e=Object(B.a)(t,3),i=e[0],n=e[1],r=e[2],a=void 0===r?0:r;g(Number.isFinite(i)&&Number.isFinite(n)&&Number.isFinite(a),"Illegal argument to WebMercatorViewport");var o=this.distanceScales,s=o.pixelsPerMeter,c=o.degreesPerPixel,u=i*s[0]*c[0],l=n*s[1]*c[1];return 2===t.length?[u,l]:[u,l,a]}},{key:"lngLatDeltaToMeters",value:function(t){var e=Object(B.a)(t,3),i=e[0],n=e[1],r=e[2],a=void 0===r?0:r;g(Number.isFinite(i)&&Number.isFinite(n)&&Number.isFinite(a),"Illegal argument to WebMercatorViewport");var o=this.distanceScales,s=o.pixelsPerDegree,c=o.metersPerPixel,u=i*s[0]*c[0],l=n*s[1]*c[1];return 2===t.length?[u,l]:[u,l,a]}},{key:"addMetersToLngLat",value:function(t,e){return Object(G.a)(t,e)}},{key:"getMapCenterByLngLatPosition",value:function(t){var e=t.lngLat,i=t.pos,n=Object(G.h)(i,this.pixelUnprojectionMatrix),r=this.projectFlat(e),a=Xe.a([],r,Xe.e([],n)),o=Xe.a([],this.center,a);return this.unprojectFlat(o)}},{key:"getLocationAtPoint",value:function(t){var e=t.lngLat,i=t.pos;return this.getMapCenterByLngLatPosition({lngLat:e,pos:i})}},{key:"fitBounds",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.width,r=this.height,a=Object(Ge.a)(Object.assign({width:n,height:r,bounds:t},i));return new e({width:n,height:r,longitude:a.longitude,latitude:a.latitude,zoom:a.zoom})}}]),e}(he);Ye.displayName="WebMercatorViewport";var We=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(L.a)(this,t),Array.isArray(e)&&(e={compare:e,extract:e,required:e});var i=e,n=i.compare,r=i.extract,a=i.required;this._propsToCompare=n,this._propsToExtract=r,this._requiredProps=a}return Object(A.a)(t,[{key:"arePropsEqual",value:function(t,e){var i=!0,n=!1,r=void 0;try{for(var a,o=(this._propsToCompare||Object.keys(e))[Symbol.iterator]();!(i=(a=o.next()).done);i=!0){var s=a.value;if(!Object(ae.e)(t[s],e[s]))return!1}}catch(c){n=!0,r=c}finally{try{i||null==o.return||o.return()}finally{if(n)throw r}}return!0}},{key:"initializeProps",value:function(t,e){var i;if(this._propsToExtract){var n={},r={},a=!0,o=!1,s=void 0;try{for(var c,u=this._propsToExtract[Symbol.iterator]();!(a=(c=u.next()).done);a=!0){var l=c.value;n[l]=t[l],r[l]=e[l]}}catch(h){o=!0,s=h}finally{try{a||null==u.return||u.return()}finally{if(o)throw s}}i={start:n,end:r}}else i={start:t,end:e};return this._checkRequiredProps(i.start),this._checkRequiredProps(i.end),i}},{key:"interpolateProps",value:function(t,e,i){g(!1,"interpolateProps is not implemented")}},{key:"_checkRequiredProps",value:function(t){this._requiredProps&&this._requiredProps.forEach(function(e){var i=t[e];g(Number.isFinite(i)||Array.isArray(i),"".concat(e," is required for transition"))})}}]),t}(),qe=["longitude","latitude","zoom","bearing","pitch"],He=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:qe;return Object(L.a)(this,e),Object(I.a)(this,Object(R.a)(e).call(this,t))}return Object(F.a)(e,t),Object(A.a)(e,[{key:"interpolateProps",value:function(t,e,i){var n={};for(var r in e)n[r]=Object(ae.g)(t[r],e[r],i);return n}}]),e}(We),Ke=function(){},Je=1,$e=2,Qe=3,ti={transitionDuration:0,transitionEasing:function(t){return t},transitionInterpolator:new He,transitionInterruption:Je,onTransitionStart:Ke,onTransitionInterrupt:Ke,onTransitionEnd:Ke},ei=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(L.a)(this,t),g(e),this.ControllerState=e,this.props=Object.assign({},ti,i),this.propsInTransition=null,this.time=0,this.transition=new pt,this.onViewStateChange=i.onViewStateChange,this._onTransitionUpdate=this._onTransitionUpdate.bind(this)}return Object(A.a)(t,[{key:"finalize",value:function(){}},{key:"getViewportInTransition",value:function(){return this.propsInTransition}},{key:"processViewStateChange",value:function(t){var e=!1,i=this.props;if(t=Object.assign({},ti,t),this.props=t,this._shouldIgnoreViewportChange(i,t))return e;if(this._isTransitionEnabled(t)){var n=Object.assign({},i,this.transition.interruption===$e?this.transition.endProps:this.propsInTransition||i);this._triggerTransition(n,t),e=!0}else this.transition.cancel();return e}},{key:"updateTransition",value:function(t){this.time=t,this._updateTransition()}},{key:"_isTransitionEnabled",value:function(t){return t.transitionDuration>0&&t.transitionInterpolator}},{key:"_isUpdateDueToCurrentTransition",value:function(t){return!!this.transition.inProgress&&this.transition.interpolator.arePropsEqual(t,this.propsInTransition)}},{key:"_shouldIgnoreViewportChange",value:function(t,e){return this.transition.inProgress?this.transition.interruption===Qe||this._isUpdateDueToCurrentTransition(e):!this._isTransitionEnabled(e)||e.transitionInterpolator.arePropsEqual(t,e)}},{key:"_triggerTransition",value:function(t,e){g(this._isTransitionEnabled(e),"Transition is not enabled");var i=new this.ControllerState(t),n=new this.ControllerState(e).shortestPathFrom(i),r=e.transitionInterpolator.initializeProps(t,n);this.propsInTransition={},this.transition.start({duration:e.transitionDuration,easing:e.transitionEasing,interpolator:e.transitionInterpolator,interruption:e.transitionInterruption,startProps:r.start,endProps:r.end,onStart:e.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(e.onTransitionInterrupt),onEnd:this._onTransitionEnd(e.onTransitionEnd)}),this._updateTransition()}},{key:"_updateTransition",value:function(){this.transition.update(this.time)}},{key:"_onTransitionEnd",value:function(t){var e=this;return function(i){e.propsInTransition=null,t(i)}}},{key:"_onTransitionUpdate",value:function(t){var e=t.interpolator,i=t.startProps,n=t.endProps,r=t.time,a=e.interpolateProps(i,n,r);this.propsInTransition=new this.ControllerState(Object.assign({},this.props,a)).getViewportProps(),this.onViewStateChange&&this.onViewStateChange({viewState:this.propsInTransition,interactionState:{inTransition:!0}})}}]),t}();ei.defaultProps=ti;var ii={transitionDuration:0},ni=["wheel"],ri=["panstart","panmove","panend"],ai=["pinchstart","pinchmove","pinchend"],oi=["doubletap"],si=["keydown"],ci=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(L.a)(this,t),g(e),this.ControllerState=e,this.controllerState=null,this.controllerStateProps=null,this.eventManager=null,this.transitionManager=new ei(e,i),this._events=null,this._state={isDragging:!1},this.events=[],this.onViewStateChange=null,this.onStateChange=null,this.invertPan=!1,this.handleEvent=this.handleEvent.bind(this),this.setProps(i)}return Object(A.a)(t,[{key:"finalize",value:function(){for(var t in this._events)this._events[t]&&this.eventManager.off(t,this.handleEvent);this.transitionManager.finalize()}},{key:"handleEvent",value:function(t){var e=this.ControllerState;switch(this.controllerState=new e(Object.assign({},this.controllerStateProps,this._state)),t.type){case"panstart":return this._onPanStart(t);case"panmove":return this._onPan(t);case"panend":return this._onPanEnd(t);case"pinchstart":return this._onPinchStart(t);case"pinchmove":return this._onPinch(t);case"pinchend":return this._onPinchEnd(t);case"doubletap":return this._onDoubleTap(t);case"wheel":return this._onWheel(t);case"keydown":return this._onKeyDown(t);default:return!1}}},{key:"getCenter",value:function(t){var e=this.controllerStateProps,i=e.x,n=e.y,r=t.offsetCenter;return[r.x-i,r.y-n]}},{key:"isPointInBounds",value:function(t){var e=this.controllerStateProps,i=e.width,n=e.height;return t[0]>=0&&t[0]<=i&&t[1]>=0&&t[1]<=n}},{key:"isFunctionKeyPressed",value:function(t){var e=t.srcEvent;return Boolean(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}},{key:"isDragging",value:function(){return this._state.isDragging}},{key:"setProps",value:function(t){"onViewportChange"in t&&r.removed("onViewportChange")(),"onViewStateChange"in t&&(this.onViewStateChange=t.onViewStateChange),"onStateChange"in t&&(this.onStateChange=t.onStateChange),this.controllerStateProps=t,"eventManager"in t&&this.eventManager!==t.eventManager&&(this.eventManager=t.eventManager,this._events={},this.toggleEvents(this.events,!0)),this.transitionManager.processViewStateChange(this.controllerStateProps);var e=t.scrollZoom,i=void 0===e||e,n=t.dragPan,a=void 0===n||n,o=t.dragRotate,s=void 0===o||o,c=t.doubleClickZoom,u=void 0===c||c,l=t.touchZoom,h=void 0===l||l,p=t.touchRotate,d=void 0!==p&&p,v=t.keyboard,f=void 0===v||v,g=Boolean(this.onViewStateChange);this.toggleEvents(ni,g&&i),this.toggleEvents(ri,g&&(a||s)),this.toggleEvents(ai,g&&(h||d)),this.toggleEvents(oi,g&&u),this.toggleEvents(si,g&&f),this.scrollZoom=i,this.dragPan=a,this.dragRotate=s,this.doubleClickZoom=u,this.touchZoom=h,this.touchRotate=d,this.keyboard=f}},{key:"updateTransition",value:function(t){this.transitionManager.updateTransition(t)}},{key:"toggleEvents",value:function(t,e){var i=this;this.eventManager&&t.forEach(function(t){i._events[t]!==e&&(i._events[t]=e,e?i.eventManager.on(t,i.handleEvent):i.eventManager.off(t,i.handleEvent))})}},{key:"setOptions",value:function(t){return this.setProps(t)}},{key:"updateViewport",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=Object.assign({},t.getViewportProps(),e);if(this.controllerState!==t){var r=this.controllerState?this.controllerState.getViewportProps():null;this.onViewStateChange&&this.onViewStateChange({viewState:n,interactionState:i,oldViewState:r})}Object.assign(this._state,Object.assign({},t.getInteractiveState(),i)),this.onStateChange&&this.onStateChange(this._state)}},{key:"_onPanStart",value:function(t){var e=this.getCenter(t);if(!this.isPointInBounds(e))return!1;var i=this.controllerState.panStart({pos:e}).rotateStart({pos:e});return this.updateViewport(i,ii,{isDragging:!0})}},{key:"_onPan",value:function(t){var e=this.isFunctionKeyPressed(t)||t.rightButton;return(e=this.invertPan?!e:e)?this._onPanMove(t):this._onPanRotate(t)}},{key:"_onPanEnd",value:function(t){var e=this.controllerState.panEnd().rotateEnd();return this.updateViewport(e,null,{isDragging:!1})}},{key:"_onPanMove",value:function(t){if(!this.dragPan)return!1;var e=this.getCenter(t);if(!this.isDragging())return!1;var i=this.controllerState.pan({pos:e});return this.updateViewport(i,ii,{isDragging:!0})}},{key:"_onPanRotate",value:function(t){if(!this.dragRotate)return!1;var e=t.deltaX,i=t.deltaY,n=this.controllerState.getViewportProps(),r=e/n.width,a=i/n.height,o=this.controllerState.rotate({deltaScaleX:r,deltaScaleY:a});return this.updateViewport(o,ii,{isDragging:!0})}},{key:"_onWheel",value:function(t){if(!this.scrollZoom)return!1;t.preventDefault();var e=this.getCenter(t);if(!this.isPointInBounds(e))return!1;var i=t.delta,n=2/(1+Math.exp(-Math.abs(.01*i)));i<0&&0!==n&&(n=1/n);var r=this.controllerState.zoom({pos:e,scale:n});return this.updateViewport(r,ii)}},{key:"_onPinchStart",value:function(t){var e=this.getCenter(t);if(!this.isPointInBounds(e))return!1;var i=this.controllerState.zoomStart({pos:e}).rotateStart({pos:e});return this._state.startPinchRotation=t.rotation,this.updateViewport(i,ii,{isDragging:!0})}},{key:"_onPinch",value:function(t){if(!this.touchZoom&&!this.touchRotate)return!1;var e=this.controllerState;if(this.touchZoom){var i=t.scale,n=this.getCenter(t);e=e.zoom({pos:n,scale:i})}if(this.touchRotate){var r=t.rotation,a=this._state.startPinchRotation;e=e.rotate({deltaScaleX:-(r-a)/180})}return this.updateViewport(e,ii,{isDragging:!0})}},{key:"_onPinchEnd",value:function(t){var e=this.controllerState.zoomEnd().rotateEnd();return this._state.startPinchRotation=0,this.updateViewport(e,null,{isDragging:!1})}},{key:"_onDoubleTap",value:function(t){if(!this.doubleClickZoom)return!1;var e=this.getCenter(t);if(!this.isPointInBounds(e))return!1;var i=this.isFunctionKeyPressed(t),n=this.controllerState.zoom({pos:e,scale:i?.5:2});return this.updateViewport(n,this._getTransitionProps())}},{key:"_onKeyDown",value:function(t){if(!this.keyboard)return!1;var e,i=this.isFunctionKeyPressed(t),n=this.controllerState;switch(t.srcEvent.keyCode){case 189:e=i?n.zoomOut().zoomOut():n.zoomOut();break;case 187:e=i?n.zoomIn().zoomIn():n.zoomIn();break;case 37:e=i?n.rotateLeft():n.moveLeft();break;case 39:e=i?n.rotateRight():n.moveRight();break;case 38:e=i?n.rotateUp():n.moveUp();break;case 40:e=i?n.rotateDown():n.moveDown();break;default:return!1}return this.updateViewport(e,this._getTransitionProps())}},{key:"_getTransitionProps",value:function(){return ii}}]),t}(),ui=6371e3,li=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=e.phi,n=e.theta,r=e.radius,a=e.bearing,o=e.pitch,s=(e.altitude,e.radiusScale),c=void 0===s?ui:s;Object(L.a)(this,t),0===arguments.length?(this.phi=0,this.theta=0,this.radius=1):Number.isFinite(i)||Number.isFinite(n)?(this.phi=i||0,this.theta=n||0):(Number.isFinite(a)||Number.isFinite(o))&&(this.bearing=a||0,this.pitch=o||0),this.radius=r||1,this.radiusScale=c||1,this.check()}return Object(A.a)(t,[{key:"toString",value:function(){return this.formatString(ae.c)}},{key:"formatString",value:function(t){var e=t.printTypes,i=(t.printDegrees,ae.f);return"".concat(e?"Spherical":"","[rho:").concat(i(this.radius),",theta:").concat(i(this.theta),",phi:").concat(i(this.phi),"]")}},{key:"equals",value:function(t){return Object(ae.e)(this.radius,t.radius)&&Object(ae.e)(this.theta,t.theta)&&Object(ae.e)(this.phi,t.phi)}},{key:"exactEquals",value:function(t){return this.radius===t.radius&&this.theta===t.theta&&this.phi===t.phi}},{key:"set",value:function(t,e,i){return this.radius=t,this.phi=e,this.theta=i,this.check()}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this.check()}},{key:"fromLngLatZ",value:function(t){var e=Object(B.a)(t,3),i=e[0],n=e[1],r=e[2];this.radius=1+r/this.radiusScale,this.phi=Object(ae.h)(n),this.theta=Object(ae.h)(i)}},{key:"fromVector3",value:function(t){return this.radius=Z.g(t),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t[0],t[1]),this.phi=Math.acos(Object(ae.b)(t[2]/this.radius,-1,1))),this.check()}},{key:"toVector3",value:function(){return new se.a(0,0,this.radius).rotateX({radians:this.theta}).rotateZ({radians:this.phi})}},{key:"makeSafe",value:function(){this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi))}},{key:"check",value:function(){if(!(Number.isFinite(this.phi)&&Number.isFinite(this.theta)&&this.radius>0))throw new Error("SphericalCoordinates: some fields set to invalid numbers");return this}},{key:"bearing",get:function(){return 180-Object(ae.d)(this.phi)},set:function(t){this.phi=Math.PI-Object(ae.h)(t)}},{key:"pitch",get:function(){return Object(ae.d)(this.theta)},set:function(t){this.theta=Object(ae.h)(t)}},{key:"longitude",get:function(){return Object(ae.d)(this.phi)}},{key:"latitude",get:function(){return Object(ae.d)(this.theta)}},{key:"lng",get:function(){return Object(ae.d)(this.phi)}},{key:"lat",get:function(){return Object(ae.d)(this.theta)}},{key:"z",get:function(){return(this.radius-1)*this.radiusScale}}]),t}(),hi={position:[0,0,0],lookAt:[0,0,0],up:[0,0,1],rotationX:0,rotationY:0,fov:50,near:1,far:100},pi=function(){function t(e){Object(L.a)(this,t);var i=e.width,n=e.height,r=e.position,a=void 0===r?hi.position:r;g(Number.isFinite(i),"`width` must be supplied"),g(Number.isFinite(n),"`height` must be supplied"),this._viewportProps=this._applyConstraints(Object.assign({},e,{position:new se.a(a)}))}return Object(A.a)(t,[{key:"getViewportProps",value:function(){return this._viewportProps}},{key:"getDirection",value:function(){return new li({bearing:this._viewportProps.bearing,pitch:this._viewportProps.pitch}).toVector3().normalize()}},{key:"getDirectionFromBearing",value:function(t){return new li({bearing:t,pitch:90}).toVector3().normalize()}},{key:"shortestPathFrom",value:function(t){return this._viewportProps}},{key:"_applyConstraints",value:function(t){return t}}]),t}(),di=i(361),vi=i(437),fi={transitionDuration:300,transitionEasing:function(t){return t},transitionInterpolator:new He,transitionInterruption:Je},gi={transitionDuration:0},yi={minZoom:0,maxZoom:20,minPitch:0,maxPitch:60},mi={pitch:0,bearing:0,altitude:1.5},bi=function(t){function e(){var t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=i.width,r=i.height,a=i.latitude,o=i.longitude,s=i.zoom,c=i.bearing,u=void 0===c?mi.bearing:c,l=i.pitch,h=void 0===l?mi.pitch:l,p=i.altitude,d=void 0===p?mi.altitude:p,v=i.maxZoom,f=void 0===v?yi.maxZoom:v,y=i.minZoom,m=void 0===y?yi.minZoom:y,b=i.maxPitch,w=void 0===b?yi.maxPitch:b,_=i.minPitch,j=void 0===_?yi.minPitch:_,k=i.startPanLngLat,P=i.startZoomLngLat,O=i.startBearing,x=i.startPitch,S=i.startZoom;return Object(L.a)(this,e),g(Number.isFinite(o),"`longitude` must be supplied"),g(Number.isFinite(a),"`latitude` must be supplied"),g(Number.isFinite(s),"`zoom` must be supplied"),(t=Object(I.a)(this,Object(R.a)(e).call(this,{width:n,height:r,latitude:a,longitude:o,zoom:s,bearing:u,pitch:h,altitude:d,maxZoom:f,minZoom:m,maxPitch:w,minPitch:j})))._interactiveState={startPanLngLat:k,startZoomLngLat:P,startBearing:O,startPitch:x,startZoom:S},t}return Object(F.a)(e,t),Object(A.a)(e,[{key:"getViewportProps",value:function(){return this._viewportProps}},{key:"getInteractiveState",value:function(){return this._interactiveState}},{key:"panStart",value:function(t){var e=t.pos;return this._getUpdatedState({startPanLngLat:this._unproject(e)})}},{key:"pan",value:function(t){var e=t.pos,i=t.startPos,n=this._interactiveState.startPanLngLat||this._unproject(i);if(!n)return this;var r=this._calculateNewLngLat({startPanLngLat:n,pos:e}),a=Object(B.a)(r,2),o=a[0],s=a[1];return this._getUpdatedState({longitude:o,latitude:s})}},{key:"panEnd",value:function(){return this._getUpdatedState({startPanLngLat:null})}},{key:"rotateStart",value:function(t){t.pos;return this._getUpdatedState({startBearing:this._viewportProps.bearing,startPitch:this._viewportProps.pitch})}},{key:"rotate",value:function(t){var e=t.deltaScaleX,i=void 0===e?0:e,n=t.deltaScaleY,r=void 0===n?0:n,a=this._interactiveState,o=a.startBearing,s=a.startPitch;if(!Number.isFinite(o)||!Number.isFinite(s))return this;var c=this._calculateNewPitchAndBearing({deltaScaleX:i,deltaScaleY:r,startBearing:o,startPitch:s}),u=c.pitch,l=c.bearing;return this._getUpdatedState({bearing:l,pitch:u})}},{key:"rotateEnd",value:function(){return this._getUpdatedState({startBearing:null,startPitch:null})}},{key:"zoomStart",value:function(t){var e=t.pos;return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this._viewportProps.zoom})}},{key:"zoom",value:function(t){var e=t.pos,i=t.startPos,n=t.scale;g(n>0,"`scale` must be a positive number");var r=this._interactiveState,a=r.startZoom,o=r.startZoomLngLat;Number.isFinite(a)||(a=this._viewportProps.zoom,o=this._unproject(i)||this._unproject(e)),g(o,"`startZoomLngLat` prop is required for zoom behavior to calculate where to position the map.");var s=this._calculateNewZoom({scale:n,startZoom:a}),c=new di.a(Object.assign({},this._viewportProps,{zoom:s})).getLocationAtPoint({lngLat:o,pos:e}),u=Object(B.a)(c,2),l=u[0],h=u[1];return this._getUpdatedState({zoom:s,longitude:l,latitude:h})}},{key:"zoomEnd",value:function(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}},{key:"zoomIn",value:function(){return this._zoomFromCenter(2)}},{key:"zoomOut",value:function(){return this._zoomFromCenter(.5)}},{key:"moveLeft",value:function(){return this._panFromCenter([100,0])}},{key:"moveRight",value:function(){return this._panFromCenter([-100,0])}},{key:"moveUp",value:function(){return this._panFromCenter([0,100])}},{key:"moveDown",value:function(){return this._panFromCenter([0,-100])}},{key:"rotateLeft",value:function(){return this._getUpdatedState({bearing:this._viewportProps.bearing-15})}},{key:"rotateRight",value:function(){return this._getUpdatedState({bearing:this._viewportProps.bearing+15})}},{key:"rotateUp",value:function(){return this._getUpdatedState({pitch:this._viewportProps.pitch+10})}},{key:"rotateDown",value:function(){return this._getUpdatedState({pitch:this._viewportProps.pitch-10})}},{key:"shortestPathFrom",value:function(t){var e=t.getViewportProps(),i=Object.assign({},this._viewportProps),n=i.bearing,r=i.longitude;return Math.abs(n-e.bearing)>180&&(i.bearing=n<0?n+360:n-360),Math.abs(r-e.longitude)>180&&(i.longitude=r<0?r+360:r-360),i}},{key:"_zoomFromCenter",value:function(t){var e=this._viewportProps,i=e.width,n=e.height;return this.zoom({pos:[i/2,n/2],scale:t})}},{key:"_panFromCenter",value:function(t){var e=this._viewportProps,i=e.width,n=e.height;return this.pan({startPos:[i/2,n/2],pos:[i/2+t[0],n/2+t[1]]})}},{key:"_getUpdatedState",value:function(t){return new e(Object.assign({},this._viewportProps,this._interactiveState,t))}},{key:"_applyConstraints",value:function(t){var e=t.maxZoom,i=t.minZoom,n=t.zoom;t.zoom=Object(ae.b)(n,i,e);var r=t.maxPitch,a=t.minPitch,o=t.pitch;return t.pitch=Object(ae.b)(o,a,r),Object.assign(t,Object(vi.a)(t)),t}},{key:"_unproject",value:function(t){var e=new di.a(this._viewportProps);return t&&e.unproject(t)}},{key:"_calculateNewLngLat",value:function(t){var e=t.startPanLngLat,i=t.pos;return new di.a(this._viewportProps).getMapCenterByLngLatPosition({lngLat:e,pos:i})}},{key:"_calculateNewZoom",value:function(t){var e=t.scale,i=t.startZoom,n=this._viewportProps,r=n.maxZoom,a=n.minZoom,o=i+Math.log2(e);return Object(ae.b)(o,a,r)}},{key:"_calculateNewPitchAndBearing",value:function(t){var e=t.deltaScaleX,i=t.deltaScaleY,n=t.startBearing,r=t.startPitch;i=Object(ae.b)(i,-1,1);var a=this._viewportProps,o=a.minPitch,s=a.maxPitch,c=r;return i>0?c=r+i*(s-r):i<0&&(c=r-i*(o-r)),{pitch:c,bearing:n+180*e}}}]),e}(pi),wi=function(t){function e(t){var i;return Object(L.a)(this,e),(i=Object(I.a)(this,Object(R.a)(e).call(this,bi,t))).invertPan=!0,i}return Object(F.a)(e,t),Object(A.a)(e,[{key:"_getTransitionProps",value:function(){return fi}},{key:"_onPanRotate",value:function(t){if(!this.dragRotate)return!1;var e=t.deltaX,i=t.deltaY,n=this.getCenter(t),r=Object(B.a)(n,2)[1],a=r-i,o=this.controllerState.getViewportProps(),s=o.width,c=o.height,u=e/s,l=0;i>0?Math.abs(c-a)>5&&(l=i/(a-c)*1.2):i<0&&a>5&&(l=1-r/a),l=Math.min(1,Math.max(-1,l));var h=this.controllerState.rotate({deltaScaleX:u,deltaScaleY:l});return this.updateViewport(h,gi,{isDragging:!0})}}]),e}(ci),_i=function(t){function e(t){return Object(L.a)(this,e),Object(I.a)(this,Object(R.a)(e).call(this,Object.assign({},t,{type:Ye})))}return Object(F.a)(e,t),Object(A.a)(e,[{key:"controller",get:function(){return this._getControllerProps({type:wi})}}]),e}(Ue);_i.displayName="MapView";var ji=function(){function t(){Object(L.a)(this,t),this.effects=[],this._needsRedraw="Initial render",this.defaultLightingEffect=new U,this.needApplyDefaultLighting=!1}return Object(A.a)(t,[{key:"setProps",value:function(t){"effects"in t&&(t.effects.length===this.effects.length&&Ne(t.effects,this.effects)||(this.setEffects(t.effects),this._needsRedraw="effects changed")),this.checkLightingEffect()}},{key:"needsRedraw",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearRedrawFlags:!1},e=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),e}},{key:"getEffects",value:function(){var t=this.effects;return this.needApplyDefaultLighting&&(t=this.effects.slice()).push(this.defaultLightingEffect),t}},{key:"finalize",value:function(){this.cleanup()}},{key:"setEffects",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.cleanup(),this.effects=t}},{key:"cleanup",value:function(){var t=!0,e=!1,i=void 0;try{for(var n,r=this.effects[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){n.value.cleanup()}}catch(a){e=!0,i=a}finally{try{t||null==r.return||r.return()}finally{if(e)throw i}}this.effects.length=0}},{key:"checkLightingEffect",value:function(){var t=!1,e=!0,i=!1,n=void 0;try{for(var r,a=this.effects[Symbol.iterator]();!(e=(r=a.next()).done);e=!0){if(r.value instanceof U){t=!0;break}}}catch(o){i=!0,n=o}finally{try{e||null==a.return||a.return()}finally{if(i)throw n}}this.needApplyDefaultLighting=!t}}]),t}(),ki=function(t){function e(){return Object(L.a)(this,e),Object(I.a)(this,Object(R.a)(e).apply(this,arguments))}return Object(F.a)(e,t),Object(A.a)(e,[{key:"getModuleParameters",value:function(t,i,n){var r=Object(q.a)(Object(R.a)(e.prototype),"getModuleParameters",this).call(this,t);Object.assign(r,this.getObjectHighlightParameters(t),n);var a=!0,o=!1,s=void 0;try{for(var c,u=i[Symbol.iterator]();!(a=(c=u.next()).done);a=!0){var l=c.value;Object.assign(r,l.getParameters(t))}}catch(h){o=!0,s=h}finally{try{a||null==u.return||u.return()}finally{if(o)throw s}}return r}},{key:"getObjectHighlightParameters",value:function(t){var e=t.props,i=e.highlightedObjectIndex,n=e.highlightColor,r={pickingHighlightColor:[n[0],n[1],n[2],n[3]||255]};return Number.isInteger(i)&&(r.pickingSelectedColor=i>=0?t.encodePickingColor(i):null),r}}]),e}(Fe),Pi=function(t){function e(){return Object(L.a)(this,e),Object(I.a)(this,Object(R.a)(e).apply(this,arguments))}return Object(F.a)(e,t),Object(A.a)(e,[{key:"render",value:function(t){t.pickingFBO?this.drawPickingBuffer(t):Object(q.a)(Object(R.a)(e.prototype),"render",this).call(this,t)}},{key:"drawPickingBuffer",value:function(t){var e=this,i=t.layers,n=t.viewports,r=t.onViewportActive,a=t.pickingFBO,s=t.effectProps,c=t.deviceRect,u=c.x,l=c.y,h=c.width,p=c.height,d=t.redrawReason,v=void 0===d?"":d,f=this.gl;return Object(o.O)(f,{framebuffer:a,scissorTest:!0,scissor:[u,l,h,p],clearColor:[0,0,0,0]},function(){e.drawLayers({layers:i,viewports:n,onViewportActive:r,pass:"picking",redrawReason:v,effectProps:s,parameters:{blend:!0,blendFunc:[1,0,32771,0],blendEquation:32774,blendColor:[0,0,0,0],depthMask:!0,depthTest:!0,depthRange:[0,1],colorMask:[!0,!0,!0,!0]}})})}},{key:"shouldDrawLayer",value:function(t,e){var i=this.props.layerFilter,n=!t.isComposite&&t.props.visible&&t.props.pickable;return n&&i&&(n=i({layer:t,viewport:e,isPicking:!0})),n}},{key:"getModuleParameters",value:function(t,e,i){var n=Object.assign(Object.create(t.props),{viewport:t.context.viewport,pickingActive:1,devicePixelRatio:this.props.pixelRatio});return Object.assign(n,i),n}},{key:"getLayerParameters",value:function(t,e,i,n){var r=Object.assign({},t.props.parameters||{},n);return Object.assign(r,{viewport:i,blendColor:[0,0,0,(e+1)/255]}),r}}]),e}(Fe);function Oi(t){return g("boolean"==typeof t,"Invalid useDevicePixels"),t&&"undefined"!=typeof window?window.devicePixelRatio:1}var xi=function(){function t(e){Object(L.a)(this,t),this.gl=e,this.pixelRatio=null,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new ki(e),this.pickLayersPass=new Pi(e),this.renderCount=0,this._needsRedraw="Initial render",this.screenBuffer=null,this.offscreenBuffer=null,this.lastPostProcessEffect=null}return Object(A.a)(t,[{key:"setProps",value:function(t){"useDevicePixels"in t&&(this.pixelRatio=Oi(t.useDevicePixels)),"layerFilter"in t&&this.layerFilter!==t.layerFilter&&(this.layerFilter=t.layerFilter,this._needsRedraw="layerFilter changed"),"drawPickingColors"in t&&this.drawPickingColors!==t.drawPickingColors&&(this.drawPickingColors=t.drawPickingColors,this._needsRedraw="drawPickingColors changed");var e=this.pixelRatio,i=this.layerFilter;this.drawLayersPass.setProps({pixelRatio:e,layerFilter:i}),this.pickLayersPass.setProps({pixelRatio:e,layerFilter:i})}},{key:"renderLayers",value:function(t){var e=this,i=t.layers,n=t.viewports,a=t.activateViewport,s=t.views,c=t.redrawReason,u=void 0===c?"unknown reason":c,l=t.clearCanvas,h=void 0===l||l,p=t.effects,d=void 0===p?[]:p,v=t.pass,f=t.stats,g=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,y=this.prepareEffects({layers:i,viewports:n,onViewportActive:a,views:s,effects:d}),m=this.lastPostProcessEffect?this.screenBuffer:o.g.getDefaultFramebuffer(this.gl),b=g.render({layers:i,viewports:n,views:s,onViewportActive:a,redrawReason:u,clearCanvas:h,effects:d,effectProps:y,outputBuffer:m});this.postRender(d),this.renderCount++,r.priority>=2&&b.forEach(function(t){e.logRenderStats({status:t,pass:v,redrawReason:u,stats:f,renderStats:b})})}},{key:"needsRedraw",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearRedrawFlags:!1},e=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),e}},{key:"finalize",value:function(){this.screenBuffer&&(this.screenBuffer.delete(),this.screenBuffer=null),this.offscreenBuffer&&(this.offscreenBuffer.delete(),this.offscreenBuffer=null)}},{key:"prepareEffects",value:function(t){var e=t.effects,i={};this.lastPostProcessEffect=null;var n=!0,r=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var c=o.value;Object.assign(i,c.prepare(this.gl,t)),c instanceof Le&&(this.lastPostProcessEffect=c)}}catch(u){r=!0,a=u}finally{try{n||null==s.return||s.return()}finally{if(r)throw a}}return this.lastPostProcessEffect&&this.prepareRenderBuffers(),i}},{key:"prepareRenderBuffers",value:function(){this.screenBuffer||(this.screenBuffer=new o.g(this.gl)),this.screenBuffer.resize(),this.offscreenBuffer||(this.offscreenBuffer=new o.g(this.gl)),this.offscreenBuffer.resize()}},{key:"postRender",value:function(t){var e={inputBuffer:this.screenBuffer,outputBuffer:this.offscreenBuffer,target:null},i=!0,n=!1,r=void 0;try{for(var a,s=t[Symbol.iterator]();!(i=(a=s.next()).done);i=!0){var c=a.value;if(c instanceof Le){if(c===this.lastPostProcessEffect){Object.assign(e,{target:o.g.getDefaultFramebuffer(this.gl)}),e=c.render(e);break}e=c.render(e)}}}catch(u){n=!0,r=u}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}}},{key:"logRenderStats",value:function(t){var e=t.renderStats,i=t.pass,n=t.redrawReason,a=t.stats,o=e.totalCount,s=e.visibleCount,c=e.compositeCount,u=e.pickableCount,l=o-c-s,h="";h+="RENDER #".concat(this.renderCount," ").concat(s," (of ").concat(o," layers) to ").concat(i," because ").concat(n," "),r.priority>2&&(h+="(".concat(l," hidden, ").concat(c," composite ").concat(u," pickable)")),r.log(2,h)(),a&&a.get("Redraw Layers").add(s)}}]),t}(),Si={pickedColor:null,pickedLayer:null,pickedObjectIndex:-1};function Mi(t){var e=t.pickedColors,i=t.layers,n=t.deviceX,a=t.deviceY,o=t.deviceRadius,s=t.deviceRect;if(e){for(var c=s.x,u=s.y,l=s.width,h=s.height,p=o*o,d=-1,v=0,f=0;f<h;f++){var g=f+u-a,y=g*g;if(y>p)v+=4*l;else for(var m=0;m<l;m++){if(e[v+3]-1>=0){var b=m+c-n,w=b*b+y;w<=p&&(p=w,d=v)}v+=4}}if(d>=0){var _=e[d+3]-1,j=e.slice(d,d+4),k=i[_];if(k){var P=k.decodePickingColor(j);return{pickedColor:j,pickedLayer:k,pickedObjectIndex:P}}r.error("Picked non-existent layer. Is picking buffer corrupt?")()}}return Si}function Ti(t){var e=t.pickInfo,i=t.lastPickedInfo,n=t.mode,r=t.layers,a=t.viewports,o=t.x,s=t.y,c=t.deviceX,u=t.deviceY,l=t.pixelRatio,h=e.pickedColor,p=e.pickedLayer,d=e.pickedObjectIndex,v=p?[p]:[];if("hover"===n){var f=i.index,g=i.layerId,y=p&&p.props.id;if(y!==g||d!==f){if(y!==g){var m=r.find(function(t){return t.props.id===g});m&&v.unshift(m)}i.layerId=y,i.index=d,i.info=null}}var b={viewports:a}.viewports[0],w=b&&b.unproject([o,s]),_={color:null,layer:null,index:-1,picked:!1,x:o,y:s,pixel:[o,s],coordinate:w,lngLat:w,devicePixel:[c,u],pixelRatio:l},j=new Map;return j.set(null,_),v.forEach(function(t){var e=Object.assign({},_);if(t===p&&(e.color=h,e.index=d,e.picked=!0),e=Ci({layer:t,info:e,mode:n}),t===p&&"hover"===n&&(i.info=e),e&&j.set(e.layer.id,e),"hover"===n){var r=t.props.autoHighlight&&p===t?h:null;t.setModuleParameters({pickingSelectedColor:r}),t.setNeedsRedraw()}}),j}function Ci(t){for(var e=t.layer,i=t.info,n=t.mode;e&&i;){var r=i.layer||e;i.layer=e,i=e.pickLayer({info:i,mode:n,sourceLayer:r}),e=e.parent}return i}var Ei=function(){function t(e){Object(L.a)(this,t),this.gl=e,this.pickingFBO=null,this.pickLayersPass=new Pi(e),this.pixelRatio=null,this.layerFilter=null,this.pickingEvent=null,this.lastPickedInfo={index:-1,layerId:null,info:null}}return Object(A.a)(t,[{key:"setProps",value:function(t){"useDevicePixels"in t&&(this.pixelRatio=Oi(t.useDevicePixels)),"layerFilter"in t&&(this.layerFilter=t.layerFilter),this.pickLayersPass.setProps({pixelRatio:this.pixelRatio,layerFilter:this.layerFilter})}},{key:"pickObject",value:function(t){var e=t.x,i=t.y,n=t.mode,r=t.radius,a=void 0===r?0:r,o=t.layers,s=t.viewports,c=t.activateViewport,u=t.depth,l=void 0===u?1:u,h=t.event,p=void 0===h?null:h;this.pickingEvent=p;var d=this.pickClosestObject({x:e,y:i,radius:a,layers:o,mode:n,depth:l,viewports:s,onViewportActive:c});return this.pickingEvent=null,d}},{key:"pickObjects",value:function(t){var e=t.x,i=t.y,n=t.width,r=t.height,a=t.layers,o=t.viewports,s=t.activateViewport;return this.pickVisibleObjects({x:e,y:i,width:n,height:r,layers:a,mode:"pickObjects",viewports:o,onViewportActive:s})}},{key:"getLastPickedObject",value:function(t){var e=t.x,i=t.y,n=t.layers,r=t.viewports,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.lastPickedInfo.info,o=a&&a.layer&&a.layer.id,s=o?n.find(function(t){return t.id===o}):null,c=r[0]&&r[0].unproject([e,i]),u={x:e,y:i,coordinate:c,lngLat:c,layer:s};return s?Object.assign({},a,u):Object.assign(u,{color:null,object:null,index:-1})}},{key:"updatePickingBuffer",value:function(){var t=this.gl;return this.pickingFBO||(this.pickingFBO=new o.g(t)),this.pickingFBO.resize({width:t.canvas.width,height:t.canvas.height}),this.pickingFBO}},{key:"pickClosestObject",value:function(t){var e=t.layers,i=t.viewports,n=t.x,r=t.y,a=t.radius,o=t.depth,s=void 0===o?1:o,c=t.mode,u=t.onViewportActive;this.updatePickingBuffer();for(var l,h=this.pixelRatio,p=Math.round(n*h),d=Math.round(this.gl.canvas.height-r*h),v=Math.round(a*h),f=this.pickingFBO,g=f.width,y=f.height,m=this.getPickingRect({deviceX:p,deviceY:d,deviceRadius:v,deviceWidth:g,deviceHeight:y}),b=[],w={},_=0;_<s;_++){var j=Mi({pickedColors:m&&this.drawAndSamplePickingBuffer({layers:e,viewports:i,onViewportActive:u,deviceRect:m,redrawReason:c}),layers:e,deviceX:p,deviceY:d,deviceRadius:v,deviceRect:m});if(j.pickedColor&&_+1<s){var k=j.pickedColor[3]-1;w[k]||(w[k]=e[k].copyPickingColors()),e[k].clearPickingColor(j.pickedColor)}l=Ti({pickInfo:j,lastPickedInfo:this.lastPickedInfo,mode:c,layers:e,viewports:i,x:n,y:r,deviceX:p,deviceY:d,pixelRatio:h});var P=this.callLayerPickingCallbacks(l,c);if(P&&P.forEach(function(t){return b.push(t)}),!j.pickedColor)break}return Object.keys(w).forEach(function(t){return e[t].restorePickingColors(w[t])}),{result:b,emptyInfo:l&&l.get(null)}}},{key:"pickVisibleObjects",value:function(t){var e=t.layers,i=t.viewports,n=t.x,a=t.y,o=t.width,s=t.height,c=t.mode,u=t.onViewportActive;this.updatePickingBuffer();var l=this.pixelRatio,h=Math.round(n*l),p=Math.round(this.gl.canvas.height-a*l),d=Math.round((n+o)*l),v=Math.round(this.gl.canvas.height-(a+s)*l),f={x:h,y:v,width:d-h,height:p-v},g=function(t){var e=t.pickedColors,i=t.layers,n=new Map;if(e)for(var a=0;a<e.length;a+=4){var o=e[a+3]-1;if(o>=0){var s=e.slice(a,a+4),c=s.join(",");if(!n.has(c)){var u=i[o];u?n.set(c,{pickedColor:s,pickedLayer:u,pickedObjectIndex:u.decodePickingColor(s)}):r.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(n.values())}({pickedColors:this.drawAndSamplePickingBuffer({layers:e,viewports:i,onViewportActive:u,deviceRect:f,redrawReason:c}),layers:e}),y=new Map;return g.forEach(function(t){var e={color:t.pickedColor,layer:null,index:t.pickedObjectIndex,picked:!0,x:n,y:a,width:o,height:s,pixelRatio:l};e=Ci({layer:t.pickedLayer,info:e,mode:c}),y.has(e.object)||y.set(e.object,e)}),Array.from(y.values())}},{key:"drawAndSamplePickingBuffer",value:function(t){var e=t.layers,i=t.viewports,n=t.onViewportActive,r=t.deviceRect,a=t.redrawReason;if(g(r),g(Number.isFinite(r.width)&&r.width>0,"`width` must be > 0"),g(Number.isFinite(r.height)&&r.height>0,"`height` must be > 0"),e.filter(function(t){return t.isPickable()}).length<1)return null;var s=this.pickingFBO;this.pickLayersPass.render({layers:e,viewports:i,onViewportActive:n,pickingFBO:s,deviceRect:r,redrawReason:a,effectProps:{lightSources:{}}});var c=r.x,u=r.y,l=r.width,h=r.height,p=new Uint8Array(l*h*4);return Object(o.H)(s,{sourceX:c,sourceY:u,sourceWidth:l,sourceHeight:h,target:p}),p}},{key:"getPickingRect",value:function(t){var e=t.deviceX,i=t.deviceY,n=t.deviceRadius,r=t.deviceWidth,a=t.deviceHeight;if(!(e>=0&&i>=0&&e<r&&i<a))return null;var o=Math.max(0,e-n),s=Math.max(0,i-n);return{x:o,y:s,width:Math.min(r,e+n)-o+1,height:Math.min(a,i+n)-s+1}}},{key:"callLayerPickingCallbacks",value:function(t,e){var i=[],n=this.pickingEvent;return t.forEach(function(t){if(t.layer){var r=!1;switch(e){case"hover":r=t.layer.onHover(t,n);break;case"query":break;default:throw new Error("unknown pick type")}r||i.push(t)}}),i}}]),t}(),Li=i(359);function Ai(){}var Ii={id:"deckgl-overlay",width:"100%",height:"100%",pickingRadius:0,layerFilter:null,glOptions:{},gl:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,_animate:!1,onWebGLInitialized:Ai,onResize:Ai,onViewStateChange:Ai,onBeforeRender:Ai,onAfterRender:Ai,onLoad:Ai,_onMetrics:null,getCursor:function(t){return t.isDragging?"grabbing":"grab"},debug:!1,drawPickingColors:!1},Ri=function(){function t(e){Object(L.a)(this,t),e=Object.assign({},Ii,e),this.width=0,this.height=0,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this._needsRedraw=!0,this._pickRequest={},this._lastPointerDownInfo=null,this.viewState=e.initialViewState||null,this.interactiveState={isDragging:!1},this._onEvent=this._onEvent.bind(this),this._onPointerDown=this._onPointerDown.bind(this),this._onPointerMove=this._onPointerMove.bind(this),this._onPointerLeave=this._onPointerLeave.bind(this),this._pickAndCallback=this._pickAndCallback.bind(this),this._onRendererInitialized=this._onRendererInitialized.bind(this),this._onRenderFrame=this._onRenderFrame.bind(this),this._onViewStateChange=this._onViewStateChange.bind(this),this._onInteractiveStateChange=this._onInteractiveStateChange.bind(this),e.gl||"undefined"!=typeof document&&(this.canvas=this._createCanvas(e)),this.animationLoop=this._createAnimationLoop(e),this.stats=new re.a({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this.setProps(e),this.animationLoop.start()}return Object(A.a)(t,[{key:"finalize",value:function(){this.animationLoop.stop(),this.animationLoop=null,this._lastPointerDownInfo=null,this.layerManager&&(this.layerManager.finalize(),this.layerManager=null),this.viewManager&&(this.viewManager.finalize(),this.viewManager=null),this.effectManager&&(this.effectManager.finalize(),this.effectManager=null),this.deckRenderer&&(this.deckRenderer.finalize(),this.deckRenderer=null),this.eventManager&&this.eventManager.destroy(),this.props.canvas||this.props.gl||!this.canvas||(this.canvas.parentElement.removeChild(this.canvas),this.canvas=null)}},{key:"setProps",value:function(t){this.stats.get("setProps Time").timeStart(),"onLayerHover"in t&&r.removed("onLayerHover","onHover")(),"onLayerClick"in t&&r.removed("onLayerClick","onClick")(),t=Object.assign({},this.props,t),this.props=t,this._setCanvasSize(t);var e=Object.assign({},t,{views:this._getViews(this.props),width:this.width,height:this.height}),i=this._getViewState(t);i&&(e.viewState=i),this.viewManager&&this.viewManager.setProps(e),this.layerManager&&this.layerManager.setProps(e),this.effectManager&&this.effectManager.setProps(e),this.animationLoop&&this.animationLoop.setProps(e),this.deckRenderer&&this.deckRenderer.setProps(e),this.deckPicker&&this.deckPicker.setProps(e),this.stats.get("setProps Time").timeEnd()}},{key:"needsRedraw",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearRedrawFlags:!1};if(this.props._animate)return"Deck._animate";var e=this._needsRedraw;t.clearRedrawFlags&&(this._needsRedraw=!1);var i=this.viewManager.needsRedraw(t),n=this.layerManager.needsRedraw(t),r=this.effectManager.needsRedraw(t),a=this.deckRenderer.needsRedraw(t);return e=e||i||n||r||a}},{key:"redraw",value:function(t){if(this.layerManager){var e=t||this.needsRedraw({clearRedrawFlags:!0});e&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(e):this._drawLayers(e))}}},{key:"getViews",value:function(){return this.viewManager.views}},{key:"getViewports",value:function(t){return this.viewManager.getViewports(t)}},{key:"pickObject",value:function(t){var e=t.x,i=t.y,n=t.radius,r=void 0===n?0:n,a=t.layerIds,o=void 0===a?null:a;this.stats.get("Pick Count").incrementCount(),this.stats.get("pickObject Time").timeStart();var s=this.layerManager.getLayers({layerIds:o}),c=this.layerManager.activateViewport,u=this.deckPicker.pickObject({x:e,y:i,radius:r,layers:s,viewports:this.getViewports({x:e,y:i}),activateViewport:c,mode:"query",depth:1}).result;return this.stats.get("pickObject Time").timeEnd(),u.length?u[0]:null}},{key:"pickMultipleObjects",value:function(t){var e=t.x,i=t.y,n=t.radius,r=void 0===n?0:n,a=t.layerIds,o=void 0===a?null:a,s=t.depth,c=void 0===s?10:s;this.stats.get("Pick Count").incrementCount(),this.stats.get("pickMultipleObjects Time").timeStart();var u=this.layerManager.getLayers({layerIds:o}),l=this.layerManager.activateViewport,h=this.deckPicker.pickObject({x:e,y:i,radius:r,layers:u,viewports:this.getViewports({x:e,y:i}),activateViewport:l,mode:"query",depth:c}).result;return this.stats.get("pickMultipleObjects Time").timeEnd(),h}},{key:"pickObjects",value:function(t){var e=t.x,i=t.y,n=t.width,r=void 0===n?1:n,a=t.height,o=void 0===a?1:a,s=t.layerIds,c=void 0===s?null:s;this.stats.get("Pick Count").incrementCount(),this.stats.get("pickObjects Time").timeStart();var u=this.layerManager.getLayers({layerIds:c}),l=this.layerManager.activateViewport,h=this.deckPicker.pickObjects({x:e,y:i,width:r,height:o,layers:u,viewports:this.getViewports({x:e,y:i,width:r,height:o}),activateViewport:l});return this.stats.get("pickObjects Time").timeEnd(),h}},{key:"_createCanvas",value:function(t){var e=t.canvas;("string"==typeof e&&g(e=document.getElementById(e)),e)||(e=document.createElement("canvas"),(t.parent||document.body).appendChild(e));var i=t.id,n=t.style;return e.id=i,Object.assign(e.style,n),e}},{key:"_setCanvasSize",value:function(t){if(this.canvas){var e=t.width,i=t.height;(e||0===e)&&(e=Number.isFinite(e)?"".concat(e,"px"):e,this.canvas.style.width=e),(i||0===i)&&(i=Number.isFinite(i)?"".concat(i,"px"):i,this.canvas.style.position="absolute",this.canvas.style.height=i)}}},{key:"_updateCanvasSize",value:function(){if(this._checkForCanvasSizeChange()){var t=this.width,e=this.height;this.viewManager.setProps({width:t,height:e}),this.props.onResize({width:this.width,height:this.height})}}},{key:"_checkForCanvasSizeChange",value:function(){var t=this.canvas;if(!t)return!1;var e=t.clientWidth||t.width,i=t.clientHeight||t.height;return(e!==this.width||i!==this.height)&&(this.width=e,this.height=i,!0)}},{key:"_createAnimationLoop",value:function(t){var e=this,i=t.width,n=t.height,r=t.gl,a=t.glOptions,s=t.debug,c=t.useDevicePixels,u=t.autoResizeDrawingBuffer;return new o.b({width:i,height:n,useDevicePixels:c,autoResizeDrawingBuffer:u,gl:r,onCreateContext:function(t){return Object(o.v)(Object.assign({},a,t,{canvas:e.canvas,debug:s}))},onInitialize:this._onRendererInitialized,onRender:this._onRenderFrame,onBeforeRender:t.onBeforeRender,onAfterRender:t.onAfterRender})}},{key:"_getViewState",value:function(t){return t.viewState||this.viewState}},{key:"_getViews",value:function(t){var e=t.views||[new _i({id:"default-view"})];return(e=Array.isArray(e)?e:[e]).length&&t.controller&&(e[0].props.controller=t.controller),e}},{key:"_requestPick",value:function(t){var e=t.event,i=t.callback,n=t.mode,r=this._pickRequest;if("pointerleave"===e.type)r.x=-1,r.y=-1,r.radius=0;else{var a=e.offsetCenter;if(!a)return;r.x=a.x,r.y=a.y,r.radius=this.props.pickingRadius}r.callback=i,r.event=e,r.mode=n}},{key:"_pickAndCallback",value:function(){var t=this._pickRequest;if(t.mode){var e=this.deckPicker.pickObject(Object.assign({layers:this.layerManager.getLayers(),viewports:this.getViewports(t),activateViewport:this.layerManager.activateViewport,depth:1},t)),i=e.result,n=e.emptyInfo;if(t.callback){var r=i.find(function(t){return t.index>=0})||n;t.callback(r,t.event)}t.mode=null}}},{key:"_updateCursor",value:function(){this.canvas&&(this.canvas.style.cursor=this.props.getCursor(this.interactiveState))}},{key:"_updateAnimationProps",value:function(t){this.layerManager.context.animationProps=t}},{key:"_setGLContext",value:function(t){if(!this.layerManager){for(var e in this.canvas||(this.canvas=t.canvas,Object(o.M)(t,{enable:!0,copyState:!0})),Object(o.K)(t,{blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onWebGLInitialized(t),this.eventManager=new Li.a(t.canvas,{events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerLeave}}),d)this.eventManager.on(e,this._onEvent);this.viewManager=new Be({eventManager:this.eventManager,onViewStateChange:this._onViewStateChange,onInteractiveStateChange:this._onInteractiveStateChange,views:this._getViews(this.props),viewState:this._getViewState(this.props),width:this.width,height:this.height}),g(this.viewManager);var i=this.viewManager.getViewports()[0];this.layerManager=new ve(t,{deck:this,stats:this.stats,viewport:i}),this.effectManager=new ji,this.deckRenderer=new xi(t),this.deckPicker=new Ei(t),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}}},{key:"_drawLayers",value:function(t,e){var i=this.layerManager.context.gl;Object(o.K)(i,this.props.parameters),this.props.onBeforeRender({gl:i});var n=this.layerManager.getLayers(),r=this.layerManager.activateViewport;this.deckRenderer.renderLayers(Object.assign({layers:n,viewports:this.viewManager.getViewports(),activateViewport:r,views:this.viewManager.getViews(),pass:"screen",redrawReason:t,effects:this.effectManager.getEffects()},e)),this.props.onAfterRender({gl:i})}},{key:"_onRendererInitialized",value:function(t){var e=t.gl;this._setGLContext(e)}},{key:"_onRenderFrame",value:function(t){this._getFrameStats(),this._metricsCounter++%60==0&&(this._getMetrics(),this.stats.reset(),r.table(3,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(t),this._updateAnimationProps(t),this._pickAndCallback(),this.redraw(!1),this.viewManager&&this.viewManager.updateViewStates(t)}},{key:"_onViewStateChange",value:function(t){var e=this.props.onViewStateChange(t)||t.viewState;this.viewState&&(this.viewState[t.viewId]=e,this.viewManager.setProps({viewState:e}))}},{key:"_onInteractiveStateChange",value:function(t){var e=t.isDragging,i=void 0!==e&&e;i!==this.interactiveState.isDragging&&(this.interactiveState.isDragging=i)}},{key:"_onEvent",value:function(t){var e=d[t.type],i=t.offsetCenter;if(e&&i){var n=this.layerManager.getLayers(),r=this.deckPicker.getLastPickedObject({x:i.x,y:i.y,layers:n,viewports:this.getViewports(i)},this._lastPointerDownInfo),a=r.layer,o=a&&(a[e.handler]||a.props[e.handler]),s=this.props[e.handler],c=!1;o&&(c=o.call(a,r,t)),!c&&s&&s(r,t)}}},{key:"_onPointerDown",value:function(t){var e=t.offsetCenter;this._lastPointerDownInfo=this.pickObject({x:e.x,y:e.y})}},{key:"_onPointerMove",value:function(t){t.leftButton||t.rightButton||this._requestPick({callback:this.props.onHover,event:t,mode:"hover"})}},{key:"_onPointerLeave",value:function(t){this._requestPick({callback:this.props.onHover,event:t,mode:"hover"})}},{key:"_getFrameStats",value:function(){this.stats.get("frameRate").timeEnd(),this.stats.get("frameRate").timeStart();var t=this.animationLoop.stats;this.stats.get("GPU Time").addTime(t.get("GPU Time").lastTiming),this.stats.get("CPU Time").addTime(t.get("CPU Time").lastTiming)}},{key:"_getMetrics",value:function(){this.metrics.fps=this.stats.get("frameRate").getHz(),this.metrics.setPropsTime=this.stats.get("setProps Time").time,this.metrics.updateAttributesTime=this.stats.get("Update Attributes").time,this.metrics.framesRedrawn=this.stats.get("Redraw Count").count,this.metrics.pickTime=this.stats.get("pickObject Time").time+this.stats.get("pickMultipleObjects Time").time+this.stats.get("pickObjects Time").time,this.metrics.pickCount=this.stats.get("Pick Count").count,this.metrics.gpuTime=this.stats.get("GPU Time").time,this.metrics.cpuTime=this.stats.get("CPU Time").time,this.metrics.gpuTimePerFrame=this.stats.get("GPU Time").getAverageTime(),this.metrics.cpuTimePerFrame=this.stats.get("CPU Time").getAverageTime();var t=o.D.get("Memory Usage");this.metrics.bufferMemory=t.get("Buffer Memory").count,this.metrics.textureMemory=t.get("Texture Memory").count,this.metrics.renderbufferMemory=t.get("Renderbuffer Memory").count,this.metrics.gpuMemory=t.get("GPU Memory").count}}]),t}();Ri.getPropTypes=function(t){return{id:t.string,width:t.oneOfType([t.number,t.string]),height:t.oneOfType([t.number,t.string]),layers:t.oneOfType([t.object,t.array]),layerFilter:t.func,views:t.oneOfType([t.object,t.array]),viewState:t.object,effects:t.arrayOf(t.instanceOf(z)),controller:t.oneOfType([t.func,t.bool,t.object]),gl:t.object,glOptions:t.object,parameters:t.object,pickingRadius:t.number,useDevicePixels:t.bool,onWebGLInitialized:t.func,onResize:t.func,onViewStateChange:t.func,onBeforeRender:t.func,onAfterRender:t.func,onLoad:t.func,debug:t.bool,drawPickingColors:t.bool,_animate:t.bool}},Ri.defaultProps=Ii;function Fi(t,e){return Number.isFinite(t)?t:e}var Ni=function(t){function e(t){var i,n=t.width,r=t.height,a=t.position,o=t.bearing,s=t.pitch,c=t.longitude,u=t.latitude,l=t.zoom,h=(t.syncBearing,t.bounds,t.startPanEventPosition),p=t.startPanPosition,d=t.startRotateCenter,v=t.startRotateViewport,f=t.startZoomPos,g=t.startZoom;return Object(L.a)(this,e),(i=Object(I.a)(this,Object(R.a)(e).call(this,{width:n,height:r,position:a,bearing:o,pitch:s,longitude:c,latitude:u,zoom:l})))._interactiveState={startPanEventPosition:h,startPanPosition:p,startRotateCenter:d,startRotateViewport:v,startZoomPos:f,startZoom:g},i}return Object(F.a)(e,t),Object(A.a)(e,[{key:"getInteractiveState",value:function(){return this._interactiveState}},{key:"panStart",value:function(t){var e=t.pos,i=this._viewportProps,n=i.translationX,r=i.translationY;return this._getUpdatedState({startPanPosition:[n,r],startPanEventPosition:e})}},{key:"pan",value:function(t){var e=t.pos,i=t.startPos,n=this._interactiveState.startPanEventPosition||i;if(!n)return this;var r=this._interactiveState.startPanPosition||[],a=Object(B.a)(r,2),o=a[0],s=a[1];o=Fi(o,this._viewportProps.translationX),s=Fi(s,this._viewportProps.translationY);var c=e[0]-n[0],u=e[1]-n[1];return this._getUpdatedState({translationX:o+c,translationY:s-u})}},{key:"panEnd",value:function(){return this._getUpdatedState({startPanPosition:null,startPanPos:null})}},{key:"rotateStart",value:function(t){t.pos;return this._getUpdatedState({startRotateCenter:this._viewportProps.position,startRotateViewport:this._viewportProps})}},{key:"rotate",value:function(t){var e=t.deltaScaleX,i=t.deltaScaleY;if(!this._interactiveState.startRotateCenter)return this;var n=this._viewportProps,r=n.bearing,a=n.pitch;return this._getUpdatedState({bearing:r+10*e,pitch:a-10*i})}},{key:"rotateEnd",value:function(){return this._getUpdatedState({startRotateCenter:null,startRotateViewport:null})}},{key:"zoomStart",value:function(t){var e=t.pos;return this._getUpdatedState({startZoomPos:e,startZoom:this._viewportProps.zoom})}},{key:"zoom",value:function(t){var e=t.pos,i=t.startPos,n=t.scale,r=this._viewportProps,a=r.zoom,o=r.minZoom,s=r.maxZoom,c=r.width,u=r.height,l=(r.translationX,r.translationY,this._interactiveState.startZoomPos||i||e),h=Object(ae.b)(a*n,o,s);e[0],l[0],e[1],l[1],l[0],l[1];return h/a<1?this.moveBackward():this.moveForward()}},{key:"zoomEnd",value:function(){return this._getUpdatedState({startZoomPos:null,startZoom:null})}},{key:"moveLeft",value:function(){var t=this._viewportProps.bearing-2;return this._getUpdatedState({bearing:t})}},{key:"moveRight",value:function(){var t=this._viewportProps.bearing+2;return this._getUpdatedState({bearing:t})}},{key:"moveForward",value:function(){var t=this._viewportProps.position,e=this.getDirection(),i=new se.a(e).normalize().scale(1);return this._getUpdatedState({position:new se.a(t).add(i)})}},{key:"moveBackward",value:function(){var t=this._viewportProps.position,e=this.getDirection(),i=new se.a(e).normalize().scale(-1);return this._getUpdatedState({position:new se.a(t).add(i)})}},{key:"moveUp",value:function(){var t=this._viewportProps.position;return this._getUpdatedState({position:new se.a(t).add([0,0,1])})}},{key:"moveDown",value:function(){var t=this._viewportProps.position,e=t[2]>=1?[0,0,-1]:[0,0,0];return this._getUpdatedState({position:new se.a(t).add(e)})}},{key:"zoomIn",value:function(){return this._getUpdatedState({zoom:this._viewportProps.zoom+.2})}},{key:"zoomOut",value:function(){return this._getUpdatedState({zoom:this._viewportProps.zoom-.2})}},{key:"_getUpdatedState",value:function(t){return new e(Object.assign({},this._viewportProps,this._interactiveState,t))}}]),e}(pi),zi=function(t){function e(t){return Object(L.a)(this,e),Object(I.a)(this,Object(R.a)(e).call(this,Ni,t))}return Object(F.a)(e,t),e}(ci);(function(t){function e(){return Object(L.a)(this,e),Object(I.a)(this,Object(R.a)(e).apply(this,arguments))}return Object(F.a)(e,t),Object(A.a)(e,[{key:"_getViewport",value:function(t){var e=t.viewState,i=e.modelMatrix,n=void 0===i?null:i,r=e.bearing,a=e.up,o=void 0===a?[0,0,1]:a,s=function(t){var e=t.bearing,i=t.pitch;return new li({bearing:e,pitch:i}).toVector3().normalize()}({bearing:r,pitch:89}),c=n?n.transformDirection(s):s,u=(new oe.a).lookAt({eye:[0,0,0],center:c,up:o});return new he(Object.assign({},t,{zoom:null,viewMatrix:u}))}},{key:"controller",get:function(){return this._getControllerProps({type:zi})}}]),e}(Ue)).displayName="FirstPersonView",(function(t){function e(){return Object(L.a)(this,e),Object(I.a)(this,Object(R.a)(e).apply(this,arguments))}return Object(F.a)(e,t),Object(A.a)(e,[{key:"_getViewport",value:function(t){var e=t.viewState,i=e.bearing,n=e.pitch,r=e.position,a=e.up,o=50*e.zoom,s=function(t){var e=t.bearing,i=t.pitch;return new li({bearing:e,pitch:i}).toVector3().normalize()}({bearing:i,pitch:n}).scale(-o).multiply(new se.a(1,1,-1)),c=(new oe.a).multiplyRight((new oe.a).lookAt({eye:s,center:r,up:a}));return new he(Object.assign({},t,{id:this.id,zoom:null,viewMatrix:c}))}}]),e}(Ue)).displayName="ThirdPersonView";var Di=i(389),Vi={orbitAxis:"Z",rotationX:0,rotationOrbit:0,fovy:50,zoom:0,target:[0,0,0],minZoom:-1/0,maxZoom:1/0},Ui={transitionDuration:300,transitionEasing:function(t){return t},transitionInterpolator:new He(["target","zoom","rotationX","rotationOrbit"]),transitionInterruption:Je},Bi=function(t){return Math.pow(2,t)},Zi=function(t){function e(t){var i,n=t.ViewportType,r=t.width,a=t.height,o=t.orbitAxis,s=void 0===o?Vi.orbitAxis:o,c=t.rotationX,u=void 0===c?Vi.rotationX:c,l=t.rotationOrbit,h=void 0===l?Vi.rotationOrbit:l,p=t.target,d=void 0===p?Vi.target:p,v=t.zoom,f=void 0===v?Vi.zoom:v,g=t.fovy,y=void 0===g?Vi.fovy:g,m=t.minZoom,b=void 0===m?Vi.minZoom:m,w=t.maxZoom,_=void 0===w?Vi.maxZoom:w,j=t.startPanPosition,k=t.startTarget,P=t.startRotationX,O=t.startRotationOrbit,x=t.startZoomPosition,S=t.startZoom;return Object(L.a)(this,e),(i=Object(I.a)(this,Object(R.a)(e).call(this,{width:r,height:a,orbitAxis:s,rotationX:u,rotationOrbit:h,target:d,fovy:y,zoom:f,minZoom:b,maxZoom:_})))._interactiveState={startPanPosition:j,startTarget:k,startRotationX:P,startRotationOrbit:O,startZoomPosition:x,startZoom:S},i.ViewportType=n,i}return Object(F.a)(e,t),Object(A.a)(e,[{key:"getViewportProps",value:function(){return this._viewportProps}},{key:"getInteractiveState",value:function(){return this._interactiveState}},{key:"panStart",value:function(t){var e=t.pos,i=this._viewportProps.target;return this._getUpdatedState({startPanPosition:e,startTarget:i})}},{key:"pan",value:function(t){var e=t.pos,i=(t.startPos,this._interactiveState),n=i.startPanPosition,r=i.startTarget,a=new Di.a(e).subtract(n);return this._getUpdatedState({target:this._calculateNewTarget({startTarget:r,pixelOffset:a})})}},{key:"panEnd",value:function(){return this._getUpdatedState({startPanPosition:null,startTarget:null})}},{key:"rotateStart",value:function(t){t.pos;return this._getUpdatedState({startRotationX:this._viewportProps.rotationX,startRotationOrbit:this._viewportProps.rotationOrbit})}},{key:"rotate",value:function(t){var e=t.deltaScaleX,i=t.deltaScaleY,n=this._interactiveState,r=n.startRotationX,a=n.startRotationOrbit;if(!Number.isFinite(r)||!Number.isFinite(a))return this;var o=Object(ae.b)(r+180*i,-89.999,89.999),s=(a+180*e)%360;return this._getUpdatedState({rotationX:o,rotationOrbit:s,isRotating:!0})}},{key:"rotateEnd",value:function(){return this._getUpdatedState({startRotationX:null,startRotationOrbit:null})}},{key:"shortestPathFrom",value:function(t){return Object.assign({},this._viewportProps)}},{key:"zoomStart",value:function(t){var e=t.pos;return this._getUpdatedState({startZoomPosition:e,startTarget:this._viewportProps.target,startZoom:this._viewportProps.zoom})}},{key:"zoom",value:function(t){var e=t.pos,i=t.startPos,n=t.scale,r=this._viewportProps,a=r.zoom,o=r.width,s=r.height,c=r.target,u=this._interactiveState,l=u.startZoom,h=u.startZoomPosition,p=u.startTarget;Number.isFinite(l)||(l=a,p=c,h=i||e);var d=this._calculateNewZoom({scale:n,startZoom:l}),v=Bi(l),f=Bi(d),g=(o/2-h[0])*(f/v-1),y=(s/2-h[1])*(f/v-1);return this._getUpdatedState({zoom:d,target:this._calculateNewTarget({startTarget:p,zoom:d,pixelOffset:[g,y]})})}},{key:"zoomEnd",value:function(){return this._getUpdatedState({startZoomPosition:null,startTarget:null,startZoom:null})}},{key:"zoomIn",value:function(){return this._getUpdatedState({zoom:this._calculateNewZoom({scale:2})})}},{key:"zoomOut",value:function(){return this._getUpdatedState({zoom:this._calculateNewZoom({scale:.5})})}},{key:"moveLeft",value:function(){var t=[-50,0];return this._getUpdatedState({target:this._calculateNewTarget({pixelOffset:t})})}},{key:"moveRight",value:function(){var t=[50,0];return this._getUpdatedState({target:this._calculateNewTarget({pixelOffset:t})})}},{key:"moveUp",value:function(){var t=[0,-50];return this._getUpdatedState({target:this._calculateNewTarget({pixelOffset:t})})}},{key:"moveDown",value:function(){var t=[0,50];return this._getUpdatedState({target:this._calculateNewTarget({pixelOffset:t})})}},{key:"rotateLeft",value:function(){return this._getUpdatedState({rotationOrbit:this._viewportProps.rotationOrbit-15})}},{key:"rotateRight",value:function(){return this._getUpdatedState({rotationOrbit:this._viewportProps.rotationOrbit+15})}},{key:"rotateUp",value:function(){return this._getUpdatedState({rotationX:this._viewportProps.rotationX-10})}},{key:"rotateDown",value:function(){return this._getUpdatedState({rotationX:this._viewportProps.rotationX+10})}},{key:"_calculateNewZoom",value:function(t){var e=t.scale,i=t.startZoom,n=this._viewportProps,r=n.maxZoom,a=n.minZoom;Number.isFinite(i)||(i=this._viewportProps.zoom);var o=i+Math.log2(e);return Object(ae.b)(o,a,r)}},{key:"_calculateNewTarget",value:function(t){var e=t.startTarget,i=t.zoom,n=t.pixelOffset,r=Object.assign({},this._viewportProps);Number.isFinite(i)&&(r.zoom=i),e&&(r.target=e);var a=new this.ViewportType(r),o=a.project(r.target);return a.unproject([o[0]-n[0],o[1]-n[1],o[2]])}},{key:"_getUpdatedState",value:function(t){return new e(Object.assign({},this._viewportProps,this._interactiveState,t))}},{key:"_applyConstraints",value:function(t){var e=t.maxZoom,i=t.minZoom,n=t.zoom;return t.zoom=n>e?e:n,t.zoom=n<i?i:n,t}}]),e}(pi),Gi=function(t){function e(t){return Object(L.a)(this,e),Object(I.a)(this,Object(R.a)(e).call(this,Zi,t))}return Object(F.a)(e,t),Object(A.a)(e,[{key:"_getTransitionProps",value:function(){return Ui}}]),e}(ci),Xi=Math.PI/180;function Yi(t){var e=t.height,i=t.fovy,n=t.orbitAxis,r=t.rotationX,a=t.rotationOrbit,o=(t.zoom,.5/Math.tan(i*Xi/2)),s=(new oe.a).lookAt({eye:[0,0,o]});s.rotateX(r*Xi),"Z"===n?s.rotateZ(a*Xi):s.rotateY(a*Xi);var c=1/(e||1);return s.scale([c,c,c]),s}var Wi=function(t){function e(t){Object(L.a)(this,e);var i=t.id,n=t.x,r=t.y,a=t.width,o=t.height,s=t.fovy,c=void 0===s?50:s,u=t.near,l=t.far,h=t.orbitAxis,p=void 0===h?"Z":h,d=t.target,v=void 0===d?[0,0,0]:d,f=t.rotationX,g=void 0===f?0:f,y=t.rotationOrbit,m=void 0===y?0:y,b=t.zoom,w=void 0===b?0:b;return Object(I.a)(this,Object(R.a)(e).call(this,{id:i,viewMatrix:Yi({height:o,fovy:c,orbitAxis:p,rotationX:g,rotationOrbit:m,zoom:w}),fovy:c,near:u,far:l,x:n,y:r,position:v,width:a,height:o,zoom:w}))}return Object(F.a)(e,t),e}(he),qi=function(t){function e(t){return Object(L.a)(this,e),Object(I.a)(this,Object(R.a)(e).call(this,Object.assign({},t,{type:Wi})))}return Object(F.a)(e,t),Object(A.a)(e,[{key:"controller",get:function(){return this._getControllerProps({type:Gi,ViewportType:Wi})}}]),e}(Ue);qi.displayName="OrbitView";var Hi=Math.PI/180;(function(t){function e(){return Object(L.a)(this,e),Object(I.a)(this,Object(R.a)(e).apply(this,arguments))}return Object(F.a)(e,t),Object(A.a)(e,[{key:"_getViewport",value:function(t){var e=t.x,i=t.y,n=t.width,r=t.height,a=t.viewState,o=a.eye,s=a.lookAt,c=void 0===s?[0,0,0]:s,u=a.up,h=void 0===u?[0,1,0]:u,p=t.fovy||a.fovy||75,d=t.near||a.near||1,v=t.far||a.far||100,f=Number.isFinite(a.aspect)?a.aspect:n/r,g=p*Hi;return new he({id:this.id,x:e,y:i,width:n,height:r,viewMatrix:l.f([],o,c,h),projectionMatrix:l.i([],g,f,d,v)})}}]),e}(Ue)).displayName="PerspectiveView";var Ki={transitionDuration:300,transitionEasing:function(t){return t},transitionInterpolator:new He(["target","zoom"]),transitionInterruption:Je},Ji=function(t){function e(t){var i;return Object(L.a)(this,e),(i=Object(I.a)(this,Object(R.a)(e).call(this,Zi,t))).invertPan=!0,i}return Object(F.a)(e,t),Object(A.a)(e,[{key:"_onPanRotate",value:function(t){return!1}},{key:"_getTransitionProps",value:function(){return Ki}}]),e}(ci),$i=(new oe.a).lookAt({eye:[0,0,1]});function Qi(t){var e=t.width,i=t.height,n=t.near,r=t.far;return e=e||1,i=i||1,(new oe.a).ortho({left:-e/2,right:e/2,bottom:i/2,top:-i/2,near:n,far:r})}var tn=function(t){function e(t){var i=t.id,n=t.x,r=t.y,a=t.width,o=t.height,s=t.near,c=void 0===s?.1:s,u=t.far,l=void 0===u?1e3:u,h=t.zoom,p=void 0===h?0:h,d=t.target,v=void 0===d?[0,0,0]:d;return Object(L.a)(this,e),Object(I.a)(void 0,new he({id:i,x:n,y:r,width:a,height:o,position:v,viewMatrix:$i,projectionMatrix:Qi({width:a,height:o,near:c,far:l}),zoom:p}))}return Object(F.a)(e,t),e}(he);(function(t){function e(t){return Object(L.a)(this,e),Object(I.a)(this,Object(R.a)(e).call(this,Object.assign({},t,{type:tn})))}return Object(F.a)(e,t),Object(A.a)(e,[{key:"controller",get:function(){return this._getControllerProps({type:Ji,ViewportType:tn})}}]),e}(Ue)).displayName="OrthographicView";var en=i(438),nn=["bearing","pitch"],rn=(function(t){function e(){return Object(L.a)(this,e),Object(I.a)(this,Object(R.a)(e).call(this,{compare:["longitude","latitude","zoom","bearing","pitch"],extract:["width","height","longitude","latitude","zoom","bearing","pitch"],required:["width","height","latitude","longitude","zoom"]}))}Object(F.a)(e,t),Object(A.a)(e,[{key:"interpolateProps",value:function(t,e,i){for(var n=Object(en.a)(t,e,i),r=0;r<nn.length;r++){var a=nn[r];n[a]=Object(ae.g)(t[a]||0,e[a]||0,i)}return n}}])}(We),function(){function t(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).overAlloc,i=void 0===e?1:e;Object(L.a)(this,t),this.overAlloc=i}return Object(A.a)(t,[{key:"allocate",value:function(t,e,i){var n=i.size,r=i.type,a=i.copy,o=void 0!==a&&a,s=e*n;if(t&&s<=t.length)return t;var c=Math.max(Math.ceil(s*this.overAlloc),1),u=this._allocate(r,c);return t&&o&&u.set(t),this._release(t),u}},{key:"_allocate",value:function(){return new(arguments.length>0&&void 0!==arguments[0]?arguments[0]:Float32Array)(arguments.length>1?arguments[1]:void 0)}},{key:"_release",value:function(t){}}]),t}()),an=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(L.a)(this,t);var i=e.attributes,n=void 0===i?{}:i;this.typedArrayManager=new rn,this.indexLayout=null,this.bufferLayout=null,this.vertexCount=0,this.instanceCount=0,this.attributes={},this._attributeDefs=n,this.updateGeometry(e),Object.seal(this)}return Object(A.a)(t,[{key:"updateGeometry",value:function(t){var e=t.data,i=t.getGeometry,n=t.positionFormat,r=t.fp64;this.data=e,this.getGeometry=i,this.fp64=r,this.positionSize="XY"===n?2:3,this._rebuildGeometry()}},{key:"updatePartialGeometry",value:function(t){var e=t.startRow,i=t.endRow;this._rebuildGeometry({startRow:e,endRow:i})}},{key:"updateGeometryAttributes",value:function(t,e,i){throw new Error("Not implemented")}},{key:"getGeometrySize",value:function(t){throw new Error("Not implemented")}},{key:"_forEachGeometry",value:function(t,e,i){var n=this.data,r=this.getGeometry,a=J(n,e,i),o=a.iterable,s=a.objectInfo,c=!0,u=!1,l=void 0;try{for(var h,p=o[Symbol.iterator]();!(c=(h=p.next()).done);c=!0){var d=h.value;s.index++,t(r(d,s),s.index)}}catch(v){u=!0,l=v}finally{try{c||null==p.return||p.return()}finally{if(u)throw l}}}},{key:"_rebuildGeometry",value:function(t){var e=this;if(this.data&&this.getGeometry){var i=this.indexLayout,n=this.bufferLayout;t||(i=[],n=[]);var r=t||{},a=r.startRow,o=void 0===a?0:a,s=r.endRow,c=void 0===s?1/0:s;this._forEachGeometry(function(t,i){n[i]=e.getGeometrySize(t)},o,c);var u=0,l=!0,h=!1,p=void 0;try{for(var d,v=n[Symbol.iterator]();!(l=(d=v.next()).done);l=!0){u+=d.value}}catch(O){h=!0,p=O}finally{try{l||null==v.return||v.return()}finally{if(h)throw p}}var f=this.attributes,g=this._attributeDefs,y=this.typedArrayManager,m=this.fp64;for(var b in g){var w=g[b];w.copy=Boolean(t),w.fp64Only&&!m||(f[b]=y.allocate(f[b],u,w))}this.indexLayout=i,this.bufferLayout=n,this.instanceCount=u;for(var _={vertexStart:0,indexStart:0},j=0;j<o;j++)_.vertexStart+=n[j],_.indexStart+=i[j]||0;this._forEachGeometry(function(t,r){var a=n[r];_.geometryIndex=r,_.geometrySize=a,e.updateGeometryAttributes(t,_),_.vertexStart+=a,_.indexStart+=i[r]||0},o,c);for(var k=_.indexStart,P=c;P<i.length;P++)k+=i[P];this.vertexCount=k}}}]),t}();i.d(e,"i",function(){return on}),i.d(e,"a",function(){return p}),i.d(e,"c",function(){return Ri}),i.d(e,"d",function(){return ie}),i.d(e,"b",function(){return ne}),i.d(e,"g",function(){return Ue}),i.d(e,"f",function(){return qi}),i.d(e,"e",function(){return He}),i.d(e,"j",function(){return r}),i.d(e,"h",function(){return J});var on={Tesselator:an,flattenVertices:function t(e){for(var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=i.result,r=void 0===n?[]:n,a=i.dimensions,o=void 0===a?3:a,s=-1,c=0;++s<e.length;){var u=e[s];Array.isArray(u)||ArrayBuffer.isView(u)?t(u,{result:r,dimensions:o}):c<o&&(r.push(u),c++)}return c>0&&c<o&&r.push(0),r},fillArray:Q,count:Rt,memoize:f}},290:function(t,e,i){"use strict";i.d(e,"a",function(){return r}),i.d(e,"d",function(){return a}),i.d(e,"c",function(){return o}),i.d(e,"b",function(){return s});var n=i(275);function r(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function a(t,e){var i=n.o([],e,t);return n.l(i,i,1/i[3]),i}function o(t,e){var i=t%e;return i<0?e+i:i}function s(t,e,i){return i*e+(1-i)*t}},317:function(t,e,i){"use strict";i.d(e,"l",function(){return g}),i.d(e,"i",function(){return y}),i.d(e,"g",function(){return m}),i.d(e,"j",function(){return b}),i.d(e,"c",function(){return w}),i.d(e,"b",function(){return _}),i.d(e,"a",function(){return j}),i.d(e,"f",function(){return k}),i.d(e,"e",function(){return P}),i.d(e,"d",function(){return O}),i.d(e,"k",function(){return x}),i.d(e,"h",function(){return S});var n=i(216),r=i(290),a=i(273),o=i(274),s=i(270),c=i(346),u=Math.PI,l=u/4,h=u/180,p=180/u,d=512,v=4003e4,f=1.5;function g(t){return Math.pow(2,t)}function y(t){return Math.log2(t)}function m(t,e){var i=Object(n.a)(t,2),r=i[0],a=i[1];Object(c.a)(Number.isFinite(r)&&Number.isFinite(e)),Object(c.a)(Number.isFinite(a)&&a>=-90&&a<=90,"invalid latitude");var o=a*h;return[(e*=d)*(r*h+u)/(2*u),e*(u-Math.log(Math.tan(l+.5*o)))/(2*u)]}function b(t,e){var i=Object(n.a)(t,2),r=i[0],a=i[1],o=r/(e*=d)*(2*u)-u,s=2*(Math.atan(Math.exp(u-a/e*(2*u)))-l);return[o*p,s*p]}function w(t){var e=t.latitude;Object(c.a)(Number.isFinite(e));var i=Math.cos(e*h);return y(v*i)-9}function _(t){var e=t.latitude,i=t.longitude,n=t.zoom,r=t.scale,a=t.highPrecision,o=void 0!==a&&a;r=void 0!==r?r:g(n),Object(c.a)(Number.isFinite(e)&&Number.isFinite(i)&&Number.isFinite(r));var s={},u=d*r,l=Math.cos(e*h),p=u/360,f=p/l,y=u/v/l;if(s.pixelsPerMeter=[y,-y,y],s.metersPerPixel=[1/y,-1/y,1/y],s.pixelsPerDegree=[p,-f,y],s.degreesPerPixel=[1/p,-1/f,1/y],o){var m=h*Math.tan(e*h)/l,b=p*m/2,w=u/v*m,_=w/f*y;s.pixelsPerDegree2=[0,-b,w],s.pixelsPerMeter2=[_,0,_]}return s}function j(t,e){var i=Object(n.a)(t,3),r=i[0],a=i[1],o=i[2],s=Object(n.a)(e,3),c=s[0],u=s[1],l=s[2],h=_({longitude:r,latitude:a,scale:1,highPrecision:!0}),p=h.pixelsPerMeter,d=h.pixelsPerMeter2,v=m(t,1);v[0]+=c*(p[0]+d[0]*u),v[1]+=u*(p[1]+d[1]*u);var f=b(v,1),g=(o||0)+(l||0);return Number.isFinite(o)||Number.isFinite(l)?[f[0],f[1],g]:f}function k(t){var e=t.height,i=t.pitch,n=t.bearing,o=t.altitude,c=t.center,u=void 0===c?null:c,l=t.flipY,p=void 0!==l&&l,d=Object(r.a)();return a.o(d,d,[0,0,-o]),a.n(d,d,[1,1,1/e]),a.k(d,d,-i*h),a.m(d,d,n*h),p&&a.n(d,d,[1,-1,1]),u&&a.o(d,d,s.h([],u)),d}function P(t){var e=t.width,i=t.height,n=t.altitude,r=void 0===n?f:n,a=t.pitch,o=void 0===a?0:a,s=t.nearZMultiplier,c=void 0===s?1:s,u=t.farZMultiplier,l=void 0===u?1:u,p=o*h,d=Math.atan(.5/r),v=Math.sin(d)*r/Math.sin(Math.PI/2-p-d),g=Math.cos(Math.PI/2-p)*v+r;return{fov:2*Math.atan(i/2/r),aspect:e/i,focalDistance:r,near:c,far:g*l}}function O(t){var e=t.width,i=t.height,n=t.pitch,r=P({width:e,height:i,altitude:t.altitude,pitch:n,nearZMultiplier:t.nearZMultiplier,farZMultiplier:t.farZMultiplier}),o=r.fov,s=r.aspect,c=r.near,u=r.far;return a.i([],o,s,c,u)}function x(t,e){var i=Object(n.a)(t,3),a=i[0],o=i[1],s=i[2],u=void 0===s?0:s;return Object(c.a)(Number.isFinite(a)&&Number.isFinite(o)&&Number.isFinite(u)),Object(r.d)(e,[a,o,u,1])}function S(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=Object(n.a)(t,3),s=a[0],u=a[1],l=a[2];if(Object(c.a)(Number.isFinite(s)&&Number.isFinite(u),"invalid pixel coordinate"),Number.isFinite(l))return Object(r.d)(e,[s,u,l,1]);var h=Object(r.d)(e,[s,u,0,1]),p=Object(r.d)(e,[s,u,1,1]),d=h[2],v=p[2],f=d===v?0:((i||0)-d)/(v-d);return o.d([],h,p,f)}},346:function(t,e,i){"use strict";function n(t,e){if(!t)throw new Error(e||"viewport-mercator-project: assertion failed.")}i.d(e,"a",function(){return n})},347:function(t,e,i){var n=i(15),r=i(43),a=i(26),o=i(403),s="["+o+"]",c=RegExp("^"+s+s+"*"),u=RegExp(s+s+"*$"),l=function(t,e,i){var r={},s=a(function(){return!!o[t]()||"​"!="​"[t]()}),c=r[t]=s?e(h):o[t];i&&(r[i]=c),n(n.P+n.F*s,"String",r)},h=l.trim=function(t,e){return t=String(r(t)),1&e&&(t=t.replace(c,"")),2&e&&(t=t.replace(u,"")),t};t.exports=l},359:function(t,e,i){"use strict";var n=i(216),r=i(203),a=i(204),o=1,s=2,c=4,u={mousedown:o,mousemove:s,mouseup:c};var l,h,p=null;"undefined"!=typeof document&&(p=i(401),l=p.PointerEventInput,h=l.prototype.handler,l.prototype.handler=function(t){var e=this.store;t.button>0&&(function(t,e){for(var i=0;i<t.length;i++)if(e(t[i]))return!0;return!1}(e,function(e){return e.pointerId===t.pointerId})||e.push(t)),h.call(this,t)},p.MouseInput.prototype.handler=function(t){var e=u[t.type];e&o&&t.button>=0&&(this.pressed=!0),e&s&&0===t.which&&(e=c),this.pressed&&(e&c&&(this.pressed=!1),this.callback(this.manager,e,{pointers:[t],changedPointers:[t],pointerType:"mouse",srcEvent:t}))});var d=p;var v=d?[[d.Rotate,{enable:!1}],[d.Pinch,{enable:!1}],[d.Swipe,{enable:!1}],[d.Pan,{threshold:0,enable:!1}],[d.Press,{enable:!1}],[d.Tap,{event:"doubletap",taps:2,enable:!1}],[d.Tap,{event:"anytap",enable:!1}],[d.Tap,{enable:!1}]]:null,f={rotate:["pinch"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},g={doubletap:["tap"]},y={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},m=["keydown","keyup"],b=["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],w=["wheel","mousewheel","DOMMouseScroll"],_={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},j={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},k=i(402),P=-1!==k.b.indexOf("firefox"),O=w,x=function(){function t(e,i){var n=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object(r.a)(this,t),this.element=e,this.callback=i,this.options=Object.assign({enable:!0},a),this.events=O.concat(a.events||[]),this.handleEvent=this.handleEvent.bind(this),this.events.forEach(function(t){return e.addEventListener(t,n.handleEvent,!!k.a&&{passive:!1})})}return Object(a.a)(t,[{key:"destroy",value:function(){var t=this;this.events.forEach(function(e){return t.element.removeEventListener(e,t.handleEvent)})}},{key:"enableEventType",value:function(t,e){"wheel"===t&&(this.options.enable=e)}},{key:"handleEvent",value:function(t){if(this.options.enable){var e=t.deltaY;k.c.WheelEvent&&(P&&t.deltaMode===k.c.WheelEvent.DOM_DELTA_PIXEL&&(e/=k.c.devicePixelRatio),t.deltaMode===k.c.WheelEvent.DOM_DELTA_LINE&&(e*=40));var i={x:t.clientX,y:t.clientY};0!==e&&e%4.000244140625==0&&(e=Math.floor(e/4.000244140625)),t.shiftKey&&e&&(e*=.25),this._onWheel(t,-e,i)}}},{key:"_onWheel",value:function(t,e,i){this.callback({type:"wheel",center:i,delta:e,srcEvent:t,pointerType:"mouse",target:t.target})}}]),t}(),S=b,M=function(){function t(e,i){var n=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object(r.a)(this,t),this.element=e,this.callback=i,this.pressed=!1,this.options=Object.assign({enable:!0},a),this.enableMoveEvent=this.options.enable,this.enableLeaveEvent=this.options.enable,this.enableOutEvent=this.options.enable,this.enableOverEvent=this.options.enable,this.events=S.concat(a.events||[]),this.handleEvent=this.handleEvent.bind(this),this.events.forEach(function(t){return e.addEventListener(t,n.handleEvent)})}return Object(a.a)(t,[{key:"destroy",value:function(){var t=this;this.events.forEach(function(e){return t.element.removeEventListener(e,t.handleEvent)})}},{key:"enableEventType",value:function(t,e){"pointermove"===t&&(this.enableMoveEvent=e),"pointerover"===t&&(this.enableOverEvent=e),"pointerout"===t&&(this.enableOutEvent=e),"pointerleave"===t&&(this.enableLeaveEvent=e)}},{key:"handleEvent",value:function(t){this.handleOverEvent(t),this.handleOutEvent(t),this.handleLeaveEvent(t),this.handleMoveEvent(t)}},{key:"handleOverEvent",value:function(t){this.enableOverEvent&&"mouseover"===t.type&&this.callback({type:"pointerover",srcEvent:t,pointerType:"mouse",target:t.target})}},{key:"handleOutEvent",value:function(t){this.enableOutEvent&&"mouseout"===t.type&&this.callback({type:"pointerout",srcEvent:t,pointerType:"mouse",target:t.target})}},{key:"handleLeaveEvent",value:function(t){this.enableLeaveEvent&&"mouseleave"===t.type&&this.callback({type:"pointerleave",srcEvent:t,pointerType:"mouse",target:t.target})}},{key:"handleMoveEvent",value:function(t){if(this.enableMoveEvent)switch(t.type){case"mousedown":t.button>=0&&(this.pressed=!0);break;case"mousemove":0===t.which&&(this.pressed=!1),this.pressed||this.callback({type:"pointermove",srcEvent:t,pointerType:"mouse",target:t.target});break;case"mouseup":this.pressed=!1}}}]),t}(),T=m,C=function(){function t(e,i){var n=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object(r.a)(this,t),this.element=e,this.callback=i,this.options=Object.assign({enable:!0},a),this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=T.concat(a.events||[]),this.handleEvent=this.handleEvent.bind(this),e.tabIndex=1,e.style.outline="none",this.events.forEach(function(t){return e.addEventListener(t,n.handleEvent)})}return Object(a.a)(t,[{key:"destroy",value:function(){var t=this;this.events.forEach(function(e){return t.element.removeEventListener(e,t.handleEvent)})}},{key:"enableEventType",value:function(t,e){"keydown"===t&&(this.enableDownEvent=e),"keyup"===t&&(this.enableUpEvent=e)}},{key:"handleEvent",value:function(t){var e=t.target||t.srcElement;"INPUT"===e.tagName&&"text"===e.type||"TEXTAREA"===e.tagName||(this.enableDownEvent&&"keydown"===t.type&&this.callback({type:"keydown",srcEvent:t,key:t.key,target:t.target}),this.enableUpEvent&&"keyup"===t.type&&this.callback({type:"keyup",srcEvent:t,key:t.key,target:t.target}))}}]),t}(),E=function(){function t(e,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object(r.a)(this,t),this.element=e,this.callback=i,this.options=Object.assign({enable:!0},n),this.handleEvent=this.handleEvent.bind(this),e.addEventListener("contextmenu",this.handleEvent)}return Object(a.a)(t,[{key:"destroy",value:function(){this.element.removeEventListener("contextmenu",this.handleEvent)}},{key:"enableEventType",value:function(t,e){"contextmenu"===t&&(this.options.enable=e)}},{key:"handleEvent",value:function(t){this.options.enable&&this.callback({type:"contextmenu",center:{x:t.clientX,y:t.clientY},srcEvent:t,pointerType:"mouse",target:t.target})}}]),t}(),L=1,A=2,I=4,R={pointerdown:L,pointermove:A,pointerup:I,mousedown:L,mousemove:A,mouseup:I},F=1,N=2,z=3,D=0,V=1,U=2,B=1,Z=2,G=4;var X=function(){function t(e){Object(r.a)(this,t),this.eventManager=e,this.handlers=[],this.handlersByElement=new Map,this.handleEvent=this.handleEvent.bind(this)}return Object(a.a)(t,[{key:"isEmpty",value:function(){return 0===this.handlers.length}},{key:"add",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"root",n=this.handlers,r=this.handlersByElement;r.has(i)||r.set(i,[]);var a={type:t,handler:e,srcElement:i};n.push(a),r.get(i).push(a)}},{key:"remove",value:function(t,e){for(var i=this.handlers,n=this.handlersByElement,r=i.length-1;r>=0;r--){var a=i[r];if(a.type===t&&a.handler===e){i.splice(r,1);var o=n.get(a.srcElement);o.splice(o.indexOf(a),1),0===o.length&&n.delete(a.srcElement)}}}},{key:"handleEvent",value:function(t){if(!this.isEmpty()){for(var e=this._normalizeEvent(t),i=t.srcEvent.target;i&&i!==e.rootElement;){if(this._emit(e,i),e.handled)return;i=i.parentNode}this._emit(e,"root")}}},{key:"_emit",value:function(t,e){var i=this.handlersByElement.get(e);if(i)for(var n=!1,r=function(){t.handled=!0},a=function(){t.handled=!0,n=!0},o=0;o<i.length;o++){var s=i[o],c=s.type;if((0,s.handler)(Object.assign({},t,{type:c,stopPropagation:r,stopImmediatePropagation:a})),n)break}}},{key:"_normalizeEvent",value:function(t){var e=this.eventManager.element;return Object.assign({},t,function(t){var e=R[t.srcEvent.type];if(!e)return null;var i=t.srcEvent,n=i.buttons,r=i.button,a=i.which,o=!1,s=!1,c=!1;return e===I||e===A&&!Number.isFinite(n)?(o=a===F,s=a===N,c=a===z):e===A?(o=Boolean(n&B),s=Boolean(n&G),c=Boolean(n&Z)):e===L&&(o=r===D,s=r===V,c=r===U),{leftButton:o,middleButton:s,rightButton:c}}(t),function(t,e){var i=t.srcEvent;if(!t.center&&!Number.isFinite(i.clientX))return null;var n=t.center||{x:i.clientX,y:i.clientY},r=e.getBoundingClientRect(),a=r.width/e.offsetWidth,o=r.height/e.offsetHeight;return{center:n,offsetCenter:{x:(n.x-r.left-e.clientLeft)/a,y:(n.y-r.top-e.clientTop)/o}}}(t,e),{handled:!1,rootElement:e})}}]),t}(),Y={events:null,recognizers:null,recognizerOptions:{},Manager:d?d.Manager:function(t){var e={},i=function(){return e};return e.get=function(){return null},e.set=i,e.on=i,e.off=i,e.destroy=i,e.emit=i,e},touchAction:"none"},W=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(r.a)(this,t),this.options=Object.assign({},Y,i),this.events=new Map,this._onBasicInput=this._onBasicInput.bind(this),this._onOtherEvent=this._onOtherEvent.bind(this),this.setElement(e);var n=i.events;n&&this.on(n)}return Object(a.a)(t,[{key:"setElement",value:function(t){var e=this;if(this.element&&this.destroy(),this.element=t,t){var i=this.options,r=i.Manager;for(var a in this.manager=new r(t,{touchAction:i.touchAction,recognizers:i.recognizers||v}).on("hammer.input",this._onBasicInput),i.recognizers||Object.keys(f).forEach(function(t){var i=e.manager.get(t);i&&f[t].forEach(function(t){i.recognizeWith(t)})}),i.recognizerOptions){var o=this.manager.get(a);if(o){var s=i.recognizerOptions[a];delete s.enable,o.set(s)}}this.wheelInput=new x(t,this._onOtherEvent,{enable:!1}),this.moveInput=new M(t,this._onOtherEvent,{enable:!1}),this.keyInput=new C(t,this._onOtherEvent,{enable:!1}),this.contextmenuInput=new E(t,this._onOtherEvent,{enable:!1});var c=!0,u=!1,l=void 0;try{for(var h,p=this.events[Symbol.iterator]();!(c=(h=p.next()).done);c=!0){var d=Object(n.a)(h.value,2),g=d[0],y=d[1];y.isEmpty()||(this._toggleRecognizer(y.recognizerName,!0),this.manager.on(g,y.handleEvent))}}catch(m){u=!0,l=m}finally{try{c||null==p.return||p.return()}finally{if(u)throw l}}}}},{key:"destroy",value:function(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}},{key:"on",value:function(t,e,i){if("string"==typeof t)this._addEventHandler(t,e,i);else for(var n in i=e,t)this._addEventHandler(n,t[n],i)}},{key:"off",value:function(t,e){if("string"==typeof t)this._removeEventHandler(t,e);else for(var i in t)this._removeEventHandler(i,t[i])}},{key:"_toggleRecognizer",value:function(t,e){var i=this.manager;if(i){var n=i.get(t);if(n&&n.options.enable!==e){n.set({enable:e});var r=g[t];r&&!this.options.recognizers&&r.forEach(function(r){var a=i.get(r);e?(a.requireFailure(t),n.dropRequireFailure(r)):a.dropRequireFailure(t)})}this.wheelInput.enableEventType(t,e),this.moveInput.enableEventType(t,e),this.keyInput.enableEventType(t,e),this.contextmenuInput.enableEventType(t,e)}}},{key:"_addEventHandler",value:function(t,e,i){var n=this.manager,r=this.events,a=j[t]||t,o=r.get(a);o||(o=new X(this),r.set(a,o),o.recognizerName=_[a]||a,n&&n.on(a,o.handleEvent)),this._toggleRecognizer(o.recognizerName,!0),o.add(t,e,i)}},{key:"_removeEventHandler",value:function(t,e){var i=this.events,n=j[t]||t,r=i.get(n);if(r&&(r.remove(t,e),r.isEmpty())){var a=r.recognizerName,o=!1,s=!0,c=!1,u=void 0;try{for(var l,h=i.values()[Symbol.iterator]();!(s=(l=h.next()).done);s=!0){var p=l.value;if(p.recognizerName===a&&!p.isEmpty()){o=!0;break}}}catch(d){c=!0,u=d}finally{try{s||null==h.return||h.return()}finally{if(c)throw u}}o||this._toggleRecognizer(a,!1)}}},{key:"_onBasicInput",value:function(t){var e=t.srcEvent,i=y[e.type];i&&this.manager.emit(i,t)}},{key:"_onOtherEvent",value:function(t){this.manager.emit(t.type,t)}}]),t}();i.d(e,"a",function(){return W})},361:function(t,e,i){"use strict";var n=i(203),r=i(204),a=i(206),o=i(205),s=i(207),c=i(217),u=i(216),l=i(290),h=i(317),p=i(273),d=Object(l.a)(),v=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=e.width,r=e.height,a=e.viewMatrix,o=void 0===a?d:a,s=e.projectionMatrix,c=void 0===s?d:s;Object(n.a)(this,t),this.width=i||1,this.height=r||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=o,this.projectionMatrix=c;var u=Object(l.a)();p.g(u,u,this.projectionMatrix),p.g(u,u,this.viewMatrix),this.viewProjectionMatrix=u;var h=Object(l.a)();p.n(h,h,[this.width/2,-this.height/2,1]),p.o(h,h,[1,-1,0]),p.g(h,h,this.viewProjectionMatrix);var v=p.e(Object(l.a)(),h);if(!v)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=h,this.pixelUnprojectionMatrix=v,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return Object(r.a)(t,[{key:"equals",value:function(e){return e instanceof t&&(e.width===this.width&&e.height===this.height&&p.b(e.projectionMatrix,this.projectionMatrix)&&p.b(e.viewMatrix,this.viewMatrix))}},{key:"project",value:function(t){var e=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).topLeft,i=void 0===e||e,n=this.projectPosition(t),r=Object(h.k)(n,this.pixelProjectionMatrix),a=Object(u.a)(r,2),o=a[0],s=a[1],c=i?s:this.height-s;return 2===t.length?[o,c]:[o,c,r[2]]}},{key:"unproject",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=e.topLeft,n=void 0===i||i,r=e.targetZ,a=Object(u.a)(t,3),o=a[0],s=a[1],c=a[2],l=n?s:this.height-s,p=r&&r*this.pixelsPerMeter,d=Object(h.h)([o,l,c],this.pixelUnprojectionMatrix,p),v=this.unprojectPosition(d),f=Object(u.a)(v,3),g=f[0],y=f[1],m=f[2];return Number.isFinite(c)?[g,y,m]:Number.isFinite(r)?[g,y,r]:[g,y]}},{key:"projectPosition",value:function(t){var e=this.projectFlat(t),i=Object(u.a)(e,2);return[i[0],i[1],(t[2]||0)*this.pixelsPerMeter]}},{key:"unprojectPosition",value:function(t){var e=this.unprojectFlat(t),i=Object(u.a)(e,2);return[i[0],i[1],(t[2]||0)/this.pixelsPerMeter]}},{key:"projectFlat",value:function(t){arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale;return t}},{key:"unprojectFlat",value:function(t){arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale;return t}}]),t}(),f=i(400),g=i(274);i.d(e,"a",function(){return y});var y=function(t){function e(){var t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=i.width,s=i.height,u=i.latitude,l=void 0===u?0:u,p=i.longitude,d=void 0===p?0:p,v=i.zoom,f=void 0===v?0:v,g=i.pitch,y=void 0===g?0:g,m=i.bearing,b=void 0===m?0:m,w=i.altitude,_=void 0===w?1.5:w,j=i.nearZMultiplier,k=i.farZMultiplier;Object(n.a)(this,e),r=r||1,s=s||1;var P=Object(h.l)(f);_=Math.max(.75,_);var O=Object(h.g)([d,l],P);O[2]=0;var x=Object(h.d)({width:r,height:s,pitch:y,bearing:b,altitude:_,nearZMultiplier:j||1/s,farZMultiplier:k||1.01}),S=Object(h.f)({height:s,center:O,pitch:y,bearing:b,altitude:_,flipY:!0});return(t=Object(a.a)(this,Object(o.a)(e).call(this,{width:r,height:s,viewMatrix:S,projectionMatrix:x}))).latitude=l,t.longitude=d,t.zoom=f,t.pitch=y,t.bearing=b,t.altitude=_,t.scale=P,t.center=O,t.pixelsPerMeter=Object(h.b)(Object(c.a)(Object(c.a)(t))).pixelsPerMeter[2],Object.freeze(Object(c.a)(Object(c.a)(t))),t}return Object(s.a)(e,t),Object(r.a)(e,[{key:"projectFlat",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale;return Object(h.g)(t,e)}},{key:"unprojectFlat",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale;return Object(h.j)(t,e)}},{key:"getMapCenterByLngLatPosition",value:function(t){var e=t.lngLat,i=t.pos,n=Object(h.h)(i,this.pixelUnprojectionMatrix),r=Object(h.g)(e,this.scale),a=g.a([],r,g.e([],n)),o=g.a([],this.center,a);return Object(h.j)(o,this.scale)}},{key:"getLocationAtPoint",value:function(t){var e=t.lngLat,i=t.pos;return this.getMapCenterByLngLatPosition({lngLat:e,pos:i})}},{key:"fitBounds",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.width,r=this.height,a=Object(f.a)(Object.assign({width:n,height:r,bounds:t},i));return new e({width:n,height:r,longitude:a.longitude,latitude:a.latitude,zoom:a.zoom})}}]),e}(v)},399:function(t,e,i){"use strict";(function(t,n){i.d(e,"a",function(){return a});var r=i(226),a=("object"!==(void 0===t?"undefined":Object(r.a)(t))||"[object process]"!==String(t)||t.browser,"undefined"!=typeof window&&window,void 0!==n?n:window);"undefined"!=typeof document&&document}).call(this,i(126),i(79))},400:function(t,e,i){"use strict";i.d(e,"a",function(){return o});var n=i(216),r=i(361),a=i(346);function o(t){var e=t.width,i=t.height,o=t.bounds,s=t.padding,c=void 0===s?0:s,u=t.offset,l=void 0===u?[0,0]:u,h=Object(n.a)(o,2),p=Object(n.a)(h[0],2),d=p[0],v=p[1],f=Object(n.a)(h[1],2),g=f[0],y=f[1];if(Number.isFinite(c)){c={top:c,bottom:c,left:c,right:c}}else Object(a.a)(Number.isFinite(c.top)&&Number.isFinite(c.bottom)&&Number.isFinite(c.left)&&Number.isFinite(c.right));var m=new r.a({width:e,height:i,longitude:0,latitude:0,zoom:0}),b=m.project([d,y]),w=m.project([g,v]),_=[Math.abs(w[0]-b[0]),Math.abs(w[1]-b[1])],j=[e-c.left-c.right-2*Math.abs(l[0]),i-c.top-c.bottom-2*Math.abs(l[1])];Object(a.a)(j[0]>0&&j[1]>0);var k=j[0]/_[0],P=j[1]/_[1],O=(c.right-c.left)/2/k,x=(c.bottom-c.top)/2/P,S=[(w[0]+b[0])/2+O,(w[1]+b[1])/2+x],M=m.unproject(S),T=m.zoom+Math.log2(Math.abs(Math.min(k,P)));return{longitude:M[0],latitude:M[1],zoom:T}}},401:function(t,e,i){var n;!function(r,a,o,s){"use strict";var c,u=["","webkit","Moz","MS","ms","o"],l=a.createElement("div"),h="function",p=Math.round,d=Math.abs,v=Date.now;function f(t,e,i){return setTimeout(j(t,i),e)}function g(t,e,i){return!!Array.isArray(t)&&(y(t,i[e],i),!0)}function y(t,e,i){var n;if(t)if(t.forEach)t.forEach(e,i);else if(t.length!==s)for(n=0;n<t.length;)e.call(i,t[n],n,t),n++;else for(n in t)t.hasOwnProperty(n)&&e.call(i,t[n],n,t)}function m(t,e,i){var n="DEPRECATED METHOD: "+e+"\n"+i+" AT \n";return function(){var e=new Error("get-stack-trace"),i=e&&e.stack?e.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",a=r.console&&(r.console.warn||r.console.log);return a&&a.call(r.console,n,i),t.apply(this,arguments)}}c="function"!=typeof Object.assign?function(t){if(t===s||null===t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),i=1;i<arguments.length;i++){var n=arguments[i];if(n!==s&&null!==n)for(var r in n)n.hasOwnProperty(r)&&(e[r]=n[r])}return e}:Object.assign;var b=m(function(t,e,i){for(var n=Object.keys(e),r=0;r<n.length;)(!i||i&&t[n[r]]===s)&&(t[n[r]]=e[n[r]]),r++;return t},"extend","Use `assign`."),w=m(function(t,e){return b(t,e,!0)},"merge","Use `assign`.");function _(t,e,i){var n,r=e.prototype;(n=t.prototype=Object.create(r)).constructor=t,n._super=r,i&&c(n,i)}function j(t,e){return function(){return t.apply(e,arguments)}}function k(t,e){return typeof t==h?t.apply(e&&e[0]||s,e):t}function P(t,e){return t===s?e:t}function O(t,e,i){y(T(e),function(e){t.addEventListener(e,i,!1)})}function x(t,e,i){y(T(e),function(e){t.removeEventListener(e,i,!1)})}function S(t,e){for(;t;){if(t==e)return!0;t=t.parentNode}return!1}function M(t,e){return t.indexOf(e)>-1}function T(t){return t.trim().split(/\s+/g)}function C(t,e,i){if(t.indexOf&&!i)return t.indexOf(e);for(var n=0;n<t.length;){if(i&&t[n][i]==e||!i&&t[n]===e)return n;n++}return-1}function E(t){return Array.prototype.slice.call(t,0)}function L(t,e,i){for(var n=[],r=[],a=0;a<t.length;){var o=e?t[a][e]:t[a];C(r,o)<0&&n.push(t[a]),r[a]=o,a++}return i&&(n=e?n.sort(function(t,i){return t[e]>i[e]}):n.sort()),n}function A(t,e){for(var i,n,r=e[0].toUpperCase()+e.slice(1),a=0;a<u.length;){if((n=(i=u[a])?i+r:e)in t)return n;a++}return s}var I=1;function R(t){var e=t.ownerDocument||t;return e.defaultView||e.parentWindow||r}var F="ontouchstart"in r,N=A(r,"PointerEvent")!==s,z=F&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),D=25,V=1,U=2,B=4,Z=8,G=1,X=2,Y=4,W=8,q=16,H=X|Y,K=W|q,J=H|K,$=["x","y"],Q=["clientX","clientY"];function tt(t,e){var i=this;this.manager=t,this.callback=e,this.element=t.element,this.target=t.options.inputTarget,this.domHandler=function(e){k(t.options.enable,[t])&&i.handler(e)},this.init()}function et(t,e,i){var n=i.pointers.length,r=i.changedPointers.length,a=e&V&&n-r==0,o=e&(B|Z)&&n-r==0;i.isFirst=!!a,i.isFinal=!!o,a&&(t.session={}),i.eventType=e,function(t,e){var i=t.session,n=e.pointers,r=n.length;i.firstInput||(i.firstInput=it(e));r>1&&!i.firstMultiple?i.firstMultiple=it(e):1===r&&(i.firstMultiple=!1);var a=i.firstInput,o=i.firstMultiple,c=o?o.center:a.center,u=e.center=nt(n);e.timeStamp=v(),e.deltaTime=e.timeStamp-a.timeStamp,e.angle=st(c,u),e.distance=ot(c,u),function(t,e){var i=e.center,n=t.offsetDelta||{},r=t.prevDelta||{},a=t.prevInput||{};e.eventType!==V&&a.eventType!==B||(r=t.prevDelta={x:a.deltaX||0,y:a.deltaY||0},n=t.offsetDelta={x:i.x,y:i.y});e.deltaX=r.x+(i.x-n.x),e.deltaY=r.y+(i.y-n.y)}(i,e),e.offsetDirection=at(e.deltaX,e.deltaY);var l=rt(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=l.x,e.overallVelocityY=l.y,e.overallVelocity=d(l.x)>d(l.y)?l.x:l.y,e.scale=o?(h=o.pointers,p=n,ot(p[0],p[1],Q)/ot(h[0],h[1],Q)):1,e.rotation=o?function(t,e){return st(e[1],e[0],Q)+st(t[1],t[0],Q)}(o.pointers,n):0,e.maxPointers=i.prevInput?e.pointers.length>i.prevInput.maxPointers?e.pointers.length:i.prevInput.maxPointers:e.pointers.length,function(t,e){var i,n,r,a,o=t.lastInterval||e,c=e.timeStamp-o.timeStamp;if(e.eventType!=Z&&(c>D||o.velocity===s)){var u=e.deltaX-o.deltaX,l=e.deltaY-o.deltaY,h=rt(c,u,l);n=h.x,r=h.y,i=d(h.x)>d(h.y)?h.x:h.y,a=at(u,l),t.lastInterval=e}else i=o.velocity,n=o.velocityX,r=o.velocityY,a=o.direction;e.velocity=i,e.velocityX=n,e.velocityY=r,e.direction=a}(i,e);var h,p;var f=t.element;S(e.srcEvent.target,f)&&(f=e.srcEvent.target);e.target=f}(t,i),t.emit("hammer.input",i),t.recognize(i),t.session.prevInput=i}function it(t){for(var e=[],i=0;i<t.pointers.length;)e[i]={clientX:p(t.pointers[i].clientX),clientY:p(t.pointers[i].clientY)},i++;return{timeStamp:v(),pointers:e,center:nt(e),deltaX:t.deltaX,deltaY:t.deltaY}}function nt(t){var e=t.length;if(1===e)return{x:p(t[0].clientX),y:p(t[0].clientY)};for(var i=0,n=0,r=0;r<e;)i+=t[r].clientX,n+=t[r].clientY,r++;return{x:p(i/e),y:p(n/e)}}function rt(t,e,i){return{x:e/t||0,y:i/t||0}}function at(t,e){return t===e?G:d(t)>=d(e)?t<0?X:Y:e<0?W:q}function ot(t,e,i){i||(i=$);var n=e[i[0]]-t[i[0]],r=e[i[1]]-t[i[1]];return Math.sqrt(n*n+r*r)}function st(t,e,i){i||(i=$);var n=e[i[0]]-t[i[0]],r=e[i[1]]-t[i[1]];return 180*Math.atan2(r,n)/Math.PI}tt.prototype={handler:function(){},init:function(){this.evEl&&O(this.element,this.evEl,this.domHandler),this.evTarget&&O(this.target,this.evTarget,this.domHandler),this.evWin&&O(R(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&x(this.element,this.evEl,this.domHandler),this.evTarget&&x(this.target,this.evTarget,this.domHandler),this.evWin&&x(R(this.element),this.evWin,this.domHandler)}};var ct={mousedown:V,mousemove:U,mouseup:B},ut="mousedown",lt="mousemove mouseup";function ht(){this.evEl=ut,this.evWin=lt,this.pressed=!1,tt.apply(this,arguments)}_(ht,tt,{handler:function(t){var e=ct[t.type];e&V&&0===t.button&&(this.pressed=!0),e&U&&1!==t.which&&(e=B),this.pressed&&(e&B&&(this.pressed=!1),this.callback(this.manager,e,{pointers:[t],changedPointers:[t],pointerType:"mouse",srcEvent:t}))}});var pt={pointerdown:V,pointermove:U,pointerup:B,pointercancel:Z,pointerout:Z},dt={2:"touch",3:"pen",4:"mouse",5:"kinect"},vt="pointerdown",ft="pointermove pointerup pointercancel";function gt(){this.evEl=vt,this.evWin=ft,tt.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}r.MSPointerEvent&&!r.PointerEvent&&(vt="MSPointerDown",ft="MSPointerMove MSPointerUp MSPointerCancel"),_(gt,tt,{handler:function(t){var e=this.store,i=!1,n=t.type.toLowerCase().replace("ms",""),r=pt[n],a=dt[t.pointerType]||t.pointerType,o="touch"==a,s=C(e,t.pointerId,"pointerId");r&V&&(0===t.button||o)?s<0&&(e.push(t),s=e.length-1):r&(B|Z)&&(i=!0),s<0||(e[s]=t,this.callback(this.manager,r,{pointers:e,changedPointers:[t],pointerType:a,srcEvent:t}),i&&e.splice(s,1))}});var yt={touchstart:V,touchmove:U,touchend:B,touchcancel:Z},mt="touchstart",bt="touchstart touchmove touchend touchcancel";function wt(){this.evTarget=mt,this.evWin=bt,this.started=!1,tt.apply(this,arguments)}_(wt,tt,{handler:function(t){var e=yt[t.type];if(e===V&&(this.started=!0),this.started){var i=function(t,e){var i=E(t.touches),n=E(t.changedTouches);e&(B|Z)&&(i=L(i.concat(n),"identifier",!0));return[i,n]}.call(this,t,e);e&(B|Z)&&i[0].length-i[1].length==0&&(this.started=!1),this.callback(this.manager,e,{pointers:i[0],changedPointers:i[1],pointerType:"touch",srcEvent:t})}}});var _t={touchstart:V,touchmove:U,touchend:B,touchcancel:Z},jt="touchstart touchmove touchend touchcancel";function kt(){this.evTarget=jt,this.targetIds={},tt.apply(this,arguments)}_(kt,tt,{handler:function(t){var e=_t[t.type],i=function(t,e){var i=E(t.touches),n=this.targetIds;if(e&(V|U)&&1===i.length)return n[i[0].identifier]=!0,[i,i];var r,a,o=E(t.changedTouches),s=[],c=this.target;if(a=i.filter(function(t){return S(t.target,c)}),e===V)for(r=0;r<a.length;)n[a[r].identifier]=!0,r++;r=0;for(;r<o.length;)n[o[r].identifier]&&s.push(o[r]),e&(B|Z)&&delete n[o[r].identifier],r++;if(!s.length)return;return[L(a.concat(s),"identifier",!0),s]}.call(this,t,e);i&&this.callback(this.manager,e,{pointers:i[0],changedPointers:i[1],pointerType:"touch",srcEvent:t})}});var Pt=2500,Ot=25;function xt(){tt.apply(this,arguments);var t=j(this.handler,this);this.touch=new kt(this.manager,t),this.mouse=new ht(this.manager,t),this.primaryTouch=null,this.lastTouches=[]}function St(t){var e=t.changedPointers[0];if(e.identifier===this.primaryTouch){var i={x:e.clientX,y:e.clientY};this.lastTouches.push(i);var n=this.lastTouches;setTimeout(function(){var t=n.indexOf(i);t>-1&&n.splice(t,1)},Pt)}}_(xt,tt,{handler:function(t,e,i){var n="touch"==i.pointerType,r="mouse"==i.pointerType;if(!(r&&i.sourceCapabilities&&i.sourceCapabilities.firesTouchEvents)){if(n)(function(t,e){t&V?(this.primaryTouch=e.changedPointers[0].identifier,St.call(this,e)):t&(B|Z)&&St.call(this,e)}).call(this,e,i);else if(r&&function(t){for(var e=t.srcEvent.clientX,i=t.srcEvent.clientY,n=0;n<this.lastTouches.length;n++){var r=this.lastTouches[n],a=Math.abs(e-r.x),o=Math.abs(i-r.y);if(a<=Ot&&o<=Ot)return!0}return!1}.call(this,i))return;this.callback(t,e,i)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var Mt=A(l.style,"touchAction"),Tt=Mt!==s,Ct="auto",Et="manipulation",Lt="none",At="pan-x",It="pan-y",Rt=function(){if(!Tt)return!1;var t={},e=r.CSS&&r.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(i){t[i]=!e||r.CSS.supports("touch-action",i)}),t}();function Ft(t,e){this.manager=t,this.set(e)}Ft.prototype={set:function(t){"compute"==t&&(t=this.compute()),Tt&&this.manager.element.style&&Rt[t]&&(this.manager.element.style[Mt]=t),this.actions=t.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var t=[];return y(this.manager.recognizers,function(e){k(e.options.enable,[e])&&(t=t.concat(e.getTouchAction()))}),function(t){if(M(t,Lt))return Lt;var e=M(t,At),i=M(t,It);if(e&&i)return Lt;if(e||i)return e?At:It;if(M(t,Et))return Et;return Ct}(t.join(" "))},preventDefaults:function(t){var e=t.srcEvent,i=t.offsetDirection;if(this.manager.session.prevented)e.preventDefault();else{var n=this.actions,r=M(n,Lt)&&!Rt[Lt],a=M(n,It)&&!Rt[It],o=M(n,At)&&!Rt[At];if(r){var s=1===t.pointers.length,c=t.distance<2,u=t.deltaTime<250;if(s&&c&&u)return}if(!o||!a)return r||a&&i&H||o&&i&K?this.preventSrc(e):void 0}},preventSrc:function(t){this.manager.session.prevented=!0,t.preventDefault()}};var Nt=1,zt=2,Dt=4,Vt=8,Ut=Vt,Bt=16;function Zt(t){this.options=c({},this.defaults,t||{}),this.id=I++,this.manager=null,this.options.enable=P(this.options.enable,!0),this.state=Nt,this.simultaneous={},this.requireFail=[]}function Gt(t){return t&Bt?"cancel":t&Vt?"end":t&Dt?"move":t&zt?"start":""}function Xt(t){return t==q?"down":t==W?"up":t==X?"left":t==Y?"right":""}function Yt(t,e){var i=e.manager;return i?i.get(t):t}function Wt(){Zt.apply(this,arguments)}function qt(){Wt.apply(this,arguments),this.pX=null,this.pY=null}function Ht(){Wt.apply(this,arguments)}function Kt(){Zt.apply(this,arguments),this._timer=null,this._input=null}function Jt(){Wt.apply(this,arguments)}function $t(){Wt.apply(this,arguments)}function Qt(){Zt.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function te(t,e){return(e=e||{}).recognizers=P(e.recognizers,te.defaults.preset),new ee(t,e)}Zt.prototype={defaults:{},set:function(t){return c(this.options,t),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(t){if(g(t,"recognizeWith",this))return this;var e=this.simultaneous;return e[(t=Yt(t,this)).id]||(e[t.id]=t,t.recognizeWith(this)),this},dropRecognizeWith:function(t){return g(t,"dropRecognizeWith",this)?this:(t=Yt(t,this),delete this.simultaneous[t.id],this)},requireFailure:function(t){if(g(t,"requireFailure",this))return this;var e=this.requireFail;return-1===C(e,t=Yt(t,this))&&(e.push(t),t.requireFailure(this)),this},dropRequireFailure:function(t){if(g(t,"dropRequireFailure",this))return this;t=Yt(t,this);var e=C(this.requireFail,t);return e>-1&&this.requireFail.splice(e,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(t){return!!this.simultaneous[t.id]},emit:function(t){var e=this,i=this.state;function n(i){e.manager.emit(i,t)}i<Vt&&n(e.options.event+Gt(i)),n(e.options.event),t.additionalEvent&&n(t.additionalEvent),i>=Vt&&n(e.options.event+Gt(i))},tryEmit:function(t){if(this.canEmit())return this.emit(t);this.state=32},canEmit:function(){for(var t=0;t<this.requireFail.length;){if(!(this.requireFail[t].state&(32|Nt)))return!1;t++}return!0},recognize:function(t){var e=c({},t);if(!k(this.options.enable,[this,e]))return this.reset(),void(this.state=32);this.state&(Ut|Bt|32)&&(this.state=Nt),this.state=this.process(e),this.state&(zt|Dt|Vt|Bt)&&this.tryEmit(e)},process:function(t){},getTouchAction:function(){},reset:function(){}},_(Wt,Zt,{defaults:{pointers:1},attrTest:function(t){var e=this.options.pointers;return 0===e||t.pointers.length===e},process:function(t){var e=this.state,i=t.eventType,n=e&(zt|Dt),r=this.attrTest(t);return n&&(i&Z||!r)?e|Bt:n||r?i&B?e|Vt:e&zt?e|Dt:zt:32}}),_(qt,Wt,{defaults:{event:"pan",threshold:10,pointers:1,direction:J},getTouchAction:function(){var t=this.options.direction,e=[];return t&H&&e.push(It),t&K&&e.push(At),e},directionTest:function(t){var e=this.options,i=!0,n=t.distance,r=t.direction,a=t.deltaX,o=t.deltaY;return r&e.direction||(e.direction&H?(r=0===a?G:a<0?X:Y,i=a!=this.pX,n=Math.abs(t.deltaX)):(r=0===o?G:o<0?W:q,i=o!=this.pY,n=Math.abs(t.deltaY))),t.direction=r,i&&n>e.threshold&&r&e.direction},attrTest:function(t){return Wt.prototype.attrTest.call(this,t)&&(this.state&zt||!(this.state&zt)&&this.directionTest(t))},emit:function(t){this.pX=t.deltaX,this.pY=t.deltaY;var e=Xt(t.direction);e&&(t.additionalEvent=this.options.event+e),this._super.emit.call(this,t)}}),_(Ht,Wt,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Lt]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.scale-1)>this.options.threshold||this.state&zt)},emit:function(t){if(1!==t.scale){var e=t.scale<1?"in":"out";t.additionalEvent=this.options.event+e}this._super.emit.call(this,t)}}),_(Kt,Zt,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Ct]},process:function(t){var e=this.options,i=t.pointers.length===e.pointers,n=t.distance<e.threshold,r=t.deltaTime>e.time;if(this._input=t,!n||!i||t.eventType&(B|Z)&&!r)this.reset();else if(t.eventType&V)this.reset(),this._timer=f(function(){this.state=Ut,this.tryEmit()},e.time,this);else if(t.eventType&B)return Ut;return 32},reset:function(){clearTimeout(this._timer)},emit:function(t){this.state===Ut&&(t&&t.eventType&B?this.manager.emit(this.options.event+"up",t):(this._input.timeStamp=v(),this.manager.emit(this.options.event,this._input)))}}),_(Jt,Wt,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Lt]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.rotation)>this.options.threshold||this.state&zt)}}),_($t,Wt,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:H|K,pointers:1},getTouchAction:function(){return qt.prototype.getTouchAction.call(this)},attrTest:function(t){var e,i=this.options.direction;return i&(H|K)?e=t.overallVelocity:i&H?e=t.overallVelocityX:i&K&&(e=t.overallVelocityY),this._super.attrTest.call(this,t)&&i&t.offsetDirection&&t.distance>this.options.threshold&&t.maxPointers==this.options.pointers&&d(e)>this.options.velocity&&t.eventType&B},emit:function(t){var e=Xt(t.offsetDirection);e&&this.manager.emit(this.options.event+e,t),this.manager.emit(this.options.event,t)}}),_(Qt,Zt,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Et]},process:function(t){var e=this.options,i=t.pointers.length===e.pointers,n=t.distance<e.threshold,r=t.deltaTime<e.time;if(this.reset(),t.eventType&V&&0===this.count)return this.failTimeout();if(n&&r&&i){if(t.eventType!=B)return this.failTimeout();var a=!this.pTime||t.timeStamp-this.pTime<e.interval,o=!this.pCenter||ot(this.pCenter,t.center)<e.posThreshold;if(this.pTime=t.timeStamp,this.pCenter=t.center,o&&a?this.count+=1:this.count=1,this._input=t,0===this.count%e.taps)return this.hasRequireFailures()?(this._timer=f(function(){this.state=Ut,this.tryEmit()},e.interval,this),zt):Ut}return 32},failTimeout:function(){return this._timer=f(function(){this.state=32},this.options.interval,this),32},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==Ut&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),te.VERSION="2.0.7",te.defaults={domEvents:!1,touchAction:"compute",enable:!0,inputTarget:null,inputClass:null,preset:[[Jt,{enable:!1}],[Ht,{enable:!1},["rotate"]],[$t,{direction:H}],[qt,{direction:H},["swipe"]],[Qt],[Qt,{event:"doubletap",taps:2},["tap"]],[Kt]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};function ee(t,e){var i;this.options=c({},te.defaults,e||{}),this.options.inputTarget=this.options.inputTarget||t,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=t,this.input=new((i=this).options.inputClass||(N?gt:z?kt:F?xt:ht))(i,et),this.touchAction=new Ft(this,this.options.touchAction),ie(this,!0),y(this.options.recognizers,function(t){var e=this.add(new t[0](t[1]));t[2]&&e.recognizeWith(t[2]),t[3]&&e.requireFailure(t[3])},this)}function ie(t,e){var i,n=t.element;n.style&&(y(t.options.cssProps,function(r,a){i=A(n.style,a),e?(t.oldCssProps[i]=n.style[i],n.style[i]=r):n.style[i]=t.oldCssProps[i]||""}),e||(t.oldCssProps={}))}ee.prototype={set:function(t){return c(this.options,t),t.touchAction&&this.touchAction.update(),t.inputTarget&&(this.input.destroy(),this.input.target=t.inputTarget,this.input.init()),this},stop:function(t){this.session.stopped=t?2:1},recognize:function(t){var e=this.session;if(!e.stopped){var i;this.touchAction.preventDefaults(t);var n=this.recognizers,r=e.curRecognizer;(!r||r&&r.state&Ut)&&(r=e.curRecognizer=null);for(var a=0;a<n.length;)i=n[a],2===e.stopped||r&&i!=r&&!i.canRecognizeWith(r)?i.reset():i.recognize(t),!r&&i.state&(zt|Dt|Vt)&&(r=e.curRecognizer=i),a++}},get:function(t){if(t instanceof Zt)return t;for(var e=this.recognizers,i=0;i<e.length;i++)if(e[i].options.event==t)return e[i];return null},add:function(t){if(g(t,"add",this))return this;var e=this.get(t.options.event);return e&&this.remove(e),this.recognizers.push(t),t.manager=this,this.touchAction.update(),t},remove:function(t){if(g(t,"remove",this))return this;if(t=this.get(t)){var e=this.recognizers,i=C(e,t);-1!==i&&(e.splice(i,1),this.touchAction.update())}return this},on:function(t,e){if(t!==s&&e!==s){var i=this.handlers;return y(T(t),function(t){i[t]=i[t]||[],i[t].push(e)}),this}},off:function(t,e){if(t!==s){var i=this.handlers;return y(T(t),function(t){e?i[t]&&i[t].splice(C(i[t],e),1):delete i[t]}),this}},emit:function(t,e){this.options.domEvents&&function(t,e){var i=a.createEvent("Event");i.initEvent(t,!0,!0),i.gesture=e,e.target.dispatchEvent(i)}(t,e);var i=this.handlers[t]&&this.handlers[t].slice();if(i&&i.length){e.type=t,e.preventDefault=function(){e.srcEvent.preventDefault()};for(var n=0;n<i.length;)i[n](e),n++}},destroy:function(){this.element&&ie(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},c(te,{INPUT_START:V,INPUT_MOVE:U,INPUT_END:B,INPUT_CANCEL:Z,STATE_POSSIBLE:Nt,STATE_BEGAN:zt,STATE_CHANGED:Dt,STATE_ENDED:Vt,STATE_RECOGNIZED:Ut,STATE_CANCELLED:Bt,STATE_FAILED:32,DIRECTION_NONE:G,DIRECTION_LEFT:X,DIRECTION_RIGHT:Y,DIRECTION_UP:W,DIRECTION_DOWN:q,DIRECTION_HORIZONTAL:H,DIRECTION_VERTICAL:K,DIRECTION_ALL:J,Manager:ee,Input:tt,TouchAction:Ft,TouchInput:kt,MouseInput:ht,PointerEventInput:gt,TouchMouseInput:xt,SingleTouchInput:wt,Recognizer:Zt,AttrRecognizer:Wt,Tap:Qt,Pan:qt,Swipe:$t,Pinch:Ht,Rotate:Jt,Press:Kt,on:O,off:x,each:y,merge:w,extend:b,assign:c,inherit:_,bindFn:j,prefixed:A}),(void 0!==r?r:"undefined"!=typeof self?self:{}).Hammer=te,(n=function(){return te}.call(e,i,e,t))===s||(t.exports=n)}(window,document)},402:function(t,e,i){"use strict";(function(t){i.d(e,"b",function(){return n}),i.d(e,"c",function(){return r}),i.d(e,"a",function(){return a});var n="undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent.toLowerCase():"",r="undefined"!=typeof window?window:t,a=(void 0!==t||window,"undefined"!=typeof document&&document,!1);try{var o={get passive(){a=!0}};r.addEventListener("test",o,o),r.removeEventListener("test",o,o)}catch(s){}}).call(this,i(79))},403:function(t,e){t.exports="\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff"},437:function(t,e,i){"use strict";i.d(e,"a",function(){return s});var n=i(361),r=i(290),a=85.05113,o=-85.05113;function s(t){var e=t.width,i=t.height,s=t.longitude,c=t.latitude,u=t.zoom,l=t.pitch,h=void 0===l?0:l,p=t.bearing,d=void 0===p?0:p;(s<-180||s>180)&&(s=Object(r.c)(s+180,360)-180),(d<-180||d>180)&&(d=Object(r.c)(d+180,360)-180);var v=new n.a({width:e,height:i,longitude:s,latitude:c,zoom:u}),f=v.project([s,a])[1],g=v.project([s,o])[1],y=0;return g-f<i&&(u+=Math.log2(i/(g-f)),f=(v=new n.a({width:e,height:i,longitude:s,latitude:c,zoom:u})).project([s,a])[1],g=v.project([s,o])[1]),f>0?y=f:g<i&&(y=g-i),y&&(c=v.unproject([e/2,i/2+y])[1]),{width:e,height:i,longitude:s,latitude:c,zoom:u,pitch:h,bearing:d}}},438:function(t,e,i){"use strict";i.d(e,"a",function(){return c});var n=i(290),r=i(317),a=i(274),o=.01,s=["longitude","latitude","zoom"];function c(t,e,i){var c={},u=t.zoom,l=[t.longitude,t.latitude],h=Object(r.l)(u),p=e.zoom,d=[e.longitude,e.latitude],v=Object(r.l)(p-u),f=Object(r.g)(l,h),g=Object(r.g)(d,h),y=a.g([],g,f),m=Math.max(t.width,t.height),b=m/v,w=a.c(y);if(Math.abs(w)<o){for(var _=0;_<s.length;_++){var j=s[_],k=t[j],P=e[j];c[j]=Object(n.b)(k,P,i)}return c}var O=1.414*1.414,x=(b*b-m*m+O*O*w*w)/(2*m*O*w),S=(b*b-m*m-O*O*w*w)/(2*b*O*w),M=Math.log(Math.sqrt(x*x+1)-x),T=i*((Math.log(Math.sqrt(S*S+1)-S)-M)/1.414),C=Math.cosh(M)/Math.cosh(M+1.414*T),E=m*((Math.cosh(M)*Math.tanh(M+1.414*T)-Math.sinh(M))/O)/w,L=1/C,A=u+Object(r.i)(L),I=a.f([],y,E);a.a(I,I,f),a.f(I,I,L);var R=Object(r.j)(I,Object(r.l)(A));return c.longitude=R[0],c.latitude=R[1],c.zoom=A,c}},440:function(t,e,i){"use strict";var n=i(203),r=i(204),a=i(206),o=i(205),s=i(207),c=i(217),u=i(0),l=i.n(u),h=i(3),p=i.n(h),d=i(248),v=i(249);function f(t,e){for(;t;){if(t===e)return!0;t=Object.getPrototypeOf(t)}return!1}function g(t){return t?"function"==typeof t?Object(u.createElement)(d.g,{},t):Array.isArray(t)?t.map(g):(f(t.type,d.g),t):t}function y(t){var e=t.children,i=t.layers,n=t.views,r=[],a=[],o={};return l.a.Children.forEach(g(e),function(t){if(t){var e=t.type;if(f(e,d.d)){var i=function(t,e){var i={},n=t.defaultProps||{};for(var r in e)n[r]!==e[r]&&(i[r]=e[r]);return new t(i)}(e,t.props);a.push(i)}else r.push(t);if(e!==d.g&&f(e,d.g)&&t.props.id){var n=new e(t.props);o[n.id]=n}}}),Object.keys(o).length>0&&(Array.isArray(n)?n.forEach(function(t){o[t.id]=t}):n&&(o[n.id]=n),n=Object.values(o)),{layers:i=a.length>0?[].concat(a,Object(v.a)(i)):i,children:r,views:n}}function m(t){var e=t.children,i=(t.viewports,t.deck),n=t.ContextProvider,r=(i||{}).viewManager;if(!r||!r.views.length)return[];var a=r.views[0].id;return e.map(function(t,e){t.props.viewportId&&d.j.removed("viewportId","<View>")(),t.props.viewId&&d.j.removed("viewId","<View>")();var o=a,s=t;f(t.type,d.g)&&(o=t.props.id||a,s=t.props.children);var c=s&&s.props&&s.props.style,l=r.getViewport(o),h=r.getViewState(o);if(!l)return null;var p=l.x,v=l.y,g=l.width,y=l.height;s=function t(e,i){return e?"function"==typeof e?e(i):Array.isArray(e)?e.map(function(e){return t(e,i)}):Object(u.cloneElement)(e,i):e}(s,{x:p,y:v,width:g,height:y,viewport:l,viewState:h});var m={position:"absolute",zIndex:c&&c.zIndex,pointerEvents:"none",left:p,top:v,width:g,height:y},b="view-child-".concat(o,"-").concat(e);if(n){var w={viewport:l,container:i.canvas.offsetParent,eventManager:i.eventManager,onViewStateChange:i._onViewStateChange};s=Object(u.createElement)(n,{value:w},s)}return Object(u.createElement)("div",{key:b,id:b,style:m},s)})}i.d(e,"a",function(){return j});var b=d.i.memoize,w=d.c.getPropTypes(p.a),_=d.c.defaultProps,j=function(t){function e(t){var i;return Object(n.a)(this,e),(i=Object(a.a)(this,Object(o.a)(e).call(this,t))).viewports=null,i.children=null,i._needsRedraw=null,i.pickObject=i.pickObject.bind(Object(c.a)(Object(c.a)(i))),i.pickMultipleObjects=i.pickObject.bind(Object(c.a)(Object(c.a)(i))),i.pickObjects=i.pickObject.bind(Object(c.a)(Object(c.a)(i))),i._extractJSXLayers=b(y),i._positionChildrenUnderViews=b(m),i}return Object(s.a)(e,t),Object(r.a)(e,[{key:"componentDidMount",value:function(){var t=this.props.Deck||d.c;this.deck=this.deck||new t(Object.assign({},this.props,{canvas:this.deckCanvas,_customRender:this._customRender.bind(this)})),this._updateFromProps(this.props)}},{key:"shouldComponentUpdate",value:function(t){this._updateFromProps(t);var e=this.children!==this._parseJSX(t).children,i=this.deck.viewManager&&this.deck.viewManager.needsRedraw();return e&&!i}},{key:"componentDidUpdate",value:function(){this._redrawDeck()}},{key:"componentWillUnmount",value:function(){this.deck.finalize()}},{key:"pickObject",value:function(t){var e=t.x,i=t.y,n=t.radius,r=void 0===n?0:n,a=t.layerIds,o=void 0===a?null:a;return this.deck.pickObject({x:e,y:i,radius:r,layerIds:o})}},{key:"pickMultipleObjects",value:function(t){var e=t.x,i=t.y,n=t.radius,r=void 0===n?0:n,a=t.layerIds,o=void 0===a?null:a,s=t.depth,c=void 0===s?10:s;return this.deck.pickMultipleObjects({x:e,y:i,radius:r,layerIds:o,depth:c})}},{key:"pickObjects",value:function(t){var e=t.x,i=t.y,n=t.width,r=void 0===n?1:n,a=t.height,o=void 0===a?1:a,s=t.layerIds,c=void 0===s?null:s;return this.deck.pickObjects({x:e,y:i,width:r,height:o,layerIds:c})}},{key:"_redrawDeck",value:function(){this._needsRedraw&&(this.deck._drawLayers(this._needsRedraw),this._needsRedraw=null)}},{key:"_customRender",value:function(t){this._needsRedraw=t,this.deck.viewManager.getViewports()!==this.viewports?this.forceUpdate():this._redrawDeck()}},{key:"_parseJSX",value:function(t){return this._extractJSXLayers({layers:t.layers,views:t.views,children:t.children})}},{key:"_updateFromProps",value:function(t){var e=this._parseJSX(t),i=e.layers,n=e.views,r=Object.assign({},t,{layers:i,views:n});this.deck.setProps(r)}},{key:"render",value:function(){var t=this,e=(this.deck||{}).viewManager;this.viewports=e&&e.getViewports(),this.children=this._parseJSX(this.props).children;var i=this._positionChildrenUnderViews({children:this.children,viewports:this.viewports,deck:this.deck,ContextProvider:this.props.ContextProvider}),n=Object.assign({},{position:"absolute",left:0,top:0},this.props.style),r=Object(u.createElement)("canvas",{ref:function(e){return t.deckCanvas=e},key:"deck-canvas",id:this.props.id,style:n});return Object(u.createElement)("div",{id:"deckgl-wrapper"},[i,r])}}]),e}(l.a.Component);j.propTypes=w,j.defaultProps=_},445:function(t,e,i){"use strict";var n=i(203),r=i(204),a=i(206),o=i(205),s=i(234),c=i(207),u=i(248),l=i(213);i.d(e,"a",function(){return g});var h=l.x.fp64LowPart,p=[0,0,0,255],d=[0,0,1],v=new l.l,f={sizeUnits:"pixels",pointSize:{type:"number",min:0,value:10},fp64:!1,getPosition:{type:"accessor",value:function(t){return t.position}},getNormal:{type:"accessor",value:d},getColor:{type:"accessor",value:p},material:v,radiusPixels:{deprecatedFor:"pointSize"}},g=function(t){function e(){return Object(n.a)(this,e),Object(a.a)(this,Object(o.a)(e).apply(this,arguments))}return Object(c.a)(e,t),Object(r.a)(e,[{key:"getShaders",value:function(t){return{vs:"#define SHADER_NAME point-cloud-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec3 instanceNormals;\nattribute vec4 instanceColors;\nattribute vec3 instancePositions;\nattribute vec2 instancePositions64xyLow;\nattribute vec3 instancePickingColors;\n\nuniform float opacity;\nuniform float radiusPixels;\n\nvarying vec4 vColor;\nvarying vec2 unitPosition;\n\nvoid main(void) {\n  unitPosition = positions.xy;\n  vec4 position_commonspace;\n  gl_Position = project_position_to_clipspace(instancePositions, instancePositions64xyLow, vec3(0.), position_commonspace);\n  gl_Position.xy += project_pixel_size_to_clipspace(positions.xy * radiusPixels);\n  vec3 lightColor = lighting_getLightColor(instanceColors.rgb, project_uCameraPosition, position_commonspace.xyz, project_normal(instanceNormals));\n  vColor = vec4(lightColor, instanceColors.a * opacity) / 255.0;\n  picking_setPickingColor(instancePickingColors);\n}\n",fs:"#define SHADER_NAME point-cloud-layer-fragment-shader\n\nprecision highp float;\n\nvarying vec4 vColor;\nvarying vec2 unitPosition;\n\nvoid main(void) {\n\n  float distToCenter = length(unitPosition);\n\n  if (distToCenter > 1.0) {\n    discard;\n  }\n\n  gl_FragColor = vColor;\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n}\n",modules:[this.use64bitProjection()?"project64":"project32","gouraud-lighting","picking"]}}},{key:"initializeState",value:function(){this.getAttributeManager().addInstanced({instancePositions:{size:3,transition:!0,accessor:"getPosition"},instancePositions64xyLow:{size:2,accessor:"getPosition",update:this.calculateInstancePositions64xyLow},instanceNormals:{size:3,transition:!0,accessor:"getNormal",defaultValue:d},instanceColors:{size:4,type:5121,transition:!0,accessor:"getColor",defaultValue:p}})}},{key:"updateState",value:function(t){var i=t.props,n=t.oldProps,r=t.changeFlags;if(Object(s.a)(Object(o.a)(e.prototype),"updateState",this).call(this,{props:i,oldProps:n,changeFlags:r}),i.fp64!==n.fp64){var a=this.context.gl;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(a)}),this.getAttributeManager().invalidateAll()}}},{key:"draw",value:function(t){var e=t.uniforms,i=this.context.viewport,n=this.props,r=n.pointSize,a="meters"===n.sizeUnits?i.distanceScales.pixelsPerMeter[2]:1;this.state.model.setUniforms(Object.assign({},e,{radiusPixels:r*a})).draw()}},{key:"_getModel",value:function(t){for(var e=[],i=0;i<3;i++){var n=i/3*Math.PI*2;e.push(2*Math.cos(n),2*Math.sin(n),0)}return new l.j(t,Object.assign({},this.getShaders(),{id:this.props.id,geometry:new l.h({drawMode:4,attributes:{positions:new Float32Array(e)}}),isInstanced:!0,shaderCache:this.context.shaderCache}))}},{key:"calculateInstancePositions64xyLow",value:function(t,e){var i=e.startRow,n=e.endRow,r=this.use64bitPositions();if(t.constant=!r,r){var a=this.props,o=a.data,s=a.getPosition,c=t.value,l=i*t.size,p=Object(u.h)(o,i,n),d=p.iterable,v=p.objectInfo,f=!0,g=!1,y=void 0;try{for(var m,b=d[Symbol.iterator]();!(f=(m=b.next()).done);f=!0){var w=m.value;v.index++;var _=s(w,v);c[l++]=h(_[0]),c[l++]=h(_[1])}}catch(j){g=!0,y=j}finally{try{f||null==b.return||b.return()}finally{if(g)throw y}}}else t.value=new Float32Array(2)}}]),e}(u.d);g.layerName="PointCloudLayer",g.defaultProps=f}}]);